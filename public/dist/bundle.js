/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./public/js/main2.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./node_modules/keycode/index.js":
/*!***************************************!*\
  !*** ./node_modules/keycode/index.js ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("// Source: http://jsfiddle.net/vWx8V/\n// http://stackoverflow.com/questions/5603195/full-list-of-javascript-keycodes\n\n/**\n * Conenience method returns corresponding value for given keyName or keyCode.\n *\n * @param {Mixed} keyCode {Number} or keyName {String}\n * @return {Mixed}\n * @api public\n */\n\nfunction keyCode(searchInput) {\n  // Keyboard Events\n  if (searchInput && 'object' === typeof searchInput) {\n    var hasKeyCode = searchInput.which || searchInput.keyCode || searchInput.charCode\n    if (hasKeyCode) searchInput = hasKeyCode\n  }\n\n  // Numbers\n  if ('number' === typeof searchInput) return names[searchInput]\n\n  // Everything else (cast to string)\n  var search = String(searchInput)\n\n  // check codes\n  var foundNamedKey = codes[search.toLowerCase()]\n  if (foundNamedKey) return foundNamedKey\n\n  // check aliases\n  var foundNamedKey = aliases[search.toLowerCase()]\n  if (foundNamedKey) return foundNamedKey\n\n  // weird character?\n  if (search.length === 1) return search.charCodeAt(0)\n\n  return undefined\n}\n\n/**\n * Compares a keyboard event with a given keyCode or keyName.\n *\n * @param {Event} event Keyboard event that should be tested\n * @param {Mixed} keyCode {Number} or keyName {String}\n * @return {Boolean}\n * @api public\n */\nkeyCode.isEventKey = function isEventKey(event, nameOrCode) {\n  if (event && 'object' === typeof event) {\n    var keyCode = event.which || event.keyCode || event.charCode\n    if (keyCode === null || keyCode === undefined) { return false; }\n    if (typeof nameOrCode === 'string') {\n      // check codes\n      var foundNamedKey = codes[nameOrCode.toLowerCase()]\n      if (foundNamedKey) { return foundNamedKey === keyCode; }\n    \n      // check aliases\n      var foundNamedKey = aliases[nameOrCode.toLowerCase()]\n      if (foundNamedKey) { return foundNamedKey === keyCode; }\n    } else if (typeof nameOrCode === 'number') {\n      return nameOrCode === keyCode;\n    }\n    return false;\n  }\n}\n\nexports = module.exports = keyCode;\n\n/**\n * Get by name\n *\n *   exports.code['enter'] // => 13\n */\n\nvar codes = exports.code = exports.codes = {\n  'backspace': 8,\n  'tab': 9,\n  'enter': 13,\n  'shift': 16,\n  'ctrl': 17,\n  'alt': 18,\n  'pause/break': 19,\n  'caps lock': 20,\n  'esc': 27,\n  'space': 32,\n  'page up': 33,\n  'page down': 34,\n  'end': 35,\n  'home': 36,\n  'left': 37,\n  'up': 38,\n  'right': 39,\n  'down': 40,\n  'insert': 45,\n  'delete': 46,\n  'command': 91,\n  'left command': 91,\n  'right command': 93,\n  'numpad *': 106,\n  'numpad +': 107,\n  'numpad -': 109,\n  'numpad .': 110,\n  'numpad /': 111,\n  'num lock': 144,\n  'scroll lock': 145,\n  'my computer': 182,\n  'my calculator': 183,\n  ';': 186,\n  '=': 187,\n  ',': 188,\n  '-': 189,\n  '.': 190,\n  '/': 191,\n  '`': 192,\n  '[': 219,\n  '\\\\': 220,\n  ']': 221,\n  \"'\": 222\n}\n\n// Helper aliases\n\nvar aliases = exports.aliases = {\n  'windows': 91,\n  '⇧': 16,\n  '⌥': 18,\n  '⌃': 17,\n  '⌘': 91,\n  'ctl': 17,\n  'control': 17,\n  'option': 18,\n  'pause': 19,\n  'break': 19,\n  'caps': 20,\n  'return': 13,\n  'escape': 27,\n  'spc': 32,\n  'spacebar': 32,\n  'pgup': 33,\n  'pgdn': 34,\n  'ins': 45,\n  'del': 46,\n  'cmd': 91\n}\n\n/*!\n * Programatically add the following\n */\n\n// lower case chars\nfor (i = 97; i < 123; i++) codes[String.fromCharCode(i)] = i - 32\n\n// numbers\nfor (var i = 48; i < 58; i++) codes[i - 48] = i\n\n// function keys\nfor (i = 1; i < 13; i++) codes['f'+i] = i + 111\n\n// numpad keys\nfor (i = 0; i < 10; i++) codes['numpad '+i] = i + 96\n\n/**\n * Get by code\n *\n *   exports.name[13] // => 'Enter'\n */\n\nvar names = exports.names = exports.title = {} // title for backward compat\n\n// Create reverse mapping\nfor (i in codes) names[codes[i]] = i\n\n// Add aliases\nfor (var alias in aliases) {\n  codes[alias] = aliases[alias]\n}\n\n\n//# sourceURL=webpack:///./node_modules/keycode/index.js?");

/***/ }),

/***/ "./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n\n\n//# sourceURL=webpack:///(webpack)/buildin/global.js?");

/***/ }),

/***/ "./public/js/keymaster.js":
/*!********************************!*\
  !*** ./public/js/keymaster.js ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("/* WEBPACK VAR INJECTION */(function(global) {//     keymaster.js\n//     (c) 2011-2013 Thomas Fuchs\n//     keymaster.js may be freely distributed under the MIT license.\n// var wasPressed = [];\n\n// (function(global) {\n\tvar k,\n\t\t_handlers = {},\n\t\t_mods = {\n\t\t\t16: false,\n\t\t\t18: false,\n\t\t\t17: false,\n\t\t\t91: false\n\t\t},\n\t\t_scope = 'all',\n\t\t// modifier keys\n\t\t_MODIFIERS = {\n\t\t\t'⇧': 16,\n\t\t\tshift: 16,\n\t\t\t'⌥': 18,\n\t\t\talt: 18,\n\t\t\toption: 18,\n\t\t\t'⌃': 17,\n\t\t\tctrl: 17,\n\t\t\tcontrol: 17,\n\t\t\t'⌘': 91,\n\t\t\tcommand: 91\n\t\t},\n\t\t// special keys\n\t\t_MAP = {\n\t\t\tbackspace: 8,\n\t\t\ttab: 9,\n\t\t\tclear: 12,\n\t\t\tenter: 13,\n\t\t\t'return': 13,\n\t\t\tesc: 27,\n\t\t\tescape: 27,\n\t\t\tspace: 32,\n\t\t\tleft: 37,\n\t\t\tup: 38,\n\t\t\tright: 39,\n\t\t\tdown: 40,\n\t\t\tdel: 46,\n\t\t\t'delete': 46,\n\t\t\thome: 36,\n\t\t\tend: 35,\n\t\t\tpageup: 33,\n\t\t\tpagedown: 34,\n\t\t\t',': 188,\n\t\t\t'.': 190,\n\t\t\t'/': 191,\n\t\t\t'`': 192,\n\t\t\t'-': 189,\n\t\t\t'=': 187,\n\t\t\t';': 186,\n\t\t\t'\\'': 222,\n\t\t\t'[': 219,\n\t\t\t']': 221,\n\t\t\t'\\\\': 220\n\t\t},\n\t\tcode = function(x) {\n\t\t\treturn _MAP[x] || x.toUpperCase().charCodeAt(0);\n\t\t},\n\t\t_downKeys = [];\n\n\tfor (k = 1; k < 20; k++) _MAP['f' + k] = 111 + k;\n\n\t// IE doesn't support Array#indexOf, so have a simple replacement\n\tfunction index(array, item) {\n\t\tvar i = array.length;\n\t\twhile (i--)\n\t\t\tif (array[i] === item) return i;\n\t\treturn -1;\n\t}\n\n\t// for comparing mods before unassignment\n\tfunction compareArray(a1, a2) {\n\t\tif (a1.length != a2.length) return false;\n\t\tfor (var i = 0; i < a1.length; i++) {\n\t\t\tif (a1[i] !== a2[i]) return false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tvar modifierMap = {\n\t\t16: 'shiftKey',\n\t\t18: 'altKey',\n\t\t17: 'ctrlKey',\n\t\t91: 'metaKey'\n\t};\n\n\tfunction updateModifierKey(event) {\n\t\tfor (k in _mods) _mods[k] = event[modifierMap[k]];\n\t};\n\n\t// handle keydown event\n\tfunction dispatch(event) {\n\t\tvar key, handler, k, i, modifiersMatch, scope;\n\t\tkey = event.keyCode;\n\n\t\tif (index(_downKeys, key) == -1) {\n\t\t\t_downKeys.push(key);\n\t\t}\n\n\t\t// if a modifier key, set the key.<modifierkeyname> property to true and return\n\t\tif (key == 93 || key == 224) key = 91; // right command on webkit, command on Gecko\n\t\tif (key in _mods) {\n\t\t\t_mods[key] = true;\n\t\t\t// 'assignKey' from inside this closure is exported to window.key\n\t\t\tfor (k in _MODIFIERS)\n\t\t\t\tif (_MODIFIERS[k] == key) assignKey[k] = true;\n\t\t\treturn;\n\t\t}\n\t\tupdateModifierKey(event);\n\n\t\t// see if we need to ignore the keypress (filter() can can be overridden)\n\t\t// by default ignore key presses if a select, textarea, or input is focused\n\t\tif (!assignKey.filter.call(this, event)) return;\n\n\t\t// abort if no potentially matching shortcuts found\n\t\tif (!(key in _handlers)) return;\n\n\t\tscope = getScope();\n\n\t\t// for each potential shortcut\n\t\tfor (i = 0; i < _handlers[key].length; i++) {\n\t\t\thandler = _handlers[key][i];\n\n\t\t\t// see if it's in the current scope\n\t\t\tif (handler.scope == scope || handler.scope == 'all') {\n\t\t\t\t// check if modifiers match if any\n\t\t\t\tmodifiersMatch = handler.mods.length > 0;\n\t\t\t\tfor (k in _mods)\n\t\t\t\t\tif ((!_mods[k] && index(handler.mods, +k) > -1) ||\n\t\t\t\t\t\t(_mods[k] && index(handler.mods, +k) == -1)) modifiersMatch = false;\n\t\t\t\t// call the handler and stop the event if neccessary\n\t\t\t\tif ((handler.mods.length == 0 && !_mods[16] && !_mods[18] && !_mods[17] && !_mods[91]) || modifiersMatch) {\n\t\t\t\t\tif (handler.method(event, handler) === false) {\n\t\t\t\t\t\tif (event.preventDefault) event.preventDefault();\n\t\t\t\t\t\telse event.returnValue = false;\n\t\t\t\t\t\tif (event.stopPropagation) event.stopPropagation();\n\t\t\t\t\t\tif (event.cancelBubble) event.cancelBubble = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t// unset modifier keys on keyup\n\tfunction clearModifier(event) {\n\t\tvar key = event.keyCode,\n\t\t\tk,\n\t\t\ti = index(_downKeys, key);\n\n\t\t// remove key from _downKeys\n\t\tif (i >= 0) {\n\t\t\t_downKeys.splice(i, 1);\n\t\t}\n\n\t\tif (key == 93 || key == 224) key = 91;\n\t\tif (key in _mods) {\n\t\t\t_mods[key] = false;\n\t\t\tfor (k in _MODIFIERS)\n\t\t\t\tif (_MODIFIERS[k] == key) assignKey[k] = false;\n\t\t}\n\t};\n\n\tfunction resetModifiers() {\n\t\tfor (k in _mods) _mods[k] = false;\n\t\tfor (k in _MODIFIERS) assignKey[k] = false;\n\t};\n\n\t// parse and assign shortcut\n\tfunction assignKey(key, scope, method) {\n\t\tvar keys, mods;\n\t\tkeys = getKeys(key);\n\t\tif (method === undefined) {\n\t\t\tmethod = scope;\n\t\t\tscope = 'all';\n\t\t}\n\n\t\t// for each shortcut\n\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\t// set modifier keys if any\n\t\t\tmods = [];\n\t\t\tkey = keys[i].split('+');\n\t\t\tif (key.length > 1) {\n\t\t\t\tmods = getMods(key);\n\t\t\t\tkey = [key[key.length - 1]];\n\t\t\t}\n\t\t\t// convert to keycode and...\n\t\t\tkey = key[0]\n\t\t\tkey = code(key);\n\t\t\t// ...store handler\n\t\t\tif (!(key in _handlers)) _handlers[key] = [];\n\t\t\t_handlers[key].push({\n\t\t\t\tshortcut: keys[i],\n\t\t\t\tscope: scope,\n\t\t\t\tmethod: method,\n\t\t\t\tkey: keys[i],\n\t\t\t\tmods: mods\n\t\t\t});\n\t\t}\n\t};\n\n\t// unbind all handlers for given key in current scope\n\tfunction unbindKey(key, scope) {\n\t\tvar multipleKeys, keys,\n\t\t\tmods = [],\n\t\t\ti, j, obj;\n\n\t\tmultipleKeys = getKeys(key);\n\n\t\tfor (j = 0; j < multipleKeys.length; j++) {\n\t\t\tkeys = multipleKeys[j].split('+');\n\n\t\t\tif (keys.length > 1) {\n\t\t\t\tmods = getMods(keys);\n\t\t\t}\n\n\t\t\tkey = keys[keys.length - 1];\n\t\t\tkey = code(key);\n\n\t\t\tif (scope === undefined) {\n\t\t\t\tscope = getScope();\n\t\t\t}\n\t\t\tif (!_handlers[key]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (i = 0; i < _handlers[key].length; i++) {\n\t\t\t\tobj = _handlers[key][i];\n\t\t\t\t// only clear handlers if correct scope and mods match\n\t\t\t\tif (obj.scope === scope && compareArray(obj.mods, mods)) {\n\t\t\t\t\t_handlers[key][i] = {};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t\n\t\n\t\n\n\t// Returns true if the key with code 'keyCode' is currently down\n\t// Converts strings into key codes.\n\tfunction isPressed(keyCode) {\n\t\tif (typeof(keyCode) == 'string') {\n\t\t\tkeyCode = code(keyCode);\n\t\t}\n\t\tvar pressed = index(_downKeys, keyCode) != -1;\n\t\treturn pressed;\n\t}\n\t\n\tfunction wasPressed(keyCode, keyList) {\n\t\tif (typeof(keyCode) == 'string') {\n\t\t\tkeyCode = code(keyCode);\n\t\t}\n\t\tvar pressed = index(keyList, keyCode) != -1;\n\t\treturn pressed;\n\t}\n\n\tfunction getPressedKeyCodes() {\n\t\treturn _downKeys.slice(0);\n\t}\n\n\tfunction filter(event) {\n\t\tvar tagName = (event.target || event.srcElement).tagName;\n\t\t// ignore keypressed in any elements that support keyboard data input\n\t\treturn !(tagName == 'INPUT' || tagName == 'SELECT' || tagName == 'TEXTAREA');\n\t}\n\n\t// initialize key.<modifier> to false\n\tfor (k in _MODIFIERS) assignKey[k] = false;\n\n\t// set current scope (default 'all')\n\tfunction setScope(scope) {\n\t\t_scope = scope || 'all'\n\t};\n\n\tfunction getScope() {\n\t\treturn _scope || 'all'\n\t};\n\n\t// delete all handlers for a given scope\n\tfunction deleteScope(scope) {\n\t\tvar key, handlers, i;\n\n\t\tfor (key in _handlers) {\n\t\t\thandlers = _handlers[key];\n\t\t\tfor (i = 0; i < handlers.length;) {\n\t\t\t\tif (handlers[i].scope === scope) handlers.splice(i, 1);\n\t\t\t\telse i++;\n\t\t\t}\n\t\t}\n\t};\n\n\t// abstract key logic for assign and unassign\n\tfunction getKeys(key) {\n\t\tvar keys;\n\t\tkey = key.replace(/\\s/g, '');\n\t\tkeys = key.split(',');\n\t\tif ((keys[keys.length - 1]) == '') {\n\t\t\tkeys[keys.length - 2] += ',';\n\t\t}\n\t\treturn keys;\n\t}\n\n\t// abstract mods logic for assign and unassign\n\tfunction getMods(key) {\n\t\tvar mods = key.slice(0, key.length - 1);\n\t\tfor (var mi = 0; mi < mods.length; mi++)\n\t\t\tmods[mi] = _MODIFIERS[mods[mi]];\n\t\treturn mods;\n\t}\n\n\t// cross-browser events\n\tfunction addEvent(object, event, method) {\n\t\tif (object.addEventListener)\n\t\t\tobject.addEventListener(event, method, false);\n\t\telse if (object.attachEvent)\n\t\t\tobject.attachEvent('on' + event, function() {\n\t\t\t\tmethod(window.event)\n\t\t\t});\n\t};\n\n\t// set the handlers globally on document\n\taddEvent(document, 'keydown', function(event) {\n\t\tdispatch(event)\n\t}); // Passing _scope to a callback to ensure it remains the same by execution. Fixes #48\n\taddEvent(document, 'keyup', clearModifier);\n\n\t// reset modifiers to false whenever the window is (re)focused.\n\taddEvent(window, 'focus', resetModifiers);\n\n\t// store previously defined key\n\tvar previousKey = global.key;\n\n\t// restore previously defined key and return reference to our key object\n\tfunction noConflict() {\n\t\tvar k = global.key;\n\t\tglobal.key = previousKey;\n\t\treturn k;\n\t}\n\n\t// set window.key and window.key.set/get/deleteScope, and the default filter\n\tglobal.key = assignKey;\n\tglobal.key.setScope = setScope;\n\tglobal.key.getScope = getScope;\n\tglobal.key.deleteScope = deleteScope;\n\tglobal.key.filter = filter;\n\tglobal.key.isPressed = isPressed;\n\tglobal.key.wasPressed = wasPressed;\n\tglobal.key.getPressedKeyCodes = getPressedKeyCodes;\n\tglobal.key.noConflict = noConflict;\n\tglobal.key.unbind = unbindKey;\n\n\tif (true) module.exports = assignKey;\n\n// })(this);\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../node_modules/webpack/buildin/global.js */ \"./node_modules/webpack/buildin/global.js\")))\n\n//# sourceURL=webpack:///./public/js/keymaster.js?");

/***/ }),

/***/ "./public/js/main2.js":
/*!****************************!*\
  !*** ./public/js/main2.js ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("\n__webpack_require__(/*! ../js/keymaster.js */ \"./public/js/keymaster.js\");\n// require(\"../js/gamepad.js\");\n// let keycode = require(\"keycode\");\nwindow.keycode = __webpack_require__(/*! keycode */ \"./node_modules/keycode/index.js\");\nlet textFitPercent = __webpack_require__(/*! ../js/textfitpercent.js */ \"./public/js/textfitpercent.js\");\nlet tools = __webpack_require__(/*! ../js/tools.js */ \"./public/js/tools.js\");\n// rest of tools:\nString.prototype.replaceAll = function(search, replacement) {\n\tlet target = this;\n\treturn target.replace(new RegExp(search, \"g\"), replacement);\n};\n\n$.fn.sumHeights = function() {\n\tlet h = 0;\n\tthis.each(function() {\n\t\th += $(this).outerHeight();\n\t});\n\treturn h;\n};\n$.fn.addUp = function(getter) {\n\treturn Array.prototype.reduce.call(this, function(a, b) {\n\t\treturn a + getter.call($(b));\n\t}, 0);\n}\n\n\nlet socket = io(\"https://twitchplaysnintendoswitch.com\", {\n\tpath: \"/8110/socket.io\",\n\ttransports: [\"websocket\"],\n});\n// let socket2 = io(\"https://twitchplaysnintendoswitch.com\", {\n// \tpath: \"/8001/socket.io\",\n// });\nlet socket2 = socket;\n\nlet globalEventTimer = false;\nlet lagless1JoinTimer;\nlet sendInputTimer;\nlet currentTab = \"#lagless1\";\nlet currentPlayerChosen = 0;\nlet wasPressedKeyCodes = [];\nlet lastSplitTime = 0;\nlet lastSplitTimeMS = 0;\nlet loaded = false;\nlet locked = false;\nlet wifiEnabled = false;\nlet player;\nlet player4;\nlet audioConnected = false;\nlet videoConnected = false;\nlet authCookie;\nlet crate;\nlet usernameMap = {};\nlet banlist = [];\nlet bannedIPs = [\"84.197.3.92\", \"94.214.218.184\", \"185.46.212.146\"];\nlet resizers = [];\nlet resizeDebounceTimer;\nlet resizeAvailable = true;\n\n// twitch lagless swap settings\nlet isExempt = false;\nlet minQueuePos = 5;\nlet tabsSwappedWithTwitch = [false, false, false, false];\nlet maxViewersOnTab = [10, 10, 10, 10];\n\nlet viewers = [[], [], [], [], []];\nlet waitlists = [[], [], [], [], []];\nlet controlQueues = [[\"The queue is empty.\"], [\"The queue is empty.\"], [\"The queue is empty.\"], [\"The queue is empty.\"], [\"The queue is empty.\"]];\nlet controlQueue1 = [];\nlet controlQueue2 = [];\nlet controlQueue3 = [];\nlet controlQueue4 = [];\nlet controlQueue5 = [];\n\nlet myUniqueID = null;\nlet myUsername = null;\nlet myConnectedAccounts = [];\nlet myValidUsernames = [];\n\n// settings:\nlet settings = {\n\tenableAudioThree: true,\n\taudioThree: false,\n\tkeyboardControls: false,\n\tcontrollerControls: false,\n\ttouchControls: true,\n\tmouseControls: false,\n\tanalogStickMode: false,\n\tcurrentInputMode: null,\n\tdarkTheme: false,\n\tfullscreen: false,\n\tlargescreen: false,\n\tyoutubeChat: false,\n\thideChat: false,\n\thideNav: false,\n\tdeadzone: 50,\n\tstickSensitivityX: 1,\n\tstickSensitivityY: 1,\n\tstickAttack: 20,\n\tstickReturn: 20,\n\tkeyboardProfiles: {},\n\ttab: 2,\n\tdpadSwap: false,\n\tTDSConfig: false,\n\tvolume: 50,\n\tusernameIndex: 0,\n};\n\nlet lagless1Settings = {};\nlet lagless2Settings = {framerate: 30, videoBitrate: 1, scale: 960, offsetX: 0, offsetY: 0};\nlet lagless5Settings = {framerate: 30, videoBitrate: 1, scale: 960, offsetX: 0, offsetY: 0};\nlet disableController = false;\n\n// detect firefox:\nif(navigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1) {\n\tsettings.stickSensitivityX = 1.5;\n\tsettings.stickSensitivityY = 1.5;\n}\n\nlet timeLeft = 30000;\nlet turnLength = 30000;\nlet timeTillForfeit = 15000;\nlet turnUsername = null;\nlet lastCurrentTime = 0;\n\nlet mouseMoveTimer = null;\nlet isMobile = false;\nlet pingTime = 0;\nlet restPos = 128;\n// Default 512*1024 (512kb).\n// Default 128*1024 (128kb)\nlet videoBufferSize = 256*1024;\nlet audioBufferSize = 128*1024;\n\nlet oldControllerState = \"800000000000000\" + \" \" + restPos + \" \" + restPos + \" \" + restPos + \" \" + restPos;\nlet lagless1Port = 8001;\nlet lagless2Port = 8002;\nlet lagless3Port = 8003;\nlet lagless4Port = 8004;\n\n/* MOBILE @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n// check if on mobile\nif(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(navigator.userAgent.substr(0,4))) { \n    isMobile = true;\n}\n\n// if (isMobile) {\n// \tswal({\n// \t\ttitle: \"Do you want to go to the mobile site?\",\n// \t\ttype: \"warning\",\n// \t\tshowCancelButton: true,\n// \t\tconfirmButtonColor: \"#3085d6\",\n// \t\tcancelButtonColor: \"#d33\",\n// \t\tconfirmButtonText: \"Yes\",\n// \t\tcancelButtonText: \"No\",\n// \t}).then((result) => {\n// \t\tif (result.value) {\n// \t\t\twindow.location = \"https://twitchplaysnintendoswitch.com/mobile.html\";\n// \t\t}\n// \t});\n// }\n\nlet keyboardLayout = {};\nkeyboardLayout.tempSelectedAction = \"\";\nkeyboardLayout.tempSelectedKey = \"\";\nkeyboardLayout.LU = \"W\";\nkeyboardLayout.LD = \"S\";\nkeyboardLayout.LL = \"A\";\nkeyboardLayout.LR = \"D\";\nkeyboardLayout.RU = \"I\";\nkeyboardLayout.RD = \"K\";\nkeyboardLayout.RL = \"J\";\nkeyboardLayout.RR = \"L\";\nkeyboardLayout.ABtn = \"right\";\nkeyboardLayout.BBtn = \"down\";\nkeyboardLayout.XBtn = \"up\";\nkeyboardLayout.YBtn = \"left\";\nkeyboardLayout.DUp = \"T\";\nkeyboardLayout.DDown = \"G\";\nkeyboardLayout.DLeft = \"F\";\nkeyboardLayout.DRight = \"H\";\nkeyboardLayout.LStick = \"R\";\nkeyboardLayout.RStick = \"Y\";\nkeyboardLayout.LBtn = \"U\";\nkeyboardLayout.ZL = \"Q\";\nkeyboardLayout.RBtn = \"O\";\nkeyboardLayout.ZR = \"E\";\nkeyboardLayout.Minus = \"-\";\nkeyboardLayout.Plus = \"=\";\nkeyboardLayout.Capture = \"1\";\nkeyboardLayout.Home = \"2\";\nsettings.keyboardProfiles.default = keyboardLayout;\n\nfunction getMeta(url, callback) {\n\tlet img = new Image();\n\timg.src = url;\n\timg.onload = function() {\n\t\tcallback(this.width, this.height);\n\t}\n}\n\n\n/* CONTROLLER STUFF */\n\nlet gamepadCounter = 0;\n\nlet controller = {};\ncontroller.btns = {\n\tup:\t\t\t\t0,\n\tdown: \t\t\t0,\n\tleft:\t\t\t0,\n\tright:\t\t\t0,\n\tstick_button: \t0,\n\tl:\t\t\t\t0,\n\tzl:\t\t\t\t0,\n\tminus:\t\t\t0,\n\tcapture:\t\t0,\n\t\n\ta:\t\t\t\t0,\n\tb:\t\t\t\t0,\n\tx:\t\t\t\t0,\n\ty:\t\t\t\t0,\n\tstick_button2:\t0,\n\tr:\t\t\t\t0,\n\tzr:\t\t\t\t0,\n\tplus:\t\t\t0,\n\thome:\t\t\t0,\n};\ncontroller.LStick = {\n\tx: restPos,\n\ty: restPos,\n};\ncontroller.RStick = {\n\tx: restPos,\n\ty: restPos,\n};\n\ncontroller.reset = function() {\n\tfor (let prop in controller.btns) {\n\t\tcontroller.btns[prop] = 0;\n\t}\n\tcontroller.LStick.x = restPos;\n\tcontroller.LStick.y = restPos;\n\tcontroller.RStick.x = restPos;\n\tcontroller.RStick.y = restPos;\n}\n\ncontroller.getState = function() {\n\t\n\tthis.LStick.x = tools.minmax(this.LStick.x, 0, 255);\n\tthis.LStick.y = tools.minmax(this.LStick.y, 0, 255);\n\tthis.RStick.x = tools.minmax(this.RStick.x, 0, 255);\n\tthis.RStick.y = tools.minmax(this.RStick.y, 0, 255);\n\t\n\tif (isNaN(this.LStick.x)) {\n\t\tthis.LStick.x = restPos;\n\t}\n\tif (isNaN(this.LStick.y)) {\n\t\tthis.LStick.y = restPos;\n\t}\n\tif (isNaN(this.RStick.x)) {\n\t\tthis.RStick.x = restPos;\n\t}\n\tif (isNaN(this.RStick.y)) {\n\t\tthis.RStick.y = restPos;\n\t}\n\t\n\tlet state = \"\";\n\n\tif (this.btns.up == 1 && this.btns.left == 1) {\n\t\tstate += \"7\";\n\t} else if (this.btns.up == 1 && this.btns.right == 1) {\n\t\tstate += \"1\";\n\t} else if (this.btns.down == 1 && this.btns.left == 1) {\n\t\tstate += \"5\";\n\t} else if (this.btns.down == 1 && this.btns.right == 1) {\n\t\tstate += \"3\";\n\t} else if (this.btns.up == 1) {\n\t\tstate += \"0\";\n\t} else if (this.btns.down == 1) {\n\t\tstate += \"4\";\n\t} else if (this.btns.left == 1) {\n\t\tstate += \"6\";\n\t} else if (this.btns.right == 1) {\n\t\tstate += \"2\";\n\t} else {\n\t\tstate += \"8\";\n\t}\n\n\tstate += this.btns.stick_button;\n\tstate += this.btns.l;\n\tstate += this.btns.zl;\n\tstate += this.btns.minus;\n\tstate += this.btns.capture;\n\t\n\tstate += this.btns.a;\n\tstate += this.btns.b;\n\tstate += this.btns.x;\n\tstate += this.btns.y;\n\tstate += this.btns.stick_button2;\n\tstate += this.btns.r;\n\tstate += this.btns.zr;\n\tstate += this.btns.plus;\n\tstate += this.btns.home;\n\n\n\tlet LX = this.LStick.x;\n\tlet LY = this.LStick.y;\n\tlet RX = this.RStick.x;\n\tlet RY = this.RStick.y;\n\n\tstate += \" \" + LX + \" \" + LY + \" \" + RX + \" \" + RY;\n\t\n\treturn state;\n}\n\n\ncontroller.getA = function()  {\n\treturn this.btns._a;\n}\n\ncontroller.inputState = function(state) {\n\t\n\tlet entireState = state.split(\" \");\n\t\n\tlet btns = entireState[0];\n\tlet dpad = btns[0];\n\t\n\tif (dpad == \"7\") {\n\t\tthis.btns.up = 1;\n\t\tthis.btns.left = 1;\n\t} else if (dpad == \"1\") {\n\t\tthis.btns.up = 1;\n\t\tthis.btns.right = 1;\n\t} else if (dpad == \"5\") {\n\t\tthis.btns.down = 1;\n\t\tthis.btns.left = 1;\n\t} else if (dpad == \"3\") {\n\t\tthis.btns.down = 1;\n\t\tthis.btns.right = 1;\n\t} else if (dpad == \"0\") {\n\t\tthis.btns.up = 1;\n\t} else if (dpad == \"4\") {\n\t\tthis.btns.down = 1;\n\t} else if (dpad == \"6\") {\n\t\tthis.btns.left = 1;\n\t} else if (dpad == \"2\") {\n\t\tthis.btns.right = 1;\n\t} else if (dpad == \"8\") {\n\t}\n\t\n\tthis.btns.stick_button \t= parseInt(btns[1]);\n\tthis.btns.l \t\t\t= parseInt(btns[2]);\n\tthis.btns.zl \t\t\t= parseInt(btns[3]);\n\tthis.btns.minus \t\t= parseInt(btns[4]);\n\tthis.btns.capture \t\t= parseInt(btns[5]);\n\n\tthis.btns.a \t\t\t= parseInt(btns[6]);\n\tthis.btns.b \t\t\t= parseInt(btns[7]);\n\tthis.btns.x \t\t\t= parseInt(btns[8]);\n\tthis.btns.y \t\t\t= parseInt(btns[9]);\n\tthis.btns.stick_button2 = parseInt(btns[10]);\n\tthis.btns.r \t\t\t= parseInt(btns[11]);\n\tthis.btns.zr \t\t\t= parseInt(btns[12]);\n\tthis.btns.plus \t\t\t= parseInt(btns[13]);\n\tthis.btns.home \t\t\t= parseInt(btns[14]);\n\t\n\tthis.LStick.x = entireState[1];\n\tthis.LStick.y = entireState[2];\n\t\n\tthis.RStick.x = entireState[3];\n\tthis.RStick.y = entireState[4];\t\n}\n\n\ncontroller.reset();\n\n\nfunction sendControllerState() {\n\t\n\tlet newControllerState = controller.getState();\n\t\n\tif (newControllerState == oldControllerState) {\n\t\treturn;\n\t} else {\n\t\toldControllerState = newControllerState;\n\t}\n\t\n\tif (settings.currentInputMode == \"keyboard\" && !settings.keyboardControls) {\n\t\treturn;\n\t}\n\tif (settings.currentInputMode == \"controller\" && !settings.controllerControls) {\n\t\treturn;\n\t}\n\tif (settings.currentInputMode == \"touch\" && !settings.touchControls) {\n\t\treturn;\n\t}\n\t\n\tif (($(\"#keyboardSettings\").data(\"bs.modal\") || {})._isShown) {\n\t\treturn;\n\t}\n\t\n\tif(controlQueues[currentPlayerChosen].indexOf(myUniqueID) == -1) {\n\t\tsocket.emit(\"requestTurn\", currentPlayerChosen);\n\t\t\n// \t\t// turn over:\n// \t\t$(\".cancelTurn\").each(function() {\n// \t\t\tcNum = $(this).attr(\"code\");\n// \t\t\tif (cNum == (currentPlayerChosen + 1)) {\n// // \t\t\t\treturn;\n// \t\t\t}\n// \t\t\tlet html = '<button id=\"requestTurn' + cNum + '\" class=\"requestTurn btn btn-secondary\" code=\"'+ cNum +'\">Join Queue</button>';\n// \t\t\t$(this).replaceWith(html);\n// \t\t});\n// \t\t// replace only the currect button:\n// \t\tlet html = '<button id=\"cancelTurn' + (currentPlayerChosen + 1) + '\" class=\"cancelTurn btn btn-secondary\" code=\"' + currentPlayerChosen + '\">Leave Queue</button>';\n// \t\t$(\"#requestTurn\" + (currentPlayerChosen + 1)).replaceWith(html);\n\t}\n\t\n\tif(controlQueues[currentPlayerChosen].indexOf(myUniqueID) > 0 && controlQueues[currentPlayerChosen].length > 0) {\n\t\tlet alertMessage = $(\".swal2-container\")[0];\n\t\tif (typeof alertMessage == \"undefined\") {\n\t\t\tswal(\"It's not your turn yet!\");\n\t\t}\n\t\treturn;\n\t}\n\t\n\tauthCookie = tools.getCookie(\"TwitchPlaysNintendoSwitch\");\n\tif (authCookie == null) {\n\t\tswal({\n\t\t\ttitle: \"You need to login! Redirecting you now!\",\n\t\t}).then((result) => {\n\t\t\tif (result.value) {\n\t\t\t\twindow.location.href = \"https://twitchplaysnintendoswitch.com/8110/auth/twitch/\";\n\t\t\t}\n\t\t});\n\t\treturn;\n\t} else {\n\t\tauthCookie = authCookie.split(\" \")[0].replace(/;/g, \"\");\n\t}\n\t\n\tlet obj = {state: newControllerState, cNum: 0}\n\t\n\tif (controlQueues[0][0] == myUniqueID) {\n\t\tobj.cNum = 0;\n\t} else if (controlQueues[1][0] == myUniqueID) {\n\t\tobj.cNum = 1;\n\t} else if (controlQueues[2][0] == myUniqueID) {\n\t\tobj.cNum = 2;\n\t} else if (controlQueues[3][0] == myUniqueID) {\n\t\tobj.cNum = 3;\n\t} else if (controlQueues[4][0] == myUniqueID) {\n\t\tobj.cNum = 4;\n\t} else {\n\t\tobj.cNum = currentPlayerChosen;\n\t}\n\tconsole.log(obj.state, obj.cNum);\n\tsocket.emit(\"sendControllerState\", obj);\n}\n\nfunction getKeyboardInput() {\n\n\tif (!$(\"#keyboardControlsCheckbox\")[0].checked) {\n\t\treturn;\n\t}\n\tauthCookie = tools.getCookie(\"TwitchPlaysNintendoSwitch\");\n\tif (authCookie == null) {\n\t\t$(\"#keyboardControlsCheckbox\").prop(\"checked\", false).trigger(\"change\");\n\t\tswal({\n\t\t\ttitle: \"You need to login! Redirecting you now!\",\n\t\t}).then((result) => {\n\t\t\tif (result.value) {\n\t\t\t\twindow.location.href = \"https://twitchplaysnintendoswitch.com/8110/auth/twitch/\";\n\t\t\t}\n\t\t});\n\t\treturn;\n\t} else {\n\t\tauthCookie = authCookie.split(\" \")[0].replace(/;/g, \"\");\n\t}\n\t\n\tlet oldControllerState = controller.getState();\n\t\n\tif (!settings.analogStickMode) {\n\t\tif (key.isPressed(keyboardLayout.LU)) {\n\t\t\tcontroller.LStick.y = 255;\n\t\t} else if(key.wasPressed(keyboardLayout.LU, wasPressedKeyCodes)) {\n\t\t\tcontroller.LStick.y = restPos;\n\t\t}\n\t\tif (key.isPressed(keyboardLayout.LD)) {\n\t\t\tcontroller.LStick.y = 0;\n\t\t} else if(key.wasPressed(keyboardLayout.LD, wasPressedKeyCodes)) {\n\t\t\tcontroller.LStick.y = restPos;\n\t\t}\n\t\tif (key.isPressed(keyboardLayout.LL)) {\n\t\t\tcontroller.LStick.x = 0;\n\t\t} else if(key.wasPressed(keyboardLayout.LL, wasPressedKeyCodes)) {\n\t\t\tcontroller.LStick.x = restPos;\n\t\t}\n\t\tif (key.isPressed(keyboardLayout.LR)) {\n\t\t\tcontroller.LStick.x = 255;\n\t\t} else if(key.wasPressed(keyboardLayout.LR, wasPressedKeyCodes)) {\n\t\t\tcontroller.LStick.x = restPos;\n\t\t}\n\t} else {\n\t\t\n\t\tlet leftRight = false;\n\t\tlet upDown = false;\n\t\t\n\t\tif (key.isPressed(keyboardLayout.LU)) {\n\t\t\tcontroller.LStick.y = Math.round(parseInt(controller.LStick.y) + settings.stickAttack);\n\t\t}\n\t\tif (key.isPressed(keyboardLayout.LD)) {\n\t\t\tcontroller.LStick.y = Math.round(parseInt(controller.LStick.y) - settings.stickAttack);\n\t\t}\n\t\tif (key.isPressed(keyboardLayout.LL)) {\n\t\t\tcontroller.LStick.x = Math.round(parseInt(controller.LStick.x) - settings.stickAttack);\n\t\t}\n\t\tif (key.isPressed(keyboardLayout.LR)) {\n\t\t\tcontroller.LStick.x = Math.round(parseInt(controller.LStick.x) + settings.stickAttack);\n\t\t}\n\t\t\n\t\tupDown = key.isPressed(keyboardLayout.LU) || key.isPressed(keyboardLayout.LD);\n\t\tleftRight = key.isPressed(keyboardLayout.LL) || key.isPressed(keyboardLayout.LR);\n\t\t\n\t\tif (!upDown) {\n\t\t\tcontroller.LStick.y = Math.round(mathZoom(parseInt(controller.LStick.y), restPos, settings.stickReturn));\n\t\t}\n\t\t\n\t\tif (!leftRight) {\n\t\t\tcontroller.LStick.x = Math.round(mathZoom(parseInt(controller.LStick.x), restPos, settings.stickReturn));\n\t\t}\n\t}\n\n\tif (key.isPressed(keyboardLayout.ABtn)) {\n\t\tcontroller.btns.a = 1;\n\t} else if(key.wasPressed(keyboardLayout.ABtn, wasPressedKeyCodes)) {\n\t\tcontroller.btns.a = 0;\n\t}\n\tif (key.isPressed(keyboardLayout.BBtn)) {\n\t\tcontroller.btns.b = 1;\n\t} else if(key.wasPressed(keyboardLayout.BBtn, wasPressedKeyCodes)) {\n\t\tcontroller.btns.b = 0;\n\t}\n\tif (key.isPressed(keyboardLayout.XBtn)) {\n\t\tcontroller.btns.x = 1;\n\t} else if(key.wasPressed(keyboardLayout.XBtn, wasPressedKeyCodes)) {\n\t\tcontroller.btns.x = 0;\n\t}\n\tif (key.isPressed(keyboardLayout.YBtn)) {\n\t\tcontroller.btns.y = 1;\n\t} else if(key.wasPressed(keyboardLayout.YBtn, wasPressedKeyCodes)) {\n\t\tcontroller.btns.y = 0;\n\t}\n\n\tif (key.isPressed(keyboardLayout.DUp)) {\n\t\tcontroller.btns.up = 1;\n\t} else if(key.wasPressed(keyboardLayout.DUp, wasPressedKeyCodes)) {\n\t\tcontroller.btns.up = 0;\n\t}\n\tif (key.isPressed(keyboardLayout.DDown)) {\n\t\tcontroller.btns.down = 1;\n\t} else if(key.wasPressed(keyboardLayout.DDown, wasPressedKeyCodes)) {\n\t\tcontroller.btns.down = 0;\n\t}\n\tif (key.isPressed(keyboardLayout.DLeft)) {\n\t\tcontroller.btns.left = 1;\n\t} else if(key.wasPressed(keyboardLayout.DLeft, wasPressedKeyCodes)) {\n\t\tcontroller.btns.left = 0;\n\t}\n\tif (key.isPressed(keyboardLayout.DRight)) {\n\t\tcontroller.btns.right = 1;\n\t} else if(key.wasPressed(keyboardLayout.DRight, wasPressedKeyCodes)) {\n\t\tcontroller.btns.right = 0;\n\t}\n\n\tif (!settings.analogStickMode) {\n\t\tif (key.isPressed(keyboardLayout.RU)) {\n\t\t\tcontroller.RStick.y = 255;\n\t\t} else if(key.wasPressed(keyboardLayout.RU, wasPressedKeyCodes)) {\n\t\t\tcontroller.RStick.y = restPos;\n\t\t}\n\t\tif (key.isPressed(keyboardLayout.RD)) {\n\t\t\tcontroller.RStick.y = 0;\n\t\t} else if(key.wasPressed(keyboardLayout.RD, wasPressedKeyCodes)) {\n\t\t\tcontroller.RStick.y = restPos;\n\t\t}\n\t\tif (key.isPressed(keyboardLayout.RL)) {\n\t\t\tcontroller.RStick.x = 0;\n\t\t} else if(key.wasPressed(keyboardLayout.RL, wasPressedKeyCodes)) {\n\t\t\tcontroller.RStick.x = restPos;\n\t\t}\n\t\tif (key.isPressed(keyboardLayout.RR)) {\n\t\t\tcontroller.RStick.x = 255;\n\t\t} else if(key.wasPressed(keyboardLayout.RR, wasPressedKeyCodes)) {\n\t\t\tcontroller.RStick.x = restPos;\n\t\t}\n\t} else {\n\t\tlet leftRight = false;\n\t\tlet upDown = false;\n\t\t\n\t\tif (key.isPressed(keyboardLayout.RU)) {\n\t\t\tcontroller.RStick.y = Math.round(parseInt(controller.RStick.y) + settings.stickAttack);\n\t\t}\n\t\tif (key.isPressed(keyboardLayout.RD)) {\n\t\t\tcontroller.RStick.y = Math.round(parseInt(controller.RStick.y) - settings.stickAttack);\n\t\t}\n\t\tif (key.isPressed(keyboardLayout.RL)) {\n\t\t\tcontroller.RStick.x = Math.round(parseInt(controller.RStick.x) - settings.stickAttack);\n\t\t}\n\t\tif (key.isPressed(keyboardLayout.RR)) {\n\t\t\tcontroller.RStick.x = Math.round(parseInt(controller.RStick.x) + settings.stickAttack);\n\t\t}\n\t\t\n\t\tupDown = key.isPressed(keyboardLayout.RU) || key.isPressed(keyboardLayout.RD);\n\t\tleftRight = key.isPressed(keyboardLayout.RL) || key.isPressed(keyboardLayout.RR);\n\t\t\n\t\tif (!upDown) {\n\t\t\tcontroller.RStick.y = Math.round(mathZoom(parseInt(controller.RStick.y), restPos, settings.stickReturn));\n\t\t}\n\t\t\n\t\tif (!leftRight) {\n\t\t\tcontroller.RStick.x = Math.round(mathZoom(parseInt(controller.RStick.x), restPos, settings.stickReturn));\n\t\t}\n\t}\n\n\tif (key.isPressed(keyboardLayout.Minus)) {\n\t\tcontroller.btns.minus = 1;\n\t} else if(key.wasPressed(keyboardLayout.Minus, wasPressedKeyCodes)) {\n\t\tcontroller.btns.minus = 0;\n\t}\n\tif (key.isPressed(keyboardLayout.Plus)) {\n\t\tcontroller.btns.plus = 1;\n\t} else if(key.wasPressed(keyboardLayout.Plus, wasPressedKeyCodes)) {\n\t\tcontroller.btns.plus = 0;\n\t}\n\t\n\tif (key.isPressed(keyboardLayout.Capture)) {\n\t\tcontroller.btns.capture = 1;\n\t} else if(key.wasPressed(keyboardLayout.Capture, wasPressedKeyCodes)) {\n\t\tcontroller.btns.capture = 0;\n\t}\n\tif (key.isPressed(keyboardLayout.Home)) {\n\t\tcontroller.btns.home = 1;\n\t} else if(key.wasPressed(keyboardLayout.Home, wasPressedKeyCodes)) {\n\t\tcontroller.btns.home = 0;\n\t}\n\n\tif (key.isPressed(keyboardLayout.LBtn)) {\n\t\tcontroller.btns.l = 1;\n\t} else if(key.wasPressed(keyboardLayout.LBtn, wasPressedKeyCodes)) {\n\t\tcontroller.btns.l = 0;\n\t}\n\tif (key.isPressed(keyboardLayout.RBtn)) {\n\t\tcontroller.btns.r = 1;\n\t} else if(key.wasPressed(keyboardLayout.RBtn, wasPressedKeyCodes)) {\n\t\tcontroller.btns.r = 0;\n\t}\n\n\tif (key.isPressed(keyboardLayout.ZL)) {\n\t\tcontroller.btns.zl = 1;\n\t} else if(key.wasPressed(keyboardLayout.ZL, wasPressedKeyCodes)) {\n\t\tcontroller.btns.zl = 0;\n\t}\n\tif (key.isPressed(keyboardLayout.ZR)) {\n\t\tcontroller.btns.zr = 1;\n\t} else if(key.wasPressed(keyboardLayout.ZR, wasPressedKeyCodes)) {\n\t\tcontroller.btns.zr = 0;\n\t}\n\n\tif (key.isPressed(keyboardLayout.LStick)) {\n\t\tcontroller.btns.stick_button = 1;\n\t} else if(key.wasPressed(keyboardLayout.LStick, wasPressedKeyCodes)) {\n\t\tcontroller.btns.stick_button = 0;\n\t}\n\tif (key.isPressed(keyboardLayout.RStick)) {\n\t\tcontroller.btns.stick_button2 = 1;\n\t} else if(key.wasPressed(keyboardLayout.RStick, wasPressedKeyCodes)) {\n\t\tcontroller.btns.stick_button2 = 0;\n\t}\n\t\n\twasPressedKeyCodes = key.getPressedKeyCodes();\n\t\n\tlet newControllerState = controller.getState();\n\t\n\tif (newControllerState != oldControllerState) {\n\t\tsettings.currentInputMode = \"keyboard\";\n\t} else {\n\t\tcontroller.inputState(oldControllerState);\n\t}\n}\n\n\n/* prevent arrow key scrolling */\nwindow.addEventListener(\"keydown\", function(e) {\n\t// space and arrow keys\n\tif ([32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {\n\t\te.preventDefault();\n\t}\n\tif ([27].indexOf(e.keyCode) > -1) {\n\t\tdocument.exitPointerLock();\n\t\tdocument.removeEventListener(\"mousemove\", getMouseInput);\n\t\tdocument.removeEventListener(\"mousedown\", getMouseInput2);\n\t\tdocument.removeEventListener(\"mouseup\", getMouseInput2);\n\t\t$(\"#mouseControlsCheckbox\").prop(\"checked\", false).trigger(\"change\");\n\t}\n}, false);\n\n\nfunction getMouseInput(e) {\n\t\n\t// on mouse stop:\n\tclearTimeout(mouseMoveTimer);\n\tmouseMoveTimer = setTimeout(function(){\n\t\tcontroller.RStick.x = restPos;\n\t\tcontroller.RStick.y = restPos;\n\t}, 100);\n\t\n\tvar x = restPos + e.movementX*10;\n\tvar y = restPos - e.movementY*10;\n\t\n\tcontroller.RStick.x = x;\n\tcontroller.RStick.y = y;\n\t\n\tcontroller.RStick.x = tools.minmax(controller.RStick.x, 0, 255);\n\tcontroller.RStick.y = tools.minmax(controller.RStick.y, 0, 255);\n}\n\nfunction getMouseInput2(e) {\n\tlet value = e.type == \"mousedown\" ? 1 : 0;\n\t// left button:\n\tif(e.which === 1) {\n\t\tcontroller.btns.zr = value;\n\t// right button:\n\t} else if (e.which == 3) {\n\t\t//controller.btns.zr = value;\n\t}\n}\n\n// todo: maybe make a virtual canvas w/ $() ? not sure if actual canvas is required\nlet videoCanvas2 = $(\"#videoCanvas2\")[0];\nvideoCanvas2.requestPointerLock = videoCanvas2.requestPointerLock || videoCanvas2.mozRequestPointerLock;\ndocument.exitPointerLock = document.exitPointerLock || document.mozExitPointerLock;\n\n$(\"#mouseControlsCheckbox\").change(function(e) {\n\tif (this.checked) {\n\t\tc.requestPointerLock();\n\t\tdocument.addEventListener(\"mousemove\", getMouseInput, false);\n\t\tdocument.addEventListener(\"mousedown\", getMouseInput2, false);\n\t\tdocument.addEventListener(\"mouseup\", getMouseInput2, false);\n\t} else {\n\t\tdocument.exitPointerLock();\n\t\tdocument.removeEventListener(\"mousemove\", getMouseInput);\n\t\tdocument.removeEventListener(\"mousedown\", getMouseInput2);\n\t\tdocument.removeEventListener(\"mouseup\", getMouseInput2);\n\t}\n});\n\n\n/* GAMEPAD API */\n\nconst gamepad = new Gamepad();\n\ngamepad.on(\"connect\", e => {\n\tconsole.log(`controller ${e.index} connected!`);\n\tgamepadCounter += 1;\n});\n\ngamepad.on(\"disconnect\", e => {\n\tconsole.log(`controller ${e.index} disconnected!`);\n\tgamepadCounter -= 1;\n});\n\ngamepad.on(\"press\", \"button_1\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tif (!settings.TDSConfig) {\n\t\tcontroller.btns.b = 1;\n\t} else {\n\t\tcontroller.btns.a = 1;\n\t}\n});\ngamepad.on(\"release\", \"button_1\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tif (!settings.TDSConfig) {\n\t\tcontroller.btns.b = 0;\n\t} else {\n\t\tcontroller.btns.a = 0;\n\t}\n});\n\ngamepad.on(\"press\", \"button_2\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tif (!settings.TDSConfig) {\n\t\tcontroller.btns.a = 1;\n\t} else {\n\t\tcontroller.btns.b = 1;\n\t}\n});\ngamepad.on(\"release\", \"button_2\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tif (!settings.TDSConfig) {\n\t\tcontroller.btns.a = 0;\n\t} else {\n\t\tcontroller.btns.b = 0;\n\t}\n});\n\ngamepad.on(\"press\", \"button_3\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tif (!settings.TDSConfig) {\n\t\tcontroller.btns.y = 1;\n\t} else {\n\t\tcontroller.btns.x = 1;\n\t}\n});\ngamepad.on(\"release\", \"button_3\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tif (!settings.TDSConfig) {\n\t\tcontroller.btns.y = 0;\n\t} else {\n\t\tcontroller.btns.x = 0;\n\t}\n});\n\ngamepad.on(\"press\", \"button_4\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tif (!settings.TDSConfig) {\n\t\tcontroller.btns.x = 1;\n\t} else {\n\t\tcontroller.btns.y = 1;\n\t}\n});\ngamepad.on(\"release\", \"button_4\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tif (!settings.TDSConfig) {\n\t\tcontroller.btns.x = 0;\n\t} else {\n\t\tcontroller.btns.y = 0;\n\t}\n});\n\n\ngamepad.on(\"press\", \"shoulder_top_left\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.l = 1;\n});\ngamepad.on(\"release\", \"shoulder_top_left\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.l = 0;\n});\n\ngamepad.on(\"press\", \"shoulder_top_right\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.r = 1;\n});\ngamepad.on(\"release\", \"shoulder_top_right\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.r = 0;\n});\n\ngamepad.on(\"press\", \"shoulder_bottom_left\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.zl = 1;\n});\ngamepad.on(\"release\", \"shoulder_bottom_left\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.zl = 0;\n});\n\ngamepad.on(\"press\", \"shoulder_bottom_right\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.zr = 1;\n});\ngamepad.on(\"release\", \"shoulder_bottom_right\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.zr = 0;\n});\n\ngamepad.on(\"press\", \"select\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.minus = 1;\n});\ngamepad.on(\"release\", \"select\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.minus = 0;\n});\ngamepad.on(\"press\", \"start\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.plus = 1;\n});\ngamepad.on(\"release\", \"start\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.plus = 0;\n});\n\n\n\ngamepad.on(\"press\", \"d_pad_up\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tif (settings.dpadSwap) {\n\t\tcontroller.btns.left = 1;\n\t} else {\n\t\tcontroller.btns.up = 1;\n\t}\n});\ngamepad.on(\"release\", \"d_pad_up\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tif (settings.dpadSwap) {\n\t\tcontroller.btns.left = 0;\n\t} else {\n\t\tcontroller.btns.up = 0;\n\t}\n});\n\ngamepad.on(\"press\", \"d_pad_down\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tif (settings.dpadSwap) {\n\t\tcontroller.btns.right = 1;\n\t} else {\n\t\tcontroller.btns.down = 1;\n\t}\n});\ngamepad.on(\"release\", \"d_pad_down\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tif (settings.dpadSwap) {\n\t\tcontroller.btns.right = 0;\n\t} else {\n\t\tcontroller.btns.down = 0;\n\t}\n});\n\ngamepad.on(\"press\", \"d_pad_left\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.left = 1;\n});\ngamepad.on(\"release\", \"d_pad_left\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.left = 0;\n});\n\ngamepad.on(\"press\", \"d_pad_right\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.right = 1;\n});\ngamepad.on(\"release\", \"d_pad_right\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.right = 0;\n});\n\ngamepad.on(\"hold\", \"stick_axis_left\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tlet x = e.value[0] * settings.stickSensitivityX;\n\tlet y = e.value[1] * settings.stickSensitivityY;\n\tx = (x / 2) + 0.5;\n\ty = (-y / 2) + 0.5;\n\tx *= 255;\n\ty *= 255;\n\tcontroller.LStick.x = parseInt(x);\n\tcontroller.LStick.y = parseInt(y);\n\tlet thresh = parseInt($(\"#deadzone\").text());\n\tif (Math.abs(restPos - controller.LStick.x) < thresh) {\n\t\tcontroller.LStick.x = restPos;\n\t}\n\tif (Math.abs(restPos - controller.LStick.y) < thresh) {\n\t\tcontroller.LStick.y = restPos;\n\t}\n});\ngamepad.on(\"press\", \"stick_axis_left\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tlet x = e.value[0] * settings.stickSensitivityX;\n\tlet y = e.value[1] * settings.stickSensitivityY;\n\tx = (x / 2) + 0.5;\n\ty = (-y / 2) + 0.5;\n\tx *= 255;\n\ty *= 255;\n\tcontroller.LStick.x = parseInt(x);\n\tcontroller.LStick.y = parseInt(y);\n\tlet thresh = parseInt($(\"#deadzone\").text());\n\tif (Math.abs(restPos - controller.LStick.x) < thresh) {\n\t\tcontroller.LStick.x = restPos;\n\t}\n\tif (Math.abs(restPos - controller.LStick.y) < thresh) {\n\t\tcontroller.LStick.y = restPos;\n\t}\n});\ngamepad.on(\"release\", \"stick_axis_left\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tlet x = e.value[0] * settings.stickSensitivityX;\n\tlet y = e.value[1] * settings.stickSensitivityY;\n\tx = (x / 2) + 0.5;\n\ty = (-y / 2) + 0.5;\n\tx *= 255;\n\ty *= 255;\n\tcontroller.LStick.x = parseInt(x);\n\tcontroller.LStick.y = parseInt(y);\n\tlet thresh = parseInt($(\"#deadzone\").text());\n\tif (Math.abs(restPos - controller.LStick.x) < thresh) {\n\t\tcontroller.LStick.x = restPos;\n\t}\n\tif (Math.abs(restPos - controller.LStick.y) < thresh) {\n\t\tcontroller.LStick.y = restPos;\n\t}\n});\ngamepad.on(\"hold\", \"stick_axis_right\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tlet x = e.value[0] * settings.stickSensitivityX;\n\tlet y = e.value[1] * settings.stickSensitivityY;\n\tx = (x / 2) + 0.5;\n\ty = (-y / 2) + 0.5;\n\tx *= 255;\n\ty *= 255;\n\tcontroller.RStick.x = parseInt(x);\n\tcontroller.RStick.y = parseInt(y);\n\tlet thresh = parseInt($(\"#deadzone\").text());\n\tif (Math.abs(restPos - controller.RStick.x) < thresh) {\n\t\tcontroller.RStick.x = restPos;\n\t}\n\tif (Math.abs(restPos - controller.RStick.y) < thresh) {\n\t\tcontroller.RStick.y = restPos;\n\t}\n});\ngamepad.on(\"press\", \"stick_axis_right\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tlet x = e.value[0] * settings.stickSensitivityX;\n\tlet y = e.value[1] * settings.stickSensitivityY;\n\tx = (x / 2) + 0.5;\n\ty = (-y / 2) + 0.5;\n\tx *= 255;\n\ty *= 255;\n\tcontroller.RStick.x = parseInt(x);\n\tcontroller.RStick.y = parseInt(y);\n\tlet thresh = parseInt($(\"#deadzone\").text());\n\tif (Math.abs(restPos - controller.RStick.x) < thresh) {\n\t\tcontroller.RStick.x = restPos;\n\t}\n\tif (Math.abs(restPos - controller.RStick.y) < thresh) {\n\t\tcontroller.RStick.y = restPos;\n\t}\n});\ngamepad.on(\"release\", \"stick_axis_right\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tlet x = e.value[0] * settings.stickSensitivityX;\n\tlet y = e.value[1] * settings.stickSensitivityY;\n\tx = (x / 2) + 0.5;\n\ty = (-y / 2) + 0.5;\n\tx *= 255;\n\ty *= 255;\n\tcontroller.RStick.x = parseInt(x);\n\tcontroller.RStick.y = parseInt(y);\n\tlet thresh = parseInt($(\"#deadzone\").text());\n\tif (Math.abs(restPos - controller.RStick.x) < thresh) {\n\t\tcontroller.RStick.x = restPos;\n\t}\n\tif (Math.abs(restPos - controller.RStick.y) < thresh) {\n\t\tcontroller.RStick.y = restPos;\n\t}\n});\n\ngamepad.on(\"press\", \"stick_button_left\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.stick_button = 1;\n});\ngamepad.on(\"release\", \"stick_button_left\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.stick_button = 0;\n});\ngamepad.on(\"press\", \"stick_button_right\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.stick_button2 = 1;\n});\ngamepad.on(\"release\", \"stick_button_right\", e => {\n\tsettings.currentInputMode = \"controller\";\n\tcontroller.btns.stick_button2 = 0;\n});\n\n\nfunction getGamepadInput() {\n\n\tif (!$(\"#controllerControlsCheckbox\")[0].checked) {\n\t\treturn;\n\t}\n\tauthCookie = tools.getCookie(\"TwitchPlaysNintendoSwitch\");\n\tif (authCookie == null) {\n\t\t$(\"#controllerControlsCheckbox\").prop(\"checked\", false).trigger(\"change\");\n\t\tswal({\n\t\t\ttitle: \"You need to login! Redirecting you now!\",\n\t\t}).then((result) => {\n\t\t\tif (result.value) {\n\t\t\t\twindow.location.href = \"https://twitchplaysnintendoswitch.com/8110/auth/twitch/\";\n\t\t\t}\n\t\t});\n\t\treturn;\n\t} else {\n\t\tauthCookie = authCookie.split(\" \")[0].replace(/;/g, \"\");\n\t}\n}\n\n\n\n/* more gamepad support */\n// let gamepads = {};\n\n// function gamepadHandler(event, connecting) {\n// \tlet gamepad = event.gamepad;\n// \t// Note:\n// \t// gamepad === navigator.getGamepads()[gamepad.index]\n\n// \tif (connecting) {\n// \t\tgamepads[gamepad.index] = gamepad;\n// \t} else {\n// \t\tdelete gamepads[gamepad.index];\n// \t}\n// }\n\n\n// function pollGamepads() {\n// \tlet gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads : []);\n// \tfor (let i = 0; i < gamepads.length; i++) {\n// \t\tlet gp = gamepads[i];\n// \t\tif (gp) {\n// \t\t\t//console.log(gp.axes[4] + \" \" + gp.axes[9]);\n// \t\t\tconsole.log(gp);\n// // \t\t\tgamepadInfo.innerHTML = \"Gamepad connected at index \" + gp.index + \": \" + gp.id +\n// // \t\t\t\t\". It has \" + gp.buttons.length + \" buttons and \" + gp.axes.length + \" axes.\";\n// // \t\t\tclearInterval(interval);\n// \t\t}\n// \t}\n// }\n// setInterval(pollGamepads, 1000);\n\n// window.addEventListener(\"gamepadconnected\", function(e) { gamepadHandler(e, true); }, false);\n// window.addEventListener(\"gamepaddisconnected\", function(e) { gamepadHandler(e, false); }, false);\n\n\n\n\n\n\n\n\n\n/* KEYBOARD CONFIG */\n\n\n// Get stored preferences\n// \tlocalforage.getItem(\"keyboardLayout\").then(function(value) {\n// \t\t// If they exist, write them\n// \t\tif (value) {\n// \t\t\tkeyboardLayout = value;\n// \t\t}\n// \t\t// Store the preferences (so that the default values get stored)\n// \t\tlocalforage.setItem(\"keyboardLayout\", keyboardLayout);\n// \t\t// Update the keyboard layout settings window to reflect the stored settings, not the default ones\n// \t\tfor (let i = 0; i < $(\".buttonConfig\").length; i++) {\n// \t\t\tlet div = $(\".buttonConfig\")[i];\n// \t\t\tlet assignedKey = keyboardLayout[div.id];\n// \t\t\t$(\"#\" + div.id).html(String.fromCharCode(assignedKey).toLowerCase());\n// \t\t}\n// \t});\n\n\n\n/* SAVABLE SETTINGS */\n\n// restore preferences:\n$(document).ready(function() {\n\t\n\tconsole.log(\"restoring preferences\");\n\t\n\t// check if new:\n\tlocalforage.getItem(\"new\").then(function(value) {\n\t\tif (value != \"new\") {\n\t\t\t$(\"#tutorialWindow\").modal();\n\t\t}\n\t\tlocalforage.setItem(\"new\", \"new\");\n\t});\n\t\n\t// check for ads:\n// \tlocalforage.getItem(\"ads\").then(function(value) {\n// \t\tif (value != \"ads\") {\n// \t\t\tif (typeof canRunAds == \"undefined\") {\n// \t\t\t\tconsole.log(\"test\");\n// \t\t\t\tswal({\n// \t\t\t\t\ttitle: \"Disable your adblocker! or don\\'t ¯\\\\_(ツ)_/¯ This message won't appear again!\",\n// \t\t\t\t});\n// \t\t\t}\n// \t\t}\n// \t\tlocalforage.setItem(\"ads\", \"ads\");\n// \t});\n\t\n\t// Get stored preferences\n\tlocalforage.getItem(\"settings\").then(function(value) {\n\t\t// If they exist, write them\n\t\tif (typeof value != \"undefined\") {\n\t\t\tsettings = Object.assign({}, settings, JSON.parse(value));\n\t\t}\n\t\t// Store the preferences (so that the default values get stored)\n\t\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\t\t\n\t\t// debug:\n\t\tconsole.log(settings);\n\t\t\n\t\tif (settings.tab != 1) {\n\t\t\t$(\"#tab\" + settings.tab).trigger(\"click\");\n\t\t}\n\t\tif (settings.tab == 1) {\n\t\t\tswitchTabs(\"#lagless1\");\n\t\t}\n\t\taddJoyCons(\"#lagless\" + settings.tab);\n\t\t\n\t\trebindUnbindTouchControls();\n\t\tclearAndReplaceProfiles();\n\t\tsetKeyboardMapperClasses();\n\t\t\n\t\tsetTimeout(drawJoyCons, 2000);\n\t\t\n\t\tif (settings.keyboardControls) {\n\t\t\t$(\"#keyboardControlsCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\tif (settings.controllerControls) {\n\t\t\t$(\"#controllerControlsCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\tif (settings.touchControls) {\n\t\t\t$(\"#touchControlsCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n// \t\tif (settings.mouseControls) {\n// \t\t\t$(\"#mouseControlsCheckbox\").prop(\"checked\", true).trigger(\"change\");\n// \t\t}\n\t\tif (settings.analogStickMode) {\n\t\t\t$(\"#analogStickCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\tif (settings.dpadSwap) {\n\t\t\t$(\"#dpadCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\tif (settings.TDSConfig) {\n\t\t\t$(\"#3DSCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\tif (settings.enableAudioThree) {\n\t\t\t$(\"#enableAudioThreeCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\tif (settings.enableAudioThree && settings.audioThree) {\n\t\t\t$(\"#audioThreeCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\t\n\t\tif (settings.darkTheme) {\n\t\t\t$(\"#darkThemeCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\tif (settings.fullscreen) {\n\t\t\t$(\"#fullscreenCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\tif (settings.largescreen) {\n\t\t\t$(\"#largescreenCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\tif (settings.youtubeChat) {\n\t\t\t$(\"#youtubeChatCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\tif (settings.hideChat) {\n\t\t\t$(\"#hideChatCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\tif (settings.hideNav) {\n\t\t\t$(\"#navCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\t\n\t\t$(\"#deadzoneSlider\").slider(\"value\", settings.deadzone);\n\t\t$(\"#deadzone\").text(settings.deadzone);\n\n\t\t$(\"#stickSensitivitySlider\").slider(\"value\", settings.stickSensitivityX);\n\t\t$(\"#sensitivity\").text(settings.stickSensitivityX);\n\t\t\n\t\t$(\"#stickAttackSlider\").slider(\"value\", settings.stickAttack);\n\t\t$(\"#attack\").text(settings.stickAttack);\n\t\t\n\t\t$(\"#stickReturnSlider\").slider(\"value\", settings.stickReturn);\n\t\t$(\"#return\").text(settings.stickReturn);\n\t\t\n\t\t// volume:\n\t\t$(\"#lagless1Volume\").slider(\"value\", settings.volume);\n\t\t$(\"#lagless2Volume\").slider(\"value\", settings.volume);\n\t\t$(\"#lagless3Volume\").slider(\"value\", settings.volume);\n\t\t$(\"#lagless4Volume\").slider(\"value\", settings.volume);\n\t\tsetTimeout(function() {\n\t\t\ttry {\n\t\t\t\tplayer.volume = settings.volume / 100;// doesn't update automatically :/\n\t\t\t} catch (error) {\n\t\t\t}\n\t\t\ttry {\n\t\t\t\taudio.volume = settings.volume / 100;// doesn't update automatically :/\n\t\t\t} catch (error) {\n\t\t\t}\n\t\t}, 2000);\n\t\t$(\".audioThreeCheckbox\").prop(\"checked\", $(\"#audioThreeCheckbox\").prop(\"checked\"));\n\t\t\n\t\t/* AUTH  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */\n\t\tauthCookie = tools.getCookie(\"TwitchPlaysNintendoSwitch\");\n\t\tif (authCookie != null) {\n\t\t\tauthCookie = authCookie.split(\" \")[0].replace(/;/g, \"\");\n\t\t\tsocket.emit(\"registerAccount\", {auth: authCookie, usernameIndex: settings.usernameIndex});\n\t\t\t$(\"#authenticateButton\").remove();\n\t\t} else {\n\t\t\t// replace with twitch until signed in:\n\t\t\treplaceWithTwitch(\"#lagless\" + settings.tab);\n\t\t\t$(\"#tab1\").addClass(\"disabled\");\n\t\t\t$(\"#tab3\").addClass(\"disabled\");\n\t\t\t$(\"#tab4\").addClass(\"disabled\");\n\t\t\t// remove the logout button:\n\t\t\t$(\"#logout\").remove();\n// \t\t\t$(\"#loggedInStatus\").css(\"width\", \"100%\");\n// \t\t\t$(\"#loggedInStatus\").text(\"Not logged in.\");\n\t\t\t$(\"#loggedInStatus\").remove();\n\t\t\t\n\t\t\t$(\".disabled\").on(\"click\", function() {\n\t\t\t\tswal(\"You need to sign in first!\");\n\t\t\t});\n\t\t}\n\t\t\n\t\t// fit text:\n// \t\tfitText(\".requestTurn\", 1.5, { minFontSize: \"10px\", maxFontSize: \"20px\" });\n// \t\tfitText(\".cancelTurn\", 1.5, { minFontSize: \"10px\", maxFontSize: \"20px\" });\n// \t\tfitText(\".list-group-item\", 1.5, { minFontSize: \"10px\", maxFontSize: \"20px\" });\n// // \t\tfitText(\"#loggedInIndicator\", 2.5, { minFontSize: \"10px\", maxFontSize: \"20px\" });\n\t\t\n// \t\tfitText(\"#lButton\", 0.5, { minFontSize: \"10px\", maxFontSize: \"20px\" });\n// \t\tfitText(\"#zlButton\", 0.5, { minFontSize: \"10px\", maxFontSize: \"20px\" });\n// \t\tfitText(\"#rButton\", 0.5, { minFontSize: \"10px\", maxFontSize: \"20px\" });\n// \t\tfitText(\"#zrButton\", 0.5, { minFontSize: \"10px\", maxFontSize: \"20px\" });\n\t\t\n// \t\tfitText(\".collapseButton\", 0.2, { minFontSize: \"10px\", maxFontSize: \"16px\" });\n\t\t\n// \t\tfitText(\".resolutionButton\", 0.2, { minFontSize: \"8px\", maxFontSize: \"16px\" });\n// \t\tfitText(\".fpsButton\", 0.25, { minFontSize: \"8px\", maxFontSize: \"16px\" });\n\t\t\n\t\t\n// \t\tresizers.push(textFitPercent({selector: \"#lagless2KeyboardDropdown\", percentWidth: 20, isFirstChild: true, parent: \"#lagless2Bar\"}));\n\t\t\n// \t\tresizers.push(textFitPercent({\n// \t\t\tselector: \".keyboardDropdown\",\n// \t\t\tparent: \".laglessBar\",\n// \t\t\tpercentWidth: 20,\n// \t\t\tisFirstChild: true,\n// \t\t\tisClass: true,\n// \t\t\tmaxTries: 20,\n// \t\t\tincrement: 0.2,\n// \t\t}));\n\t\t\n\t\tresizers.push(textFitPercent({\n\t\t\tselector: \"#lagless2KeyboardDropdown\",\n\t\t\tparent: \"#lagless2Bar\",\n\t\t\tpercentWidth: 20,\n\t\t\tisFirstChild: true,\n\t\t\tisClass: true,\n\t\t\tmaxTries: 20,\n\t\t\tincrement: 0.2,\n\t\t}));\n\t\t\n\t\tresizers.push(textFitPercent({\n\t\t\tselector: \"#lagless2ViewerDropdown\",\n\t\t\tparent: \"#lagless2Bar\",\n\t\t\tpercentWidth: 12,\n\t\t\tisFirstChild: true,\n\t\t\tmaxTries: 20,\n\t\t\tincrement: 0.2,\n\t\t\tmaxFontSize: 20,\n\t\t}));\n\t\t\n\t\t\n\t\tresizers.push(textFitPercent({\n\t\t\tselector: \"#lagless2Refresh\",\n\t\t\tparent: \"#lagless2Bar\",\n\t\t\tpercentWidth: 8,\n// \t\t\tisFirstChild: true,\n\t\t\tmaxTries: 20,\n\t\t\tincrement: 0.2,\n\t\t\taccuracy: 5,\n\t\t\tmaxFontSize: 30,\n\t\t}));\n\t\t\n\t\tresizers.push(textFitPercent({\n\t\t\tselector: \"#lagless2KeyboardSettings\",\n\t\t\tparent: \"#lagless2Bar\",\n\t\t\tpercentWidth: 8,\n// \t\t\tisFirstChild: true,\n\t\t\tmaxTries: 20,\n\t\t\tincrement: 0.2,\n\t\t\taccuracy: 5,\n\t\t\tmaxFontSize: 30,\n\t\t}));\n\t\t\n\t\tresizers.push(textFitPercent({\n\t\t\tselector: \"#hidePlayers\",\n\t\t\tparent: \"#playersContainer\",\n\t\t\tpercentWidth: 5,\n// \t\t\tisFirstChild: true,\n\t\t\tmaxTries: 20,\n\t\t\tincrement: 0.2,\n\t\t\taccuracy: 5,\n\t\t\tmaxFontSize: 20,\n\t\t}));\n\t\t\n\t\tfor (let i = 0; i < resizers.length; i++) {\n\t\t\tresizers[i].resize();\n\t\t}\n\t\t\n// \t\tsetTimeout(resizeChat, 2000);\n\t\t\n\t\t\n\t\t// wait a little longer so the joycon images load:\n\t\tsetTimeout(function() {\n\t\t\t$(\"body\").addClass(\"loaded\");\n\t\t\t// after animation is done:\n\t\t\tsetTimeout(function() {\n\t\t\t\t$(\".loaded #loader-wrapper\")[0].style.visibility = \"hidden\";\n\t\t\t}, 500);\n\t\t}, 1000);\n\t\t\n\t\t/* DISCORD EMBED */\n// \t\tcrate = new Crate({\n// \t\t\tserver: \"433874668534104065\",\n// \t\t\tchannel: \"487328538173767692\",\n// \t\t\tshard: \"https://cl2.widgetbot.io\",\n// \t\t});\n\t\t\n\t});\n});\n\n\nfunction setKeyboardMapperClasses() {\n\n\t\n}\n\n$(\"#keyboard li\").on(\"click\", function(event) {\n\t\n});\n\n// https://stackoverflow.com/questions/10000083/javascript-event-handler-with-parameters\n\nfunction keyDownHandler(event) {\n\t\n\tkeyDownHandler.element = keyDownHandler.element || \"\";\n\t\n\tlet keyString = keycode(event);\n\tkeyDownHandler.element.text(keyString);\n\t\n\tlet buttonKey = keyDownHandler.element.attr(\"id\").slice(0, -3);\n\tkeyboardLayout[buttonKey] = keyString;\n\t\n\t\n\t\n\tdocument.removeEventListener(\"keydown\", keyDownHandler, false);\n}\n\n\n$(\"#keyboardConfigKeys li\").on(\"click\", function(event) {\n\t\n\tlet self = $(this);\n\t\n\t$(this).effect(\"highlight\", {}, 2000);\n\t\n\tdocument.removeEventListener(\"keydown\", keyDownHandler, false);\n\tdocument.addEventListener(\"keydown\", keyDownHandler, false);\n\t\n\tkeyDownHandler.element = self;\n});\n\n\n\n$(\"#resetBindings\").on(\"click\", function(event) {\n\t\n});\n\n$(\"#defaultBindings\").on(\"click\", function(event) {\n\tkeyboardLayout.tempSelectedAction = \"\";\n\tkeyboardLayout.tempSelectedKey = \"\";\n\tkeyboardLayout.LU = \"W\";\n\tkeyboardLayout.LD = \"S\";\n\tkeyboardLayout.LL = \"A\";\n\tkeyboardLayout.LR = \"D\";\n\tkeyboardLayout.RU = \"I\";\n\tkeyboardLayout.RD = \"K\";\n\tkeyboardLayout.RL = \"J\";\n\tkeyboardLayout.RR = \"L\";\n\tkeyboardLayout.ABtn = \"right\";\n\tkeyboardLayout.BBtn = \"down\";\n\tkeyboardLayout.XBtn = \"up\";\n\tkeyboardLayout.YBtn = \"left\";\n\tkeyboardLayout.DUp = \"T\";\n\tkeyboardLayout.DDown = \"G\";\n\tkeyboardLayout.DLeft = \"F\";\n\tkeyboardLayout.DRight = \"H\";\n\tkeyboardLayout.LStick = \"R\";\n\tkeyboardLayout.RStick = \"Y\";\n\tkeyboardLayout.LBtn = \"U\";\n\tkeyboardLayout.ZL = \"Q\";\n\tkeyboardLayout.RBtn = \"O\";\n\tkeyboardLayout.ZR = \"E\";\n\tkeyboardLayout.Minus = \"-\";\n\tkeyboardLayout.Plus = \"=\";\n\tkeyboardLayout.Capture = \"1\";\n\tkeyboardLayout.Home = \"2\";\n\tsetKeyboardMapperClasses();\n});\n\n\n/* KEYBOARD PROFILES */\n\n$(\"#createProfile\").on(\"click\", function(event) {\n\tevent.preventDefault();\n\tlet profileName = $(\"#profileName\").val();\n\tif (profileName === \"\") {\n\t\tswal(\"The profile name cannot be empty!\", \"\", \"error\");\n\t\treturn;\n\t} else {\n\t\tsettings.keyboardProfiles[profileName] = keyboardLayout;\n\t\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\t\tclearAndReplaceProfiles();\n\t\tswal(\"Profile created successfully!\", \"\", \"success\");\n\t}\n\t$(\"#profileName\").val(\"\");\n});\n\n$(\"#deleteProfiles\").on(\"click\", function(event) {\n\tevent.preventDefault();\n\tsettings.keyboardProfiles = {};\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\tswal(\"Profiles deleted successfully!\", \"\", \"success\");\n});\n\nfunction clearAndReplaceProfiles() {\n\t// clear the dropdown menu\n\t$(\".keyboard-dropdown-menu\").children().remove();\n\t// fill it with profiles:\n\tfor (let key in settings.keyboardProfiles) {\n\t\tlet optionHTML = \"<button class='keyboard-dropdown-item'\" + \" config='\" + JSON.stringify(settings.keyboardProfiles[key]) + \"'>\" + key + \"</button>\";\n\t\t$(\".keyboard-dropdown-menu\").append(optionHTML);\n\t}\n\t\n\t$(\".keyboard-dropdown-item\").on(\"click\", function(event) {\n\t\tlet configName = $(event.target).text();\n\t\t$(\"#dropdownMenuLink\").text(configName);\n\t\tkeyboardLayout = JSON.parse($(event.target).attr(\"config\"));\n\t\tsetKeyboardMapperClasses();\n\t});\n}\n\n\n\nlet leftJoyConImage;\nlet rightJoyConImage;\n\n\n/* TOUCH CONTROLS */\nfunction drawJoyCons() {\n\tlet leftJoyConCanvas = $(\"#leftJoyConCanvas\")[0];\n\tleftJoyConCanvas.width = 500;\n\tleftJoyConCanvas.height = 500;\n\tlet leftJoyConCtx = leftJoyConCanvas.getContext(\"2d\");\n\t/*let */leftJoyConImage = new Image();\n\tleftJoyConImage.onload = function() {\n\t\tlet imgWidth = leftJoyConImage.width;\n\t\tlet imgHeight = leftJoyConImage.height;\n\t\tlet canvasWidth = leftJoyConCanvas.width;\n\t\tlet canvasHeight = leftJoyConCanvas.height;\n\t\tlet ratio = (imgHeight / imgWidth);\n\t\tlet canvasRatio = canvasWidth / canvasHeight;\n\t\tlet ratioW = 500 / $(\"#leftJoyConCanvas\").innerWidth();\n\t\tlet ratioH = 500 / $(\"#leftJoyConCanvas\").innerHeight();\n\t\tlet cWidth = $(\"#leftJoyConCanvas\").innerWidth();\n\t\tleftJoyConCtx.clearRect(0, 0, canvasWidth, canvasHeight);\n\t\tleftJoyConCtx.drawImage(leftJoyConImage, 0, 0, cWidth * ratioW, cWidth * ratio * ratioH);\n\t};\n\tleftJoyConImage.src = \"https://twitchplaysnintendoswitch.com/images/leftJoyCon2.png\";\n\n\tlet rightJoyConCanvas = $(\"#rightJoyConCanvas\")[0];\n\trightJoyConCanvas.width = 500;\n\trightJoyConCanvas.height = 500;\n\tlet rightJoyConCtx = rightJoyConCanvas.getContext(\"2d\");\n\t/*let */rightJoyConImage = new Image();\n\trightJoyConImage.onload = function() {\n\t\tlet imgWidth = rightJoyConImage.width;\n\t\tlet imgHeight = rightJoyConImage.height;\n\t\tlet canvasWidth = rightJoyConCanvas.width;\n\t\tlet canvasHeight = rightJoyConCanvas.height;\n\t\tlet ratio = (imgHeight / imgWidth);\n\t\tlet canvasRatio = canvasWidth / canvasHeight;\n\t\tlet ratioW = 500 / $(\"#rightJoyConCanvas\").innerWidth();\n\t\tlet ratioH = 500 / $(\"#rightJoyConCanvas\").innerHeight();\n\t\tlet cWidth = $(\"#rightJoyConCanvas\").innerWidth();\n\t\trightJoyConCtx.clearRect(0, 0, canvasWidth, canvasHeight);\n\t\trightJoyConCtx.drawImage(rightJoyConImage, 0, 0, cWidth * ratioW, cWidth * ratio * ratioH);\n\t};\n\trightJoyConImage.src = \"https://twitchplaysnintendoswitch.com/images/rightJoyCon2.png\";\n}\n\nfunction setVideoWidth(width) {\n\tif (typeof $(\"#videoCanvas1\")[0] != \"undefined\") {\n\t\t$(\"#videoCanvas1\")[0].style.width = width + \"%\";\n\t\t$(\"#videoCanvas1\")[0].style[\"margin-left\"] = ((100-width)/2) + \"%\";\n\t}\n\tif (typeof $(\"#videoCanvas2\")[0] != \"undefined\") {\n\t\t$(\"#videoCanvas2\")[0].style.width = width + \"%\";\n\t\t$(\"#videoCanvas2\")[0].style[\"margin-left\"] = ((100-width)/2) + \"%\";\n\t}\n\tif (typeof $(\"#videoCanvas3\")[0] != \"undefined\") {\n\t\t$(\"#videoCanvas3\")[0].style.width = width + \"%\";\n\t\t$(\"#videoCanvas3\")[0].style[\"margin-left\"] = ((100-width)/2) + \"%\";\n\t}\n\tif (typeof $(\"#videoCanvas4\")[0] != \"undefined\") {\n\t\t$(\"#videoCanvas4\")[0].style.width = width + \"%\";\n\t\t$(\"#videoCanvas4\")[0].style[\"margin-left\"] = ((100-width)/2) + \"%\";\n\t}\n\tif (typeof $(\"#videoCanvas5\")[0] != \"undefined\") {\n\t\t$(\"#videoCanvas5\")[0].style.width = width + \"%\";\n\t\t$(\"#videoCanvas5\")[0].style[\"margin-left\"] = ((100-width)/2) + \"%\";\n\t}\n\t\n\tif (typeof $(\"#twitchVideo\")[0] != \"undefined\") {\n\t\t$(\"#twitchVideo\")[0].style.width = width + \"%\";\n\t\t$(\"#twitchVideo\")[0].style[\"margin-left\"] = ((100-width)/2) + \"%\";\n\t\t// calculate height for twitch:\n// \t\tlet containerWidth = $(\"#lagless1Container\").width() + $(\"#lagless2Container\").width() + $(\"#lagless3Container\").width() + $(\"#lagless4Container\").width() + $(\"#lagless5Container\").width();\n// \t\t$(\"#twitchVideo\")[0].style.height = (width/100) * (9/16) * containerWidth;\n\t\t$(\"#twitchVideo\")[0].style.height = $(\"#twitchVideo\").width() * (9/16);\n\t}\n\tif (typeof $(\".twitchVideo\")[0] != \"undefined\") {\n\t\t$(\".twitchVideo\")[0].style.width = width + \"%\";\n\t\t$(\".twitchVideo\")[0].style[\"margin-left\"] = ((100-width)/2) + \"%\";\n\t\t// calculate height for twitch:\n// \t\tlet containerWidth = $(\"#lagless1Container\").width() + $(\"#lagless2Container\").width() + $(\"#lagless3Container\").width() + $(\"#lagless4Container\").width() + $(\"#lagless5Container\").width();\n// \t\t$(\".twitchVideo\")[0].style.height = (width/100) * (9/16) * containerWidth;\n\t\t$(\"#twitchVideo\")[0].style.height = $(\"#twitchVideo\").width() * (9/16);\n\t}\n\t\n\t$(\"#rightJoyCon\")[0].style[\"margin-left\"] = (width) + ((100-width)/2) + \"%\";\n\t$(\"#leftJoyCon\")[0].style.width = ((100-width)/2) + \"%\";\n\t$(\"#rightJoyCon\")[0].style.width = ((100-width)/2) + \"%\";\n\tleftJoyConImage.src = \"https://twitchplaysnintendoswitch.com/images/leftJoyCon2.png\";\n\trightJoyConImage.src = \"https://twitchplaysnintendoswitch.com/images/rightJoyCon2.png\";\n}\n\nfunction resizeChat() {\n// \tlet height = 0;\n// \theight += $(\".videoCanvas\").addUp($.fn.outerHeight);\n// // \theight += $(\".laglessBar\").addUp($.fn.outerHeight);\n// \theight += ($(\"#navTabs\").outerHeight());\n// \theight -= ($(\"#loggedInContainer\").outerHeight());\n// \theight += 10;// adjust\n// \t$(\"#chat\").height(height);\n}\n\n/* JOYSTICKS @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\nlet leftJoyStick = {\n\tzone: document.querySelector(\"#leftStick\"),\n\tmode: \"static\",\n\tcatchDistance: 10,\n\tcolor: \"#FF3C28\",\n\tposition: {left: \"50%\", top: \"50%\"},\n\tsize: 60,\n};\nlet rightJoyStick = {\n\tzone: document.querySelector(\"#rightStick\"),\n\tmode: \"static\",\n\tcatchDistance: 10,\n\tcolor: \"#0AB9E6\",\n\tposition: {left: \"50%\", top: \"50%\"},\n\tsize: 60,\n};\n\nlet leftStick;\nlet rightStick;\n\nfunction bindJoysticks() {\n\tlet stickSize = 60;\n\tlet s1 = stickSize;\n\tlet s2 = stickSize/2;\n\tleftStick.on(\"start\", function(evt, data) {\n\t\tlet pos = data.frontPosition;\n\t\tpos.x = parseInt(((pos.x + s2) / s1) * 255);\n\t\tpos.y = parseInt(((pos.y + s2) / s1) * 255);\n\t\tpos.y = 255 - pos.y;\n\t\tcontroller.LStick.x = pos.x;\n\t\tcontroller.LStick.y = pos.y;\n\t}).on(\"end\", function(evt, data) {\n\t\tcontroller.LStick.x = restPos;\n\t\tcontroller.LStick.y = restPos;\n\t}).on(\"move\", function(evt, data) {\n\t\tlet pos = data.instance.frontPosition;\n\t\tpos.x = parseInt(((pos.x + s2) / s1) * 255);\n\t\tpos.y = parseInt(((pos.y + s2) / s1) * 255);\n\t\tpos.y = 255 - pos.y;\n\t\tcontroller.LStick.x = pos.x;\n\t\tcontroller.LStick.y = pos.y;\n\t})\n\n\trightStick.on(\"start\", function(evt, data) {\n\t\tlet pos = data.frontPosition;\n\t\tpos.x = parseInt(((pos.x + s2) / s1) * 255);\n\t\tpos.y = parseInt(((pos.y + s2) / s1) * 255);\n\t\tpos.y = 255 - pos.y;\n\t\tcontroller.RStick.x = pos.x;\n\t\tcontroller.RStick.y = pos.y;\n\t}).on(\"end\", function(evt, data) {\n\t\tcontroller.RStick.x = restPos;\n\t\tcontroller.RStick.y = restPos;\n\t}).on(\"move\", function(evt, data) {\n\t\tlet pos = data.instance.frontPosition;\n\t\tpos.x = parseInt(((pos.x + s2) / s1) * 255);\n\t\tpos.y = parseInt(((pos.y + s2) / s1) * 255);\n\t\tpos.y = 255 - pos.y;\n\t\tcontroller.RStick.x = pos.x;\n\t\tcontroller.RStick.y = pos.y;\n\t})\n}\n// leftStick = nipplejs.create(leftJoyStick);\n// rightStick = nipplejs.create(rightJoyStick);\n// bindJoysticks();\n\n\nfunction getTouchInput() {\n\tif (!$(\"#touchControlsCheckbox\")[0].checked) {\n\t\treturn;\n\t}\n// \tauthCookie = tools.getCookie(\"TwitchPlaysNintendoSwitch\");\n// \tif (authCookie == null) {\n// \t\t$(\"#touchControlsCheckbox\").prop(\"checked\", false).trigger(\"change\");\n// \t\tswal({\n// \t\t\ttitle: \"You need to login! Redirecting you now!\",\n// \t\t}).then((result) => {\n// \t\t\tif (result.value) {\n// \t\t\t\twindow.location.href = \"https://twitchplaysnintendoswitch.com/8110/auth/twitch/\";\n// \t\t\t}\n// \t\t});\n// \t\treturn;\n// \t} else {\n// \t\tauthCookie = authCookie.split(\" \")[0].replace(/;/g, \"\");\n// \t}\n\t//controller.reset();\n}\n\n\nfunction onButtonPress(event) {\n\t\n\tevent.preventDefault();\n\t\n\tsettings.currentInputMode = \"touch\";\n\t\n\tif (!$(\"#touchControlsCheckbox\")[0].checked) {return;}\n\tif (event.target.id == null) {return;}\n\tif (event.target.id == \"dpadButtons\" || event.target.id == \"abxyButtons\") {return;}\n\t\n\tlet value = 0;\n\tif (event.type == \"mousedown\" || event.type == \"touchstart\" || event.type == \"pointerdown\") {\n\t\tvalue = 1;\n\t\t//swal(\"touchstart\");\n\t} else if (event.type == \"mouseup\" || event.type == \"mouseleave\" || event.type == \"touchend\" || event.type == \"pointerup\" || event.type == \"pointerout\") {\n\t\tvalue = 0;\n\t\t//swal(\"touchend\");\n\t} else if (event.type == \"touchmove\") {\n\t\t// todo: make an equivalent to mouseleave since touchleave doesn't exist :/\n\t}\n\t\n\t\n\tlet button = event.target.id;\n\t\n\tlet oldState = JSON.stringify(controller);\n\t\n\tswitch(button) {\n\t\tcase \"upButton\":\n\t\t\tcontroller.btns.up = value;\n\t\t\tbreak;\n\t\tcase \"downButton\":\n\t\t\tcontroller.btns.down = value;\n\t\t\tbreak;\n\t\tcase \"leftButton\":\n\t\t\tcontroller.btns.left = value;\n\t\t\tbreak;\n\t\tcase \"rightButton\":\n\t\t\tcontroller.btns.right = value;\n\t\t\tbreak;\n\t\tcase \"aButton\":\n\t\t\tcontroller.btns.a = value;\n\t\t\tbreak;\n\t\tcase \"bButton\":\n\t\t\tcontroller.btns.b = value;\n\t\t\tbreak;\n\t\tcase \"xButton\":\n\t\t\tcontroller.btns.x = value;\n\t\t\tbreak;\n\t\tcase \"yButton\":\n\t\t\tcontroller.btns.y = value;\n\t\t\tbreak;\n\t\t\t\n\t\tcase \"lButton\":\n\t\t\tcontroller.btns.l = value;\n\t\t\tbreak;\n\t\tcase \"zlButton\":\n\t\t\tcontroller.btns.zl = value;\n\t\t\tbreak;\n\t\tcase \"rButton\":\n\t\t\tcontroller.btns.r = value;\n\t\t\tbreak;\n\t\tcase \"zrButton\":\n\t\t\tcontroller.btns.zr = value;\n\t\t\tbreak;\n\n\t\tcase \"minusButton\":\n\t\t\tcontroller.btns.minus = value;\n\t\t\tbreak;\n\t\tcase \"captureButton\":\n\t\t\tcontroller.btns.capture = value;\n\t\t\tbreak;\n\t\t\t\n\t\tcase \"plusButton\":\n\t\t\tcontroller.btns.plus = value;\n\t\t\tbreak;\n\t\tcase \"homeButton\":\n\t\t\tcontroller.btns.home = value;\n\t\t\tbreak;\n\t}\n\t\n\tlet newState = JSON.stringify(controller);\n\t\n\tif (newState == oldState) {\n\t\treturn;\n\t}\n\t\n\tif(controlQueue1.indexOf(myUniqueID) == -1) {\n\t\tsocket.emit(\"requestTurn\", currentPlayerChosen);\n\t\tlet html = '<button id=\"cancelTurn' + (currentPlayerChosen + 1) + '\" class=\"cancelTurn btn btn-secondary\" code=\"' + currentPlayerChosen + '\">Leave Queue</button>';\n\t\t$(\"#requestTurn\" + (currentPlayerChosen + 1)).replaceWith(html);\n\t}\n}\n\nfunction rebindUnbindTouchControls() {\n\tlet buttonsList = [\"#dpadButtons\", \"#abxyButtons\", \"#leftJoyConOther\", \"#rightJoyConOther\"];\n\t\n\tif (settings.touchControls) {\n\t\t\n\t\ttry {\n\t\t\t$(\"#leftJoyCon\")[0].style.display = \"\";\n\t\t\t$(\"#rightJoyCon\")[0].style.display = \"\";\n\t\t\tsetVideoWidth(73.2);\n\t\t} catch(error) {\n\t\t}\n\t\t\n\t\tfor (let i = 0; i < buttonsList.length; i++) {\n\t\t\t$(buttonsList[i]).bind(\"touchstart\", onButtonPress);\n\t\t\t$(buttonsList[i]).bind(\"touchmove\", onButtonPress);\n\t\t\t$(buttonsList[i]).bind(\"touchend\", onButtonPress);\n\t\t\t$(buttonsList[i]).bind(\"mousedown\", onButtonPress);\n\t\t\t$(buttonsList[i]).bind(\"mouseup\", onButtonPress);\n\t\t\t$(buttonsList[i]).bind(\"mouseleave\", onButtonPress);\n\t\t\t$(buttonsList[i]).bind(\"pointerdown\", onButtonPress);\n\t\t\t$(buttonsList[i]).bind(\"pointerup\", onButtonPress);\n\t\t\t$(buttonsList[i]).bind(\"pointerout\", onButtonPress);\n\t\t}\n\t\t\n\t} else {\n\t\t\n\t\ttry {\n\t\t\t$(\"#leftJoyCon\")[0].style.display = \"none\";\n\t\t\t$(\"#rightJoyCon\")[0].style.display = \"none\";\n\t\t} catch(error) {\n\t\t}\n\t\t\n\t\tfor (let i = 0; i < buttonsList.length; i++) {\n\t\t\t$(buttonsList[i]).unbind(\"touchstart\", onButtonPress);\n\t\t\t$(buttonsList[i]).unbind(\"touchmove\", onButtonPress);\n\t\t\t$(buttonsList[i]).unbind(\"touchend\", onButtonPress);\n\t\t\t$(buttonsList[i]).unbind(\"mousedown\", onButtonPress);\n\t\t\t$(buttonsList[i]).unbind(\"mouseup\", onButtonPress);\n\t\t\t$(buttonsList[i]).unbind(\"mouseleave\", onButtonPress);\n\t\t\t$(buttonsList[i]).unbind(\"pointerdown\", onButtonPress);\n\t\t\t$(buttonsList[i]).unbind(\"pointerup\", onButtonPress);\n\t\t\t$(buttonsList[i]).unbind(\"pointerout\", onButtonPress);\n\t\t}\n\t\t\n\t}\n}\n\n\n$(\"#touchControlsCheckbox\").on(\"change\", function() {\n// \tconsole.log(\"checked touch controls\")\n\tsettings.touchControls = $(\"#touchControlsCheckbox\")[0].checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\t\n\tif (settings.largescreen) {\n\t\t$(\"#largescreenCheckbox\").prop(\"checked\", false);\n\t\tsettings.largescreen = false;\n\t\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\t}\n\trebindUnbindTouchControls();\n});\n\nfunction sendInputs() {\n\tif(!isMobile) {\n\t\tgetKeyboardInput();\n\t\tgetGamepadInput();\n\t}\n\tgetTouchInput();\n\tsendControllerState();\n}\nsendInputTimer = setInterval(sendInputs, 1000/120);\n\n\n/* AUTHENTICATION */\n\nsetInterval(function() {\n\tif (authCookie != null) {\n\t\tsocket.emit(\"registerAccount\", {auth: authCookie, usernameIndex: settings.usernameIndex});\n// \t\t$(\"#authenticateButton\").remove();\n\t}\n}, 5000);\n\nsocket.on(\"accountInfo\", function(data) {\n\tmyUniqueID = data.uniqueID;\n\tmyConnectedAccounts = data.connectedAccounts;\n\n\tlet usernameChanged = (JSON.stringify(myUsername) !== JSON.stringify(data.username));\n\tmyUsername = data.username;\n\t\n\tlet usernamesChanged = (JSON.stringify(myValidUsernames) !== JSON.stringify(data.validUsernames));\n\tmyValidUsernames = data.validUsernames;\n\t\n// \tlet loggedInText = '<span class=\"align-self-center\">Logged in as: ' + myValidUsernames[settings.usernameIndex] + \"</span>\";\n// \t$(\"#loggedInStatus\").html(loggedInText);\n\tif (usernamesChanged) {\n\t\tfor (let i = 0; i < data.validUsernames.length; i++) {\n\t\t\tlet html = '<button class=\"username-dropdown-item dropdown-item\">' + data.validUsernames[i] + \"</button>\";\n\t\t\t$(\"#usernameDropdownDiv\").append(html);\n\t\t}\n\t}\n\t\n\tif (usernameChanged) {\n\t\t$(\"#usernameDropdownMenuLink\").text(myUsername);\n\t}\n\t\n\tif (myConnectedAccounts.indexOf(\"twitch\") > -1) {\n\t\t$(\"#connectWithTwitch\").remove();\n\t}\n\tif (myConnectedAccounts.indexOf(\"google\") > -1) {\n\t\t$(\"#connectWithGoogle\").remove();\n\t}\n\tif (myConnectedAccounts.indexOf(\"youtube\") > -1) {\n\t\t$(\"#connectWithYoutube\").remove();\n\t}\n\tif (myConnectedAccounts.indexOf(\"discord\") > -1) {\n\t\t$(\"#connectWithDiscord\").remove();\n\t}\n\tif (myConnectedAccounts.length == 4) {\n\t\t$(\"#loggedInIndicator\").remove();\n\t}\n});\n\nsocket.on(\"usernameMap\", function(data) {\n\tusernameMap = data;\n});\n\n$(\"#logout\").on(\"click\", function(event) {\n\ttools.deleteAllCookies();\n\tlocation.reload(true);\n});\n\n$(document).on(\"click\", \".username-dropdown-item\", function(event) {\n\tlet username = $(event.target).text();\n\tlet index = $(event.target).index();\n\t$(\"#usernameDropdownMenuLink\").text(username);\n\tsettings.usernameIndex = index;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n});\n\nsocket.on(\"needToSignIn\", function() {\n\tswal(\"You need to sign in!\");\n\tsetTimeout(function() {\n\t\ttools.deleteAllCookies();\n\t\tlocation.reload(true);\n\t}, 1000);\n});\n\nfunction connectAccountOrSignIn(type) {\n\tlet url = \"https://twitchplaysnintendoswitch.com/8110/auth/\" + type + \"/\";\t\n\tif (authCookie != null) {\n\t\turl += \"?uniqueIDMap=\" + authCookie;\n\t}\n\twindow.location.href = url;\n}\n\n$(\"#connectWithTwitchButton\").on(\"click\", function(event) {\n\tconnectAccountOrSignIn(\"twitch\");\n});\n$(\"#connectWithGoogleButton\").on(\"click\", function(event) {\n\tconnectAccountOrSignIn(\"google\");\n});\n$(\"#connectWithYoutubeButton\").on(\"click\", function(event) {\n\tconnectAccountOrSignIn(\"youtube\");\n});\n$(\"#connectWithDiscordButton\").on(\"click\", function(event) {\n\tconnectAccountOrSignIn(\"discord\");\n});\n\n\nsetTimeout(function() {\n\tif (!loaded) {\n\t\tloaded = true;\n\t\t$.ajax({\n\t\t\turl: \"https://twitchplaysnintendoswitch.com/accountData/\" + myUniqueID + \"/\" + authCookie,\n\t\t});\n\t}\t\n}, 5000);\n\n\n\n/* STREAM SETTINGS @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n\n// prevent arrow keys from messing with the slider:\n// https://stackoverflow.com/questions/2922174/jquery-ui-slider-how-to-disable-keyboard-input\n$.prototype.slider_old = $.prototype.slider;\n$.prototype.slider = function() {\n\tlet result = $.prototype.slider_old.apply(this, arguments);\n\tthis.find(\".ui-slider-handle\").unbind(\"keydown\"); // disable keyboard actions\n\treturn result;\n}\n\nfunction minVolumeSliders() {\n\tsettings.volume = 0;\n\t$(\"#lagless1Volume\").slider(\"value\", 0);\n\t$(\"#lagless2Volume\").slider(\"value\", 0);\n\t$(\"#lagless3Volume\").slider(\"value\", 0);\n\t$(\"#lagless4Volume\").slider(\"value\", 0);\n\tif (!settings.audioThree) {\n\t\tplayer.volume = 0;\n\t} else {\n\t\taudio.volume = 0;\n\t}\n}\nfunction maxVolumeSliders() {\n\tsettings.volume = 100;\n\t$(\"#lagless1Volume\").slider(\"value\", 100);\n\t$(\"#lagless2Volume\").slider(\"value\", 100);\n\t$(\"#lagless3Volume\").slider(\"value\", 100);\n\t$(\"#lagless4Volume\").slider(\"value\", 100);\n\tif (!settings.audioThree) {\n\t\tplayer.volume = 1;\n\t} else {\n\t\taudio.volume = 1;\n\t}\n}\nfunction slideSliders(laglessNumber, ui) {\n\tsettings.volume = ui.value;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\tif (!settings.audioThree) {\n\t\tplayer.volume = settings.volume / 100;\n\t} else {\n\t\taudio.volume = settings.volume / 100;\n\t}\n\tif (laglessNumber != 1) {\n\t\t$(\"#lagless1Volume\").slider(\"value\", settings.volume);\n\t}\n\tif (laglessNumber != 2) {\n\t\t$(\"#lagless2Volume\").slider(\"value\", settings.volume);\n\t}\n\tif (laglessNumber != 3) {\n\t\t$(\"#lagless3Volume\").slider(\"value\", settings.volume);\n\t}\n\tif (laglessNumber != 4) {\n\t\t$(\"#lagless4Volume\").slider(\"value\", settings.volume);\n\t}\n}\n\n\n$(\"#lagless1Volume\").slider({\n    min: 0,\n    max: 100,\n    value: 0,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\tslideSliders(1, ui);\n  \t}\n});\n\n$(\"#lagless1VolumeSlider\").children().on(\"click\", function(){\n\tminVolumeSliders();\n});\n\n$(\"#lagless1VolumeSlider\").children().last().on(\"click\", function(){\n\tmaxVolumeSliders();\n});\n\n$(\"#qualitySlider\").slider({\n    min: 20,\n    max: 80,\n\tstep: 1,\n    value: 70,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#quality\").text(ui.value);\n\t\tsocket.emit(\"lagless1Settings\", {quality: parseInt(ui.value)});\n  \t},\n\tstop: function(event, ui) {\n\t}\n});\n\n$(\"#scaleSlider\").slider({\n    min: 10,\n    max: 80,\n\tstep: 5,\n    value: 30,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#scale\").text(ui.value);\n\t\tsocket.emit(\"lagless1Settings\", {scale: parseInt(ui.value)});\n  \t},\n\tstop: function(event, ui) {\n\t}\n});\n\n$(\"#fpsSlider\").slider({\n    min: 1,\n    max: 25,\n\tstep: 1,\n    value: 15,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#fps\").text(ui.value);\n\t\tsocket.emit(\"lagless1Settings\", {fps: parseInt(ui.value)});\n  \t},\n\tstop: function(event, ui) {\n\t}\n});\n\n\n$(\"#deadzoneSlider\").slider({\n    min: 1,\n    max: 100,\n\tstep: 1,\n    value: 50,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#deadzone\").text(ui.value);\n  \t},\n\tstop: function(event, ui) {\n\t}\n});\n\n$(\"#stickSensitivitySlider\").slider({\n    min: 0,\n    max: 3,\n\tstep: 0.01,\n    value: 1,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#sensitivity\").text(ui.value);\n\t\tsettings.stickSensitivityX = ui.value;\n\t\tsettings.stickSensitivityY = ui.value;\n  \t},\n\tstop: function(event, ui) {\n\t\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\t}\n});\n\n$(\"#stickAttackSlider\").slider({\n    min: 0,\n    max: 40,\n\tstep: 0.1,\n    value: 20,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#attack\").text(ui.value);\n\t\tsettings.stickAttack = ui.value;\n  \t},\n\tstop: function(event, ui) {\n\t\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\t}\n});\n\n$(\"#stickReturnSlider\").slider({\n    min: 0,\n    max: 40,\n\tstep: 0.1,\n    value: 20,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#return\").text(ui.value);\n\t\tsettings.stickReturn = ui.value;\n  \t},\n\tstop: function(event, ui) {\n\t\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\t}\n});\n\n// $(\"#videoWidthSlider\").slider({\n//     min: 70,\n//     max: 75,\n// \tstep: 0.001,\n//     value: 73.2,\n// \trange: \"min\",\n// \tanimate: true,\n// \tslide: function(event, ui) {\n// \t\t$(\"#videoWidth\").text(ui.value);\n// \t\tsetVideoWidth(ui.value);\n//   \t},\n// \tstop: function(event, ui) {\n// // \t\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n// \t}\n// });\n\nsocket.on(\"lagless1Settings\", function(data) {\n\tlagless1Settings = Object.assign({}, lagless1Settings, data);\n\t$(\"#scale\").text(lagless1Settings.scale);\n\t$(\"#scaleSlider\").slider(\"value\", lagless1Settings.scale);\n\t$(\"#quality\").text(lagless1Settings.quality);\n\t$(\"#qualitySlider\").slider(\"value\", lagless1Settings.quality);\n});\n\n\n// lagless2:\n\n$(\"#lagless2Volume\").slider({\n    min: 0,\n    max: 100,\n    value: 0,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\tslideSliders(2, ui);\n  \t}\n});\n\n$(\"#lagless2VolumeSlider\").children().on(\"click\", function(){\n\tminVolumeSliders();\n});\n\n$(\"#lagless2VolumeSlider\").children().last().on(\"click\", function(){\n\tmaxVolumeSliders();\n});\n\n$(\"#bitrateSlider2\").slider({\n    min: 0,\n    max: 3,\n\tstep: 0.05,\n    value: 1,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#bitrate2\").text(ui.value);\n  \t},\n\tstop: function(event, ui) {\n\t\tsocket.emit(\"lagless2Settings\", {videoBitrate: parseFloat(ui.value)});\n\t}\n});\n\n$(\"#scaleSlider2\").slider({\n    min: 100,\n    max: 960,\n\tstep: 1,\n    value: 960,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#scale2\").text(ui.value);\n  \t},\n\tstop: function(event, ui) {\n\t\tsocket.emit(\"lagless2Settings\", {scale: parseInt(ui.value)});\n\t}\n});\n\n$(\"#240p\").on(\"click\", function(event) {\n\t$(\"#scale2\").text(240);\n\t$(\"#scaleSlider2\").slider(\"value\", 240);\n\tsocket.emit(\"lagless2Settings\", {scale: 240});\n});\n$(\"#360p\").on(\"click\", function(event) {\n\t$(\"#scale2\").text(360);\n\t$(\"#scaleSlider2\").slider(\"value\", 360);\n\tsocket.emit(\"lagless2Settings\", {scale: 360});\n});\n$(\"#720p\").on(\"click\", function(event) {\n\t$(\"#scale2\").text(720);\n\t$(\"#scaleSlider2\").slider(\"value\", 720);\n\tsocket.emit(\"lagless2Settings\", {scale: 720});\n});\n$(\"#960p\").on(\"click\", function(event) {\n\t$(\"#scale2\").text(960);\n\t$(\"#scaleSlider2\").slider(\"value\", 960);\n\tsocket.emit(\"lagless2Settings\", {scale: 960});\n});\n\n\n\n$(\"#offsetXSlider2\").slider({\n    min:0,\n    max: 600,\n\tstep: 1,\n    value: 0,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#offsetX2\").text(ui.value);\n  \t},\n\tstop: function(event, ui) {\n\t\tsocket.emit(\"lagless2Settings\", {offsetX: parseInt(ui.value)});\n\t}\n});\n\n$(\"#offsetYSlider2\").slider({\n    min:0,\n    max: 300,\n\tstep: 1,\n    value: 0,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#offsetY2\").text(ui.value);\n  \t},\n\tstop: function(event, ui) {\n\t\tsocket.emit(\"lagless2Settings\", {offsetY: parseInt(ui.value)});\n\t}\n});\n\n$(\"#20fps\").on(\"click\", function(event) {\n\t$(\"#fps2\").text(20);\n\tsocket.emit(\"lagless2Settings\", {framerate: 20});\n});\n$(\"#30fps\").on(\"click\", function(event) {\n\t$(\"#fps2\").text(30);\n\tsocket.emit(\"lagless2Settings\", {framerate: 30});\n});\n$(\"#45fps\").on(\"click\", function(event) {\n\t$(\"#fps2\").text(45);\n\tsocket.emit(\"lagless2Settings\", {framerate: 45});\n});\n$(\"#60fps\").on(\"click\", function(event) {\n\t$(\"#fps2\").text(60);\n\tsocket.emit(\"lagless2Settings\", {framerate: 60});\n});\n\n\nsocket.on(\"lagless2Settings\", function(data) {\n\tlagless2Settings = Object.assign({}, lagless2Settings, data);\n\t\n\t$(\"#fps2\").text(lagless2Settings.framerate);\n\t\n\t$(\"#bitrate2\").text(lagless2Settings.videoBitrate);\n\t$(\"#bitrateSlider2\").slider(\"value\", lagless2Settings.videoBitrate);\n\t\n\t$(\"#scale2\").text(lagless2Settings.scale);\n\t$(\"#scaleSlider2\").slider(\"value\", lagless2Settings.scale);\n\t\n\t$(\"#offsetX2\").text(lagless2Settings.offsetX);\n\t$(\"#offsetXSlider2\").slider(\"value\", lagless2Settings.offsetX);\n\n\t$(\"#offsetY2\").text(lagless2Settings.offsetY);\n\t$(\"#offsetYSlider2\").slider(\"value\", lagless2Settings.offsetY);\n});\n\n// lagless3:\n$(\"#lagless3Volume\").slider({\n    min: 0,\n    max: 100,\n    value: 0,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\tslideSliders(3, ui);\n  \t}\n});\n\n$(\"#lagless3VolumeSlider\").children().on(\"click\", function(){\n\tminVolumeSliders();\n});\n\n$(\"#lagless3VolumeSlider\").children().last().on(\"click\", function(){\n\tmaxVolumeSliders();\n});\n\n\n// lagless4:\n// lagless3:\n$(\"#lagless4Volume\").slider({\n    min: 0,\n    max: 100,\n    value: 0,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\tslideSliders(4, ui);\n  \t}\n});\n\n$(\"#lagless4VolumeSlider\").children().on(\"click\", function(){\n\tminVolumeSliders();\n});\n\n$(\"#lagless4VolumeSlider\").children().last().on(\"click\", function(){\n\tmaxVolumeSliders();\n});\n\n\n// lagless5:\n\n$(\"#bitrateSlider5\").slider({\n    min: 0,\n    max: 2,\n\tstep: 0.05,\n    value: 1,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#bitrate5\").text(ui.value);\n  \t},\n\tstop: function(event, ui) {\n\t\tsocket.emit(\"lagless5Settings\", {videoBitrate: parseFloat(ui.value)});\n\t}\n});\n\n$(\"#scaleSlider5\").slider({\n    min: 100,\n    max: 960,\n\tstep: 1,\n    value: 960,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#scale5\").text(ui.value);\n  \t},\n\tstop: function(event, ui) {\n\t\tsocket.emit(\"lagless5Settings\", {scale: parseInt(ui.value)});\n\t}\n});\n\n$(\"#offsetXSlider5\").slider({\n    min:0,\n    max: 600,\n\tstep: 1,\n    value: 0,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#offsetX5\").text(ui.value);\n  \t},\n\tstop: function(event, ui) {\n\t\tsocket.emit(\"lagless5Settings\", {offsetX: parseInt(ui.value)});\n\t}\n});\n\n$(\"#offsetYSlider5\").slider({\n    min:0,\n    max: 400,\n\tstep: 1,\n    value: 0,\n\trange: \"min\",\n\tanimate: true,\n\tslide: function(event, ui) {\n\t\t$(\"#offsetY5\").text(ui.value);\n  \t},\n\tstop: function(event, ui) {\n\t\tsocket.emit(\"lagless5Settings\", {offsetY: parseInt(ui.value)});\n\t}\n});\n\nsocket.on(\"lagless5Settings\", function(data) {\n\tlagless5Settings = Object.assign({}, lagless5Settings, data);\n\t\n\t$(\"#scale5\").text(lagless5Settings.scale);\n\t$(\"#scaleSlider5\").slider(\"value\", lagless5Settings.scale);\n\t\n\t$(\"#bitrate5\").text(lagless5Settings.videoBitrate);\n\t$(\"#bitrateSlider5\").slider(\"value\", lagless5Settings.videoBitrate);\n\t\n\t$(\"#offsetX5\").text(lagless5Settings.offsetX);\n\t$(\"#offsetXSlider5\").slider(\"value\", lagless5Settings.offsetX);\n\n\t$(\"#offsetY5\").text(lagless5Settings.offsetY);\n\t$(\"#offsetYSlider5\").slider(\"value\", lagless5Settings.offsetY);\n});\n\n\n/* LAGLESS 1.0 */\n\nlet videoCanvas1 = $(\"#videoCanvas1\")[0];\nlet videoCanvas1Context = videoCanvas1.getContext(\"2d\");\nvideoCanvas1.width = 1280;\nvideoCanvas1.height = 720;\n\nsocket2.on(\"viewImage\", function(data) {\n\tlet src = \"data:image/jpeg;base64,\" + data;\n\tif(src == \"data:image/jpeg;base64,\") {\n\t\tsocket.emit(\"restart\");\n\t\treturn;\n\t}\n\tlet image = new Image();\n\timage.style = \"max-width:100%; height:auto;\";\n\timage.onload = function() {\n\t\tlet imgWidth = image.width;\n\t\tlet imgHeight = image.height;\n\t\tlet canvasWidth = videoCanvas1.width;\n\t\tlet canvasHeight = videoCanvas1.height;\n\t\tlet ratio = (imgHeight / imgWidth);\n\t\tlet canvasRatio = canvasWidth / canvasHeight;\n\t\tlet ratioW = 1280 / $(\"#videoCanvas1\").innerWidth();\n\t\tlet ratioH = 720 / $(\"#videoCanvas1\").innerHeight();\n\t\tlet cWidth = $(\"#videoCanvas1\").innerWidth();\n\t\tvideoCanvas1Context.clearRect(0, 0, canvasWidth, canvasHeight);\n\t\tvideoCanvas1Context.drawImage(image, 0, 0, cWidth * ratioW, cWidth * ratio * ratioH);\n\t};\n\timage.src = src;\n});\n$(\"#lagless1Refresh\").on(\"click\", function() {\n\tsocket.emit(\"restart1\");\n});\n\n/* LAGLESS 2.0 */\n// Setup the WebSocket connection and start the player\nlet url = \"wss://twitchplaysnintendoswitch.com/\" + lagless2Port + \"/\";\nlet canvas2 = $(\"#videoCanvas2\")[0];\n// Default 512*1024 (512kb).\n// Default 128*1024 (128kb)\n// let player = new JSMpeg.Player(url, {canvas: canvas2, video: true, audio: true, videoBufferSize: 256*1024, audioBufferSize: 128*1024, maxAudioLag: 0.5});\n// player.maxAudioLag = 0.5;\n// player.stop();\n\nfunction resizeVideo2(scale) {\n\tlet w = 960;\n\tlet h = 540;\n\tlet s = scale / 100;\n\tlet newWidth = w * s;\n\tlet newHeight = h * s;\n\tplayer.renderer.canvas.width = newWidth;\n\tplayer.renderer.canvas.height = newHeight;\n\tplayer.renderer.gl.viewport(0, 0, newWidth, newHeight);\n}\n\n// on settings change:\nsocket.on(\"lagless2SettingsChange\", function(data) {\n\ttry {\n\t\tplayer.destroy();\n\t} catch(error) {\n\t}\n\tplayer = new JSMpeg.Player(url, {canvas: canvas2, video: true, audio: /*!settings.audioThree*/true, videoBufferSize: videoBufferSize, audioBufferSize: audioBufferSize, maxAudioLag: 0.5});\n\tif (!settings.audioThree) {\n\t\tplayer.volume = settings.volume / 100;\n\t} else {\n\t\tplayer.volume = 0;\n\t}\n});\n\n//socket.emit(\"lagless2Settings\", {videoBitrate: \"2M\", framerate: 20, scale: \"640:360\"});\n\n$(\"#lagless2Refresh\").on(\"click\", function() {\n\tsocket.emit(\"restart2\");\n});\n\n\n/* LAGLESS 3.0 */\nlet canvas3 = $(\"#videoCanvas3\")[0];\n// Create h264 player\nlet uri = \"wss://twitchplaysnintendoswitch.com/\" + lagless3Port + \"/\";\nlet wsavc = new WSAvcPlayer(canvas3, \"webgl\", 1, 35);\n\n\n$(\"#lagless3Refresh\").on(\"click\", function() {\n\ttry {\n\t\twsavc.disconnect();\n\t} catch(error) {\n\t}\n\tlet uri = \"wss://twitchplaysnintendoswitch.com/\"+ lagless3Port + \"/\";\n\twsavc.connect(uri);\n});\n\n$(\"#lagless3Refresh\").on(\"click\", function() {\n\tsocket.emit(\"restart3\");\n});\n\n/* LAGLESS 4.0 */\nlet canvas4 = $(\"#videoCanvas4\")[0];\nlet videoPeer = new SimplePeer({\n\tinitiator: false,\n\ttrickle: true\n});\nvideoPeer.on(\"error\", function(err) {\n\tconsole.log(\"error\", err)\n});\nvideoPeer.on(\"signal\", function(data) {\n\tconsole.log(\"SIGNAL\", JSON.stringify(data));\n\tsocket.emit(\"clientPeerSignalV\", JSON.stringify(data));\n});\nvideoPeer.on(\"connect\", function() {\n\tconsole.log(\"CONNECT\");\n\tvideoPeer.send(Math.random());\n});\nvideoPeer.on(\"data\", function(data) {\n\tconsole.log(\"data: \" + data)\n});\nsocket.on(\"hostPeerSignalV\", function(data) {\n\tvideoPeer.signal(JSON.parse(data));\n});\nvideoPeer.on(\"stream\", function (stream) {\n\t// got remote video stream, then show it in a video tag\n\tcanvas4.src = window.URL.createObjectURL(stream);// deprecated\n// \tcanvas4.srcObj = stream;\n\tcanvas4.play();\n});\n\n\n\n/* LAGLESS 5.0 */\nlet videoCanvas5 = $(\"#videoCanvas5\")[0];\nlet videoCanvas5Context = videoCanvas5.getContext(\"2d\");\nvideoCanvas5.width = 1280;\nvideoCanvas5.height = 720;\n\nsocket2.on(\"viewImage5\", function(data) {\n\tlet src = \"data:image/jpeg;base64,\" + data;\n\tif(src == \"data:image/jpeg;base64,\") {\n\t\tconsole.log(\"image was empty\");\n\t\tsocket.emit(\"restart5\");\n\t\treturn;\n\t}\n\tlet image = new Image();\n\timage.style = \"max-width:100%; height:auto;\";\n\timage.onload = function() {\n\t\tlet imgWidth = image.width;\n\t\tlet imgHeight = image.height;\n\t\tlet canvasWidth = videoCanvas5.width;\n\t\tlet canvasHeight = videoCanvas5.height;\n\t\tlet ratio = (imgHeight / imgWidth);\n\t\tlet canvasRatio = canvasWidth / canvasHeight;\n\t\tlet ratioW = 1280 / $(\"#videoCanvas5\").innerWidth();\n\t\tlet ratioH = 720 / $(\"#videoCanvas5\").innerHeight();\n\t\tlet cWidth = $(\"#videoCanvas5\").innerWidth();\n\t\tvideoCanvas5Context.clearRect(0, 0, canvasWidth, canvasHeight);\n\t\tvideoCanvas5Context.drawImage(image, 0, 0, cWidth * ratioW, cWidth * ratio * ratioH);\n\t};\n\timage.src = src;\n});\n\n/* RESIZABLE */\n// interact(\"#picture\")\n// \t.resizable({\n//     // resize from all edges and corners\n//     edges: { left: false, right: true, bottom: false, top: false },\n//     // keep the edges inside the parent\n//     restrictEdges: {\n//       outer: \"parent\",\n//       endOnly: true,\n//     },\n//     // minimum size\n//     restrictSize: {\n//       min: { width: 100, height: 50 },\n//     },\n// \tpreserveAspectRatio: true,\n//     inertia: true,\n//   })\n//   .on(\"resizemove\", function (event) {\n//     var target = event.target,\n//         x = (parseFloat(target.getAttribute(\"data-x\")) || 0),\n//         y = (parseFloat(target.getAttribute(\"data-y\")) || 0);\n\n//     // update the element's style\n//     target.style.width  = event.rect.width + \"px\";\n//     target.style.height = event.rect.height + \"px\";\n//   });\n// interact(\"#videoCanvas2\")\n// \t.resizable({\n//     // resize from all edges and corners\n//     edges: { left: true, right: true, bottom: true, top: true },\n//     // keep the edges inside the parent\n//     restrictEdges: {\n//       outer: \"parent\",\n//       endOnly: true,\n//     },\n//     // minimum size\n//     restrictSize: {\n//       min: { width: 100, height: 50 },\n//     },\n// \tpreserveAspectRatio: true,\n//     inertia: true,\n//   })\n//   .on(\"resizemove\", function (event) {\n//     var target = event.target,\n//         x = (parseFloat(target.getAttribute(\"data-x\")) || 0),\n//         y = (parseFloat(target.getAttribute(\"data-y\")) || 0);\n\n//     // update the element's style\n//     target.style.width  = event.rect.width + \"px\";\n//     target.style.height = event.rect.height + \"px\";\n//   });\n// interact(\"#videoCanvas3\")\n// \t.resizable({\n//     // resize from all edges and corners\n//     edges: { left: true, right: true, bottom: true, top: true },\n//     // keep the edges inside the parent\n//     restrictEdges: {\n//       outer: \"parent\",\n//       endOnly: true,\n//     },\n//     // minimum size\n//     restrictSize: {\n//       min: { width: 100, height: 50 },\n//     },\n// \tpreserveAspectRatio: true,\n//     inertia: true,\n//   })\n//   .on(\"resizemove\", function (event) {\n//     var target = event.target,\n//         x = (parseFloat(target.getAttribute(\"data-x\")) || 0),\n//         y = (parseFloat(target.getAttribute(\"data-y\")) || 0);\n\n//     // update the element's style\n//     target.style.width  = event.rect.width + \"px\";\n//     target.style.height = event.rect.height + \"px\";\n//   });\n\n\nfunction addJoyCons(tab, actual) {\n\t\n\tactual = actual || false;\n\t\n\tif (!actual) {\n\t\ttab = tab + \"View\";\n\t}\n\t\n\t// delete old joycons:\n\ttry {\n\t\tleftStick.destroy();\n\t\trightStick.destroy();\n\t} catch(e) {\n\t\tconsole.log(\"JoyCon delete error.\");\n\t}\n\t\n\t$(\"#leftJoyCon\").remove();\n\t$(\"#rightJoyCon\").remove();\n\t\n\t\n\tlet leftJoyConHTML = `\n\t<div id=\"leftJoyCon\">\n\t\t<canvas id=\"leftJoyConCanvas\"></canvas>\n\t\t<div id=\"leftStick\">\n\t\t\t<div id=\"leftStick2\"></div>\n\t\t</div>\n\t\t\n\t\t<div id=\"dpadButtons\">\n\t\t\t<div id=\"upButton\" class=\"controllerButton\"></div>\n\t\t\t<div id=\"downButton\" class=\"controllerButton\"></div>\n\t\t\t<div id=\"leftButton\" class=\"controllerButton\"></div>\n\t\t\t<div id=\"rightButton\" class=\"controllerButton\"></div>\n\t\t</div>\n\t\t<div id=\"leftJoyConOther\">\n\t\t\t<div id=\"minusButton\" class=\"controllerButton lessRound\"></div>\n\t\t\t<div id=\"captureButton\" class=\"controllerButton lessRound\"></div>\n\t\t\t<div id=\"lButton\" class=\"controllerButton lessRound\"><div class=\"click-passthrough\">L</div></div>\n\t\t\t<div id=\"zlButton\" class=\"controllerButton lessRound\"><div class=\"click-passthrough\">ZL</div></div>\n\t\t</div>\n\t</div>`;\n\t\n\tlet rightJoyConHTML = `\n\t<div id=\"rightJoyCon\">\n\t\t<canvas id=\"rightJoyConCanvas\"></canvas>\n\t\t<div id=\"rightStick\">\n\t\t\t<div id=\"rightStick2\"></div>\n\t\t</div>\n\t\t<div id=\"abxyButtons\">\n\t\t\t<div id=\"xButton\" class=\"controllerButton\"></div>\n\t\t\t<div id=\"bButton\" class=\"controllerButton\"></div>\n\t\t\t<div id=\"yButton\" class=\"controllerButton\"></div>\n\t\t\t<div id=\"aButton\" class=\"controllerButton\"></div>\n\t\t</div>\n\t\t<div id=\"rightJoyConOther\">\n\t\t\t<div id=\"plusButton\" class=\"controllerButton lessRound\"></div>\n\t\t\t<div id=\"homeButton\" class=\"controllerButton lessRound\"></div>\n\t\t\t<div id=\"rButton\" class=\"controllerButton lessRound\"><div class=\"click-passthrough\">R</div></div>\n\t\t\t<div id=\"zrButton\" class=\"controllerButton lessRound\"><div class=\"click-passthrough\">ZR</div></div>\n\t\t</div>\n\t</div>`;\n\t\n\t$(tab).prepend(leftJoyConHTML);\n\t$(tab).prepend(rightJoyConHTML);\n\t\n\t// rebind touch controls:\n\trebindUnbindTouchControls();\n\t\n\t// redraw joycons:\n\tdrawJoyCons();\n\t\n\t// resize window:\n\tsetVideoWidth(73.2);\n\t\n\t// rebind sticks:\n\tleftJoyStick.zone = document.querySelector(\"#leftStick\");\n\trightJoyStick.zone = document.querySelector(\"#rightStick\");\n\tleftStick = nipplejs.create(leftJoyStick);\n\trightStick = nipplejs.create(rightJoyStick);\n\tbindJoysticks();\n}\n\n\n\n/* SWITCH IMPLEMENTATIONS */\n\nfunction switchTabs(tab) {\n\t// lagless 1:\n\tif (tab == \"#lagless1\") {\n\t\tsettings.tab = 1;\n\t\tsocket2.emit(\"join\", \"lagless1\");\n\t\t// todo: fix this:\n\t\tclearInterval(lagless1JoinTimer);\n\t\tlagless1JoinTimer = setInterval(function() {\n\t\t\tsocket2.emit(\"join\", \"lagless1\");\n\t\t}, 5000);\n\t} else {\n\t\tclearInterval(lagless1JoinTimer);\n\t\tsocket2.emit(\"leave\", \"lagless1\");\n\t}\n\t\n\t// lagless 2:\n\tif (tab == \"#lagless2\") {\n\t\tsettings.tab = 2;\n\t\tsocket.emit(\"join\", \"lagless2\");\n\t\t//player.play();\n\t\ttry {\n\t\t\tplayer.destroy();\n\t\t} catch (error) {\n\t\t}\n\t\tplayer = new JSMpeg.Player(url, {canvas: canvas2, video: true, audio: /*!settings.audioThree*/true, videoBufferSize: videoBufferSize, audioBufferSize: audioBufferSize, maxAudioLag: 0.5});\n\t\tif (!settings.audioThree) {\n\t\t\tplayer.volume = settings.volume / 100;\n\t\t\taudio.volume = 0;\n\t\t} else {\n\t\t\tplayer.volume = 0;\n\t\t\taudio.volume = settings.volume / 100;\n\t\t}\n\t} else {\n// \t\tplayer.stop();\n\t\ttry {\n\t\t\tplayer.destroy();\n\t\t} catch (error) {\n\t\t}\n\t\tplayer = new JSMpeg.Player(url, {canvas: canvas2, video: false, audio: true, videoBufferSize: videoBufferSize, audioBufferSize: audioBufferSize, maxAudioLag: 0.5});\n\t\tif (!settings.audioThree) {\n\t\t\tplayer.volume = settings.volume / 100;\n\t\t\taudio.volume = 0;\n\t\t} else {\n\t\t\tplayer.volume = 0;\n\t\t\taudio.volume = settings.volume / 100;\n\t\t}\n\t}\n\n\t// lagless 3:\n\tif (tab == \"#lagless3\") {\n\t\tsettings.tab = 3;\n\t\tsocket.emit(\"join\", \"lagless3\");\n\t\tlet uri = \"wss://twitchplaysnintendoswitch.com/\" + lagless3Port + \"/\";\n\t\twsavc.connect(uri);\n\t} else {\n\t\ttry {\n\t\t\twsavc.disconnect();\n\t\t} catch(error) {\n\t\t}\n\t}\n\t\n\t// lagless 4:\n\tif (tab == \"#lagless4\") {\n\t\tsettings.tab = 4;\n\t\tsocket.emit(\"join\", \"lagless4\");\n\t\tif (!videoConnected) {\n\t\t\tvideoConnected = true;\n\t\t\tsocket.emit(\"requestVideo\");\n\t\t} else {\n\t\t\tvideoCanvas4.play();\n\t\t}\n\t} else {\n\t\tvideoCanvas4.pause();\n\t}\n\n\t// lagless 5:\n\tif (tab == \"#lagless5\") {\n\t\tsettings.tab = 5;\n\t\tsocket2.emit(\"join\", \"lagless5\");\n\t\tif (typeof player5 != \"undefined\") {\n\t\t\ttry {\n\t\t\t\tplayer5.play();\n\t\t\t} catch (e) {\n\t\t\t}\n\t\t}\n// \t\tsetTimeout(function() {\n// \t\t\tplayer.volume = 0;\n// \t\t}, 1000);\n\t} else {\n\t\tsocket2.emit(\"leave\", \"viewers5\");\n\t\tif (typeof player5 != \"undefined\") {\n\t\t\ttry {\n\t\t\t\tplayer5.stop();\n\t\t\t} catch (e) {\n\t\t\t}\n\t\t}\n\t}\n}\n\n$(document).on(\"shown.bs.tab\", 'a[data-toggle=\"tab\"]', function(e) {\n\n\tlet tab = $(e.target);\n\tlet contentId = tab.attr(\"href\");\n\t\t\n\tcurrentTab = contentId;\n\n\tswitchTabs(contentId);\n\t\n\t\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\t\n\tif (!settings.largescreen) {\n\t\taddJoyCons(contentId);\n\t\tsetTimeout(drawJoyCons, 2000);// todo: find a solution like onload, but for tab changes\n\t\trebindUnbindTouchControls();\n\t}\n\t\n\t// https://github.com/yoannmoinet/nipplejs/issues/39\n\t// force joysticks to recalculate the center:\n\twindow.dispatchEvent(new Event(\"resize\"));\n\tsetTimeout(function() {\n\t\twindow.dispatchEvent(new Event(\"resize\"));\n\t}, 5000);\n});\n\n// todo: debounce\n$(window).resize(function(event) {\n\tresizeChat();\n\tif (!settings.fullscreen && !settings.largescreen) {\n\t\ttry {\n\t\t\tsetVideoWidth(73.2);\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t}\n\t}\n// \tif (resizeAvailable) {\n\t\tresizeAvailable = false;\n\t\tresizeDebounceTimer = setTimeout(function() {\n\t\t\tresizeAvailable = true;\n\t\t}, 100);\n\t\tfor (let i = 0; i < resizers.length; i++) {\n\t\t\tresizers[i].resize();\n\t\t}\n// \t}\n});\n\n// https://github.com/yoannmoinet/nipplejs/issues/39\n// force joysticks to recalculate the center:\n// setInterval(function() {\n// \twindow.dispatchEvent(new Event(\"resize\"));\n// }, 5000);\n\nsetInterval(function() {\n\tsocket.emit(\"joinLagless\" + settings.tab);\n}, 10000);\n\n\n// let twitchPlayer1 = new Twitch.Player(\"lagless1View\", {channel: \"twitchplaysconsoles\"});\n// let twitchPlayer2 = new Twitch.Player(\"lagless2View\", {channel: \"twitchplaysconsoles\"});\n// let twitchPlayer3 = new Twitch.Player(\"lagless3View\", {channel: \"twitchplaysconsoles\"});\n// $(\"iframe[src='https://player.twitch.tv/?allowfullscreen&channel=twitchplaysconsoles&origin=https%3A%2F%2Ftwitchplaysnintendoswitch.com']\")[0].id = \"twitchVideo1\";\n// $(\"iframe[src='https://player.twitch.tv/?allowfullscreen&channel=twitchplaysconsoles&origin=https%3A%2F%2Ftwitchplaysnintendoswitch.com']\")[1].id = \"twitchVideo2\";\n// $(\"iframe[src='https://player.twitch.tv/?allowfullscreen&channel=twitchplaysconsoles&origin=https%3A%2F%2Ftwitchplaysnintendoswitch.com']\")[2].id = \"twitchVideo3\";\n// $(\"iframe[src='https://player.twitch.tv/?allowfullscreen&channel=twitchplaysconsoles&origin=https%3A%2F%2Ftwitchplaysnintendoswitch.com']\")[0].className = \"twitchVideo\";\n// $(\"iframe[src='https://player.twitch.tv/?allowfullscreen&channel=twitchplaysconsoles&origin=https%3A%2F%2Ftwitchplaysnintendoswitch.com']\")[1].className = \"twitchVideo\";\n// $(\"iframe[src='https://player.twitch.tv/?allowfullscreen&channel=twitchplaysconsoles&origin=https%3A%2F%2Ftwitchplaysnintendoswitch.com']\")[2].className = \"twitchVideo\";\n// twitchPlayer1.pause();\n// twitchPlayer2.pause();\n// twitchPlayer3.pause();\n// $(\"#twitchVideo1\")[0].style.display = \"none\";\n// $(\"#twitchVideo2\")[0].style.display = \"none\";\n// $(\"#twitchVideo3\")[0].style.display = \"none\";\n\n\n\n\nfunction replaceWithTwitch(tab) {\n\ttab = tab || currentTab;\n\tlet twitchIFrame = '<iframe id=\"twitchVideo\" class=\"\" src=\"https://player.twitch.tv/?channel=twitchplaysconsoles&muted=false&autoplay=true\" frameborder=\"0\" scrolling=\"no\" allowfullscreen=\"true\"></iframe>';\n\n\tif (tab == \"#lagless1\") {\n\t\tclearInterval(lagless1JoinTimer);\n\t\tsocket2.emit(\"leave\", \"viewers\");\n\t\t$(\"#videoCanvas1\")[0].style.display = \"none\";\n\t\t$(\"#videoCanvas1\").after(twitchIFrame);\n\t} else {\n// \t\t$(\"#tab1\").addClass(\"disabled\");\n\t}\n\t\n\tif (tab == \"#lagless2\") {\n\t\ttry {\n\t\t\tplayer.stop();\n\t\t} catch(error) {\n\t\t\tconsole.log(\"player not defined\");\n\t\t}\n\t\t$(\"#videoCanvas2\")[0].style.display = \"none\";\n\t\t$(\"#videoCanvas2\").after(twitchIFrame);\n\t} else {\n\t}\n\t\n\tif (tab == \"#lagless3\") {\n\t\twsavc.disconnect();\n\t\t$(\"#videoCanvas3\")[0].style.display = \"none\";\n\t\t$(\"#videoCanvas3\").after(twitchIFrame);\n\t} else {\n\t}\n\t\n\tif (tab == \"#lagless4\") {\n\t\ttry {\n// \t\t\tplayer.stop();\n\t\t} catch(error) {\n// \t\t\tconsole.log(\"player not defined\");\n\t\t}\n\t\t$(\"#videoCanvas4\")[0].style.display = \"none\";\n\t\t$(\"#videoCanvas4\").after(twitchIFrame);\n\t} else {\n\t}\n\t\n\tif (tab == \"#lagless5\") {\n\t\tplayer5.stop();\n\t\t$(\"#videoCanvas5\")[0].style.display = \"none\";\n\t\t$(\"#videoCanvas5\").after(twitchIFrame);\n\t} else {\n\t}\n\t\n\tsetVideoWidth(73.2);\n\tsocket.emit(\"leaveLagless\");\n}\n\n\nfunction replaceWithLagless(tab) {\n\ttab = tab || currentTab;\n\tlet laglessCanvas;\n\tif (tab == \"#lagless1\") {\n\t\tsocket2.emit(\"join\", \"lagless1\");\n\t\t\n\t\t$(\"#videoCanvas1\")[0].style.display = \"\";\n\t\t$(\"#twitchVideo\").remove();\n\t} else {\n// \t\t$(\"#tab1\").removeClass(\"disabled\");\n\t}\n\t\n\tif (tab == \"#lagless2\") {\n\t\tsocket.emit(\"join\", \"lagless2\");\n\t\tplayer.play();\n\t\t\n\t\t$(\"#videoCanvas2\")[0].style.display = \"\";\n\t\t$(\"#twitchVideo\").remove();\n\t} else {\n\t}\n\t\n\tif (tab == \"#lagless3\") {\n\t\tsocket.emit(\"joinLagless3\");\n\t\tlet uri = \"wss://twitchplaysnintendoswitch.com/\" + lagless3Port + \"/\";\n\t\twsavc.connect(uri);\n\t\t\n\t\t$(\"#videoCanvas3\")[0].style.display = \"\";\n\t\t$(\"#twitchVideo\").remove();\n\t} else {\n// \t\t$(\"#tab3\").removeClass(\"disabled\");\n\t}\n\t\n\tif (tab == \"#lagless4\") {\n\t\tsocket.emit(\"join\", \"lagless4\");\n// \t\tplayer4.play();\n\t\t\n\t\t$(\"#videoCanvas4\")[0].style.display = \"\";\n\t\t$(\"#twitchVideo\").remove();\n\t} else {\n\t}\n\t\n\tif (tab == \"#lagless5\") {\n\t\tsocket.emit(\"join\", \"lagless5\");\n\t\tplayer.play();\n\t\t\n\t\t$(\"#videoCanvas5\")[0].style.display = \"\";\n\t\t$(\"#twitchVideo\").remove();\n\t} else {\n\t}\n\t\n\tsetVideoWidth(73.2);\n}\n\n$(\"#replaceWithTwitch\").on(\"click\", function() {\n\treplaceWithTwitch();\n});\n\n$(\"#replaceWithLagless\").on(\"click\", function() {\n\treplaceWithLagless();\n});\n\nsocket.on(\"replaceWithTwitch\", function() {\n\treplaceWithTwitch();\n});\n\nsocket.on(\"replaceWithLagless\", function() {\n\treplaceWithTwitch();\n});\n\n\n\n/* STATUS BAR @@@@@@@@@@@@@@@@ */\n// socket.on(\"lock\", function() {\n// \treplaceWithTwitch();\n// });\n\n/* AUDIO WEBRTC @@@@@@@@@@@@@@@@ */\n\nlet BandwidthHandler = (function() {\n\tfunction setBAS(sdp, bandwidth, isScreen) {\n\t\tif (!!navigator.mozGetUserMedia || !bandwidth) {\n\t\t\treturn sdp;\n\t\t}\n\n\t\tif (isScreen) {\n\t\t\tif (!bandwidth.screen) {\n\t\t\t\tconsole.warn('It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.');\n\t\t\t} else if (bandwidth.screen < 300) {\n\t\t\t\tconsole.warn('It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail.');\n\t\t\t}\n\t\t}\n\n\t\t// if screen; must use at least 300kbs\n\t\tif (bandwidth.screen && isScreen) {\n\t\t\tsdp = sdp.replace(/b=AS([^\\r\\n]+\\r\\n)/g, '');\n\t\t\tsdp = sdp.replace(/a=mid:video\\r\\n/g, 'a=mid:video\\r\\nb=AS:' + bandwidth.screen + '\\r\\n');\n\t\t}\n\n\t\t// remove existing bandwidth lines\n\t\tif (bandwidth.audio || bandwidth.video || bandwidth.data) {\n\t\t\tsdp = sdp.replace(/b=AS([^\\r\\n]+\\r\\n)/g, '');\n\t\t}\n\n\t\tif (bandwidth.audio) {\n\t\t\tsdp = sdp.replace(/a=mid:audio\\r\\n/g, 'a=mid:audio\\r\\nb=AS:' + bandwidth.audio + '\\r\\n');\n\t\t}\n\n\t\tif (bandwidth.video) {\n\t\t\tsdp = sdp.replace(/a=mid:video\\r\\n/g, 'a=mid:video\\r\\nb=AS:' + (isScreen ? bandwidth.screen : bandwidth.video) + '\\r\\n');\n\t\t}\n\n\t\treturn sdp;\n\t}\n\n\t// Find the line in sdpLines that starts with |prefix|, and, if specified,\n\t// contains |substr| (case-insensitive search).\n\tfunction findLine(sdpLines, prefix, substr) {\n\t\treturn findLineInRange(sdpLines, 0, -1, prefix, substr);\n\t}\n\n\t// Find the line in sdpLines[startLine...endLine - 1] that starts with |prefix|\n\t// and, if specified, contains |substr| (case-insensitive search).\n\tfunction findLineInRange(sdpLines, startLine, endLine, prefix, substr) {\n\t\tvar realEndLine = endLine !== -1 ? endLine : sdpLines.length;\n\t\tfor (var i = startLine; i < realEndLine; ++i) {\n\t\t\tif (sdpLines[i].indexOf(prefix) === 0) {\n\t\t\t\tif (!substr ||\n\t\t\t\t\tsdpLines[i].toLowerCase().indexOf(substr.toLowerCase()) !== -1) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t// Gets the codec payload type from an a=rtpmap:X line.\n\tfunction getCodecPayloadType(sdpLine) {\n\t\tvar pattern = new RegExp('a=rtpmap:(\\\\d+) \\\\w+\\\\/\\\\d+');\n\t\tvar result = sdpLine.match(pattern);\n\t\treturn (result && result.length === 2) ? result[1] : null;\n\t}\n\n\tfunction setVideoBitrates(sdp, params) {\n\t\tparams = params || {};\n\t\tvar xgoogle_min_bitrate = params.min;\n\t\tvar xgoogle_max_bitrate = params.max;\n\n\t\tvar sdpLines = sdp.split('\\r\\n');\n\n\t\t// VP8\n\t\tvar vp8Index = findLine(sdpLines, 'a=rtpmap', 'VP8/90000');\n\t\tvar vp8Payload;\n\t\tif (vp8Index) {\n\t\t\tvp8Payload = getCodecPayloadType(sdpLines[vp8Index]);\n\t\t}\n\n\t\tif (!vp8Payload) {\n\t\t\treturn sdp;\n\t\t}\n\n\t\tvar rtxIndex = findLine(sdpLines, 'a=rtpmap', 'rtx/90000');\n\t\tvar rtxPayload;\n\t\tif (rtxIndex) {\n\t\t\trtxPayload = getCodecPayloadType(sdpLines[rtxIndex]);\n\t\t}\n\n\t\tif (!rtxIndex) {\n\t\t\treturn sdp;\n\t\t}\n\n\t\tvar rtxFmtpLineIndex = findLine(sdpLines, 'a=fmtp:' + rtxPayload.toString());\n\t\tif (rtxFmtpLineIndex !== null) {\n\t\t\tvar appendrtxNext = '\\r\\n';\n\t\t\tappendrtxNext += 'a=fmtp:' + vp8Payload + ' x-google-min-bitrate=' + (xgoogle_min_bitrate || '228') + '; x-google-max-bitrate=' + (xgoogle_max_bitrate || '228');\n\t\t\tsdpLines[rtxFmtpLineIndex] = sdpLines[rtxFmtpLineIndex].concat(appendrtxNext);\n\t\t\tsdp = sdpLines.join('\\r\\n');\n\t\t}\n\n\t\treturn sdp;\n\t}\n\n\tfunction setOpusAttributes(sdp, params) {\n\t\tparams = params || {};\n\n\t\tvar sdpLines = sdp.split('\\r\\n');\n\n\t\t// Opus\n\t\tvar opusIndex = findLine(sdpLines, 'a=rtpmap', 'opus/48000');\n\t\tvar opusPayload;\n\t\tif (opusIndex) {\n\t\t\topusPayload = getCodecPayloadType(sdpLines[opusIndex]);\n\t\t}\n\n\t\tif (!opusPayload) {\n\t\t\treturn sdp;\n\t\t}\n\n\t\tvar opusFmtpLineIndex = findLine(sdpLines, 'a=fmtp:' + opusPayload.toString());\n\t\tif (opusFmtpLineIndex === null) {\n\t\t\treturn sdp;\n\t\t}\n\n\t\tvar appendOpusNext = '';\n\t\tappendOpusNext += '; stereo=' + (typeof params.stereo != 'undefined' ? params.stereo : '1');\n\t\tappendOpusNext += '; sprop-stereo=' + (typeof params['sprop-stereo'] != 'undefined' ? params['sprop-stereo'] : '1');\n\n\t\tif (typeof params.maxaveragebitrate != 'undefined') {\n\t\t\tappendOpusNext += '; maxaveragebitrate=' + (params.maxaveragebitrate || 128 * 1024 * 8);\n\t\t}\n\n\t\tif (typeof params.maxplaybackrate != 'undefined') {\n\t\t\tappendOpusNext += '; maxplaybackrate=' + (params.maxplaybackrate || 128 * 1024 * 8);\n\t\t}\n\n\t\tif (typeof params.cbr != 'undefined') {\n\t\t\tappendOpusNext += '; cbr=' + (typeof params.cbr != 'undefined' ? params.cbr : '1');\n\t\t}\n\n\t\tif (typeof params.useinbandfec != 'undefined') {\n\t\t\tappendOpusNext += '; useinbandfec=' + params.useinbandfec;\n\t\t}\n\n\t\tif (typeof params.usedtx != 'undefined') {\n\t\t\tappendOpusNext += '; usedtx=' + params.usedtx;\n\t\t}\n\n\t\tif (typeof params.maxptime != 'undefined') {\n\t\t\tappendOpusNext += '\\r\\na=maxptime:' + params.maxptime;\n\t\t}\n\n\t\tsdpLines[opusFmtpLineIndex] = sdpLines[opusFmtpLineIndex].concat(appendOpusNext);\n\n\t\tsdp = sdpLines.join('\\r\\n');\n\t\treturn sdp;\n\t}\n\n\treturn {\n\t\tsetApplicationSpecificBandwidth: function(sdp, bandwidth, isScreen) {\n\t\t\treturn setBAS(sdp, bandwidth, isScreen);\n\t\t},\n\t\tsetVideoBitrates: function(sdp, params) {\n\t\t\treturn setVideoBitrates(sdp, params);\n\t\t},\n\t\tsetOpusAttributes: function(sdp, params) {\n\t\t\treturn setOpusAttributes(sdp, params);\n\t\t}\n\t};\n})();\n\n\t\t\n\t\t// example:\n// \t\tvar bandwidth = {\n// \t\t\tscreen: 300, // 300kbits minimum\n// \t\t\taudio: 50,   // 50kbits  minimum\n// \t\t\tvideo: 256   // 256kbits (both min-max)\n// \t\t};\n// \t\tvar isScreenSharing = false;\n\n// \t\tsdp = BandwidthHandler.setApplicationSpecificBandwidth(sdp, bandwidth, isScreenSharing);\n// \t\tsdp = BandwidthHandler.setVideoBitrates(sdp, {\n// \t\t\tmin: bandwidth.video,\n// \t\t\tmax: bandwidth.video\n// \t\t});\n// \t\tsdp = BandwidthHandler.setOpusAttributes(sdp);\n// \t\tsdp = BandwidthHandler.setOpusAttributes(sdp, {\n// \t\t\t'stereo': 0, // to disable stereo (to force mono audio)\n// \t\t\t'sprop-stereo': 1,\n// \t\t\t'maxaveragebitrate': 500 * 1024 * 8, // 500 kbits\n// \t\t\t'maxplaybackrate': 500 * 1024 * 8, // 500 kbits\n// \t\t\t'cbr': 0, // disable cbr\n// \t\t\t'useinbandfec': 1, // use inband fec\n// \t\t\t'usedtx': 1, // use dtx\n// \t\t\t'maxptime': 3\n// \t\t});\n\t\t\nfunction mySDPTransform(sdp) {\n// \tsdp = BandwidthHandler.setOpusAttributes(sdp, {\n// \t\t'stereo': 0, // to disable stereo (to force mono audio)\n// \t\t'sprop-stereo': 1,\n// \t\t'maxaveragebitrate': 500 * 1024 * 8, // 500 kbits\n// \t\t'maxplaybackrate': 500 * 1024 * 8, // 500 kbits\n// \t\t'cbr': 0, // disable cbr\n// \t\t'useinbandfec': 1, // use inband fec\n// \t\t'usedtx': 1, // use dtx\n// \t\t'maxptime': 3\n// \t});\n\n\tvar bandwidth = {\n\t\tscreen: 300, // 300kbits minimum\n\t\taudio: 500,   // 500kbits  minimum\n\t\tvideo: 256   // 256kbits (both min-max)\n\t};\n\tvar isScreenSharing = false;\n\n\tsdp = BandwidthHandler.setApplicationSpecificBandwidth(sdp, bandwidth, isScreenSharing);\n\tsdp = BandwidthHandler.setVideoBitrates(sdp, {\n\t\tmin: bandwidth.video,\n\t\tmax: bandwidth.video\n\t});\n\tsdp = BandwidthHandler.setOpusAttributes(sdp);\n\n\treturn sdp;\n}\n\n\n\n/* AUDIO 3.0 */\nlet peer = new SimplePeer({\n\tinitiator: false,\n\ttrickle: true,\n\tsdpTransform: mySDPTransform,\n});\n\npeer.on(\"error\", function(err) {\n\tconsole.log(\"error\", err)\n});\n\npeer.on(\"signal\", function(data) {\n\tconsole.log(\"SIGNAL\", JSON.stringify(data));\n\tsocket.emit(\"clientPeerSignal\", JSON.stringify(data));\n});\n\npeer.on(\"connect\", function() {\n\tconsole.log(\"CONNECT\");\n\tpeer.send(Math.random());\n});\n\npeer.on(\"data\", function(data) {\n\tconsole.log(\"data: \" + data)\n});\n\nsocket.on(\"hostPeerSignal\", function(data) {\n\tpeer.signal(JSON.parse(data));\n});\n\nlet audio = document.createElement(\"audio\");\n\npeer.on(\"stream\", function (stream) {\n\t// got remote audio stream, then show it in an audio tag\n\taudio.src = window.URL.createObjectURL(stream);// deprecated\n// \t\t\taudio.srcObj = stream;\n\taudio.play();\n\taudio.volume = 0;\n});\n\n$(\"#enableAudioThreeCheckbox\").on(\"change\", function() {\n\tsettings.enableAudioThree = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\tif (settings.enableAudioThree) {\n\t\tif (!audioConnected) {\n\t\t\tsocket.emit(\"requestAudio\");\n\t\t\tsetTimeout(function() {\n\t\t\t\taudioConnected = true;\n\t\t\t}, 100);\n\t\t}\n\t} else {\n\t\ttry {\n\t\t\taudio.volume = 0;\n\t\t\tplayer.volume = settings.volume / 100;\n\t\t} catch (error) {\n\t\t}\n\t\t$(\"#audioThreeCheckbox\").prop(\"checked\", false);\n\t\t$(\".audioThreeCheckbox\").prop(\"checked\", false);\n\t}\n});\n\n\n$(\"#audioThreeCheckbox\").on(\"change\", function() {\n\tif (!settings.enableAudioThree) {\n\t\t$(\"#audioThreeCheckbox\").prop(\"checked\", false);\n\t\tswal(\"You need to enable Audio 3.0 first!\");\n\t\treturn;\n\t}\n\tsettings.audioThree = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\tif (settings.audioThree) {\n\t\tif (!audioConnected) {\n// \t\t\tsetTimeout(function() {\n\t\t\t\taudio.volume = settings.volume / 100;\n// \t\t\t}, 8000);\n\t\t} else {\n\t\t\ttry {\n\t\t\t\taudio.volume = settings.volume / 100;\n\t\t\t\tplayer.volume = 0;\n\t\t\t} catch (error) {\n\t\t\t}\n\t\t}\n\t} else {\n// \t\t$(\"#audioThreeCheckbox\").prop(\"checked\", false);\n\t\taudio.volume = 0;\n\t\tplayer.volume = settings.volume / 100;\n\t}\n});\n\n$(\".audioThreeCheckbox\").on(\"change\", function() {\n\t$(\"#audioThreeCheckbox\").trigger(\"click\");\n\tsetTimeout(function() {\n\t\t$(\".audioThreeCheckbox\").prop(\"checked\", $(\"#audioThreeCheckbox\").prop(\"checked\"));\n\t}, 100);\n});\n\n\n\n/* QUEUE @@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\nsocket.on(\"controlQueues\", function(data) {\n\t\n\tlet sameQueues = [];\n\tfor (let i = 0; i < data.controlQueues.length; i++) {\n\t\tsameQueues.push(JSON.stringify(controlQueues[i]) === JSON.stringify(data.controlQueues[i]))\n\t}\n\t\n\tlet controlQueuesChanged = (JSON.stringify(controlQueues) !== JSON.stringify(data.controlQueues));\n\tcontrolQueues = data.controlQueues;\n\t\n\tfor (let i = 0; i < data.controlQueues.length; i++) {\n\t\t\n\t\t// don't do anything if it hasn't changed:\n\t\tif (sameQueues[i]) {\n\t\t\tcontinue;\n\t\t}\n\t\t\n\t\t$(\"#controlQueue\" + (i + 1)).empty();\n\t\tfor (let j = 0; j < data.controlQueues[i].length; j++) {\n\t\t\tlet username = usernameMap[data.controlQueues[i][j]];\n\t\t\tlet html;\n\t\t\tif (!settings.darkTheme) {\n\t\t\t\thtml = '<li class=\"queueItem list-group-item\" data-toggle=\"popover\" tabindex=\"0\">' + username + \"</li>\";\n\t\t\t} else {\n\t\t\t\thtml = '<li class=\"queueItem list-group-item-dark\" data-toggle=\"popover\" tabindex=\"0\">' + username + \"</li>\";\n\t\t\t}\n\t\t\t$(\"#controlQueue\" + (i + 1)).append(html);\n\t\t}\n\t\t\n\t\tlet html;\n\t\tif (!settings.darkTheme) {\n\t\t\thtml = \"<li class='list-group-item'>The queue is empty.</li>\";\n\t\t} else {\n\t\t\thtml = \"<li class='list-group-item-dark'>The queue is empty.</li>\";\n\t\t}\n\t\tif (data.controlQueues[i].length === 0) {\n\t\t\t$(\"#controlQueue\" + (i + 1)).append(html);\n\t\t}\n\t\t\n\t}\n\t\n\tif (controlQueuesChanged) {\n\t\t// join / leave button management:\n\t\t// for each queue:\n\t\tfor (let i = 0; i < controlQueues.length; i++) {\n\t\t\t// check if user is in this queue:\n\t\t\tif (controlQueues[i].indexOf(myUniqueID) > -1) {\n\t\t\t\t// change request button -> cancel button:\n\t\t\t\tlet cancelTurnButton = $(\"#cancelTurn\" + (i+1))[0];\n\t\t\t\tif (typeof cancelTurnButton == \"undefined\") {\n\t\t\t\t\tlet html = '<button id=\"cancelTurn' + (i + 1) + '\" class=\"cancelTurn btn btn-secondary\" code=\"'+ i +'\">Leave Queue</button>';\n\t\t\t\t\t$(\"#requestTurn\" + (i+1)).replaceWith(html);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// change cancel button -> request button:\n\t\t\t\tlet requestTurnButton = $(\"#requestTurn\" + (i + 1))[0];\n\t\t\t\tif (typeof requestTurnButton == \"undefined\") {\n\t\t\t\t\tlet html = '<button id=\"requestTurn' + (i + 1) + '\" class=\"requestTurn btn btn-secondary\" code=\"'+ i +'\">Join Queue</button>';\n\t\t\t\t\t$(\"#cancelTurn\" + (i+1)).replaceWith(html);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n// \t\t$(window).trigger(\"resize.fittext\");\n\t}\n\t\n});\n\n/* MOD COMMANDS */\n// selects elements in the future:\n// https://stackoverflow.com/questions/8191064/jquery-on-function-for-future-elements-as-live-is-deprecated\n\n$(\"body\").popover({\n\tselector: \".queueItem\",\n\ttrigger: \"focus\",\n\thtml: true,\n\ttoggle: \"popover\",\n\ttitle: \"Mod Powers\",\n\tboundary: \"window\",\n\tcontainer: \"body\",\n\tplacement: \"right\",\n\tcontent: '<button id=\"kickFromQueue\" class=\"btn btn-secondary\">Kick From Queue</button>\\\n\t\t\t\t<button id=\"tempBan\" class=\"btn btn-secondary\">Temporary Ban (5 min)</button>\\\n\t\t\t\t<button id=\"permaBan\" class=\"btn btn-secondary\"><b>Permanent Ban</b></button>',\n});\n// .click(function() {\n// \tsetTimeout(function () {\n// \t\t$('[data-toggle=\"popover\"]').popover(\"hide\");\n// \t}, 8000);\n// });\n\n$(\"#container\").popover({// must be unique\n\tselector: \".viewerElement\",\n// \ttrigger: \"focus\",\n\thtml: true,\n\ttoggle: \"popover\",\n\ttitle: \"Mod Powers\",\n\tboundary: \"window\",\n\tcontainer: \"body\",\n\tplacement: \"right\",\n\tcontent: '<button id=\"kickFromQueue\" class=\"btn btn-secondary\">Kick From Queue</button>\\\n\t\t\t\t<button id=\"tempBan\" class=\"btn btn-secondary\">Temporary Ban (5 min)</button>\\\n\t\t\t\t<button id=\"permaBan\" class=\"btn btn-secondary\"><b>Permanent Ban</b></button>\\\n\t\t\t\t<button id=\"unban\" class=\"btn btn-secondary\"><b>Unban</b></button>',\n}).click(function() {\n\tsetTimeout(function () {\n\t\t$('[data-toggle=\"popover\"]').popover(\"hide\");\n\t}, 8000);\n});\n\n\nlet modPowerUniqueID = \"\";\n$(document).on(\"click\", \".queueItem\", function(event) {\n\t$(this).effect(\"highlight\", {}, 2000);\n\tlet userIndex = $(this).index();\n\tlet queueIndex = parseInt($(this).parent().attr(\"id\").slice(-1))-1;\n\tmodPowerUniqueID = controlQueues[queueIndex][userIndex];\n});\n\n$(document).on(\"click\", \".viewerElement\", function(event) {\n\t$(this).effect(\"highlight\", {}, 2000);\n// \tuserIndex = $(this).index();\n// \tqueueIndex = parseInt($(this).parent().attr(\"id\").slice(-1))-1;\n\tmodPowerUniqueID = $(this).attr(\"uniqueID\");\n});\n\n$(document).on(\"click\", \"#kickFromQueue\", function(event) {\n\tsocket.emit(\"kickFromQueue\", modPowerUniqueID);\n\t$(\"#queuePopup\").remove();\n});\n$(document).on(\"click\", \"#tempBan\", function(event) {\n\tsocket.emit(\"tempBan\", modPowerUniqueID);\n\t$(\"#queuePopup\").remove();\n});\n$(document).on(\"click\", \"#permaBan\", function(event) {\n\tsocket.emit(\"permaBan\", modPowerUniqueID);\n\t$(\"#queuePopup\").remove();\n});\n$(document).on(\"click\", \"#unban\", function(event) {\n\tsocket.emit(\"unban\", modPowerUniqueID);\n\t$(\"#queuePopup\").remove();\n});\n\n\n$(document).on(\"click\", 'i:contains(\"lock\")', function(event) {\n\t$(this).effect(\"highlight\", {}, 2000);\n\tsocket.emit(\"unlock\");\n});\n$(document).on(\"click\", 'i:contains(\"lock_open\")', function(event) {\n\t$(this).effect(\"highlight\", {}, 2000);\n\tsocket.emit(\"lock\");\n});\n$(document).on(\"click\", 'i:contains(\"network_wifi\")', function(event) {\n\t$(this).effect(\"highlight\", {}, 2000);\n\tsocket.emit(\"disableInternet\");\n});\n$(document).on(\"click\", 'i:contains(\"signal_wifi_off\")', function(event) {\n\t$(this).effect(\"highlight\", {}, 2000);\n\tsocket.emit(\"enableInternet\");\n});\n\nsocket.on(\"turnTimesLeft\", function(data) {\n\t\n\tlastCurrentTime = Date.now();\n\tlet viewersChanged = (JSON.stringify(viewers) !== JSON.stringify(data.viewers));\n\tlet waitlistsChanged = (JSON.stringify(waitlists) !== JSON.stringify(data.waitlists));\n\tviewers = data.viewers;\n\twaitlists = data.waitlists;\n\tif (locked != data.locked) {\n\t\tlocked = data.locked;\n\t\tif (locked) {\n\t\t\tlet iconHTML = '<i class=\"material-icons\">lock</i>';\n\t\t\t$('i:contains(\"lock_open\")').replaceWith(iconHTML);\n\t\t} else {\n\t\t\tlet iconHTML = '<i class=\"material-icons\">lock_open</i>';\n\t\t\t$('i:contains(\"lock\")').replaceWith(iconHTML);\n\t\t}\n\t}\n\tif (wifiEnabled != data.wifiEnabled) {\n\t\twifiEnabled = data.wifiEnabled;\n\t\tif (wifiEnabled) {\n\t\t\tlet iconHTML = '<i class=\"material-icons\">network_wifi</i>';\n\t\t\t$('i:contains(\"signal_wifi_off\")').replaceWith(iconHTML);\n\t\t\t// \"signal_wifi\" gives you an icon not in the material design docs\n\t\t} else {\n\t\t\tlet iconHTML = '<i class=\"material-icons\">signal_wifi_off</i>';\n\t\t\t$('i:contains(\"network_wifi\")').replaceWith(iconHTML);\n\t\t}\n\t}\n\t\n\t\n// \tisExempt = false;\n// \tfor (let i = 0; i < 5; i++) {\n// \t\tlet index = controlQueues[i].indexOf(myUniqueID);\n// \t\tif (index < minQueuePos && index > -1) {\n// \t\t\tisExempt = true;\n// \t\t}\n// \t}\n\t\n// \tif (!isExempt && viewers[settings.tab-1].length > maxViewersOnTab[settings.tab-1] && tabSwappedWithTwitch[settings.tab-1] === false) {\n// \t\ttabSwappedWithTwitch[settings.tab-1] = true;\n// \t\tsetTimeout(function() {\n// \t\t\treplaceWithTwitch(\"#lagless\" + settings.tab);\n// \t\t\tsetTimeout(function() {\n// \t\t\t\tsocket.emit(\"leaveLagless\");\n// \t\t\t}, 4000);\n// \t\t\tswal(\"The server is a bit overloaded right now, the lagless stream will be swapped out for twitch.\");\n// \t\t}, 2000);\n// \t}\n\t\n// \t// check if exempt, replace any twitch streams with lagless:\n// \tif (isExempt) {\n// \t\t//for (let i = 0; i < 5; i++) {\n// \t\treplaceWithLagless(\"#lagless\" + settings.tab);\n// \t\t//}\n// \t}\n\t\n\tfor (let i = 0; i < data.turnTimesLeft.length; i++) {\n\t\tlet timeLeftMilli = data.turnTimesLeft[i];\n\t\tlet timeLeftSec = parseInt(data.turnTimesLeft[i] / 1000);\n\t\tlet percent = parseInt((timeLeftMilli / data.turnLengths[i]) * 100);\n\n\t\tlet timeLeftMilli2 = data.forfeitTimesLeft[i];\n\t\tlet timeLeftSec2 = parseInt(timeLeftMilli2 / 1000);\n\t\tlet percent2 = parseInt((timeLeftMilli2 / timeTillForfeit) * 100);\n\t\t\n\t\tlet n = i + 1;\n\t\t\n\t\tif (controlQueues[i][0] == null) {\n\t\t\t$(\"#turnTimerBarChild\" + n).css(\"width\", \"100%\").attr(\"aria-valuenow\", \"100%\").text(\"No one is playing right now.\");\n\t\t\t$(\"#forfeitTimerBarChild\" + n).css(\"width\", \"100%\").attr(\"aria-valuenow\", \"100%\").text(\"No one is playing right now.\");\n\t\t} else {\n\t\t\t$(\"#turnTimerBarChild\" + n).css(\"width\", percent + \"%\").attr(\"aria-valuenow\", percent + \"%\").text(usernameMap[controlQueues[i][0]] + \": \" + timeLeftSec + \" seconds\");\n\t\t\t$(\"#forfeitTimerBarChild\" + n).css(\"width\", percent2 + \"%\").attr(\"aria-valuenow\", percent2 + \"%\").text(timeLeftSec2 + \" seconds until turn forfeit.\");\n\t\t}\n\t}\n\t\n\tlet totalViewers = data.viewers[0].length + data.viewers[1].length + data.viewers[2].length + data.viewers[3].length + data.viewers[4].length;\n\t\n\t\n\tif(viewersChanged) {\n\t\t\n// \t\t$(window).trigger(\"resize.fittext\");\n\t\t\n\t\t// for each lagless tab\n\t\tfor (let i = 0; i < 4; i++) {\n\t\t\t\n\t\t\t$(\"#lagless\" + (i + 1) + \"ViewerDropdownDiv\").empty();\n\t\t\tfor (let j = 0; j < data.viewers[i].length; j++) {\n// \t\t\t\tlet html = '<button class=\"viewerElement dropdown-item\" data-toggle=\"popover\" tabindex=\"0\">' + usernameMap[data.viewers[i][j]] + \"</button>\";\n\t\t\t\tlet html = '<button class=\"viewerElement dropdown-item\" data-toggle=\"popover\" tabindex=\"0\" uniqueID=\"' + data.viewers[i][j] + '\">' + usernameMap[data.viewers[i][j]] + \"</button>\";\n\t\t\t\t$(\"#lagless\" + (i + 1) + \"ViewerDropdownDiv\").append(html);\n\t\t\t}\n\t\t\t\n\t\t\t// for each lagless tab:\n\t\t\tfor (let k = 0; k < 4; k++) {\n\t\t\t\t// skip the tab we already did:\n\t\t\t\tif (k == i) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (data.viewers[k].length > 0) {\n\t\t\t\t\tlet dividerHTML = '<div class=\"dropdown-divider\">Lagless ' + (k + 1) + \"</div>\";\n\t\t\t\t\t$(\"#lagless\" + (i + 1) + \"ViewerDropdownDiv\").append(dividerHTML);\n\t\t\t\t\tfor (let j = 0; j < data.viewers[k].length; j++) {\n// \t\t\t\t\t\tlet html = '<button class=\"viewerElement dropdown-item\" data-toggle=\"popover\" tabindex=\"0\">' + usernameMap[data.viewers[k][j]] + \"</button>\";\n\t\t\t\t\t\tlet html = '<button class=\"viewerElement dropdown-item\" data-toggle=\"popover\" tabindex=\"0\" uniqueID=\"' + data.viewers[i][j] + '\">' + usernameMap[data.viewers[i][j]] + \"</button>\";\n\t\t\t\t\t\t$(\"#lagless\" + (i + 1) + \"ViewerDropdownDiv\").append(html);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// lagless / twitch swap\n\t\n\tif (waitlistsChanged) {\n\t\t\n\t\t$(\"#waitlist\").empty();\n\t\t\n\t\tlet waitlistHeaderHTML = '<li class=\"list-group-item\">Lagless ' + settings.tab + \" waitlist</li>\";\n\t\t$(\"#waitlist\").append(waitlistHeaderHTML);\n\t\t\n\t\tfor (let i = 0; i < waitlists[settings.tab-1].length; i++) {\n\t\t\tlet listHTML;\n\t\t\t\n\t\t\tlet ID = waitlists[settings.tab-1][i];\n\t\t\t\n\t\t\tif (myUniqueID == ID) {\n\t\t\t\t\n// \t\t\t\tif (!tabsSwappedWithTwitch[settings.tab-1]) {\n// \t\t\t\t\ttabsSwappedWithTwitch[settings.tab-1] = true;\n// \t\t\t\t\treplaceWithTwitch(\"#lagless\" + settings.tab);\n// \t\t\t\t\tsetTimeout(function() {\n// \t\t\t\t\t\tsocket.emit(\"leaveLagless\");\n// \t\t\t\t\t}, 4000);\n// \t\t\t\t\tswal(\"The server is a bit overloaded right now, the lagless stream will be swapped out for twitch.\");\n// \t\t\t\t}\n\t\t\t\t\n\t\t\t\tlistHTML = '<li class=\"list-group-item-highlight\">' + usernameMap[ID] + \"</li>\";\n\t\t\t} else if (settings.darkTheme) {\n\t\t\t\tlistHTML = '<li class=\"list-group-item-dark\">' + usernameMap[ID] + \"</li>\";\n\t\t\t} else {\n\t\t\t\tlistHTML = '<li class=\"list-group-item\">' + usernameMap[ID] + \"</li>\";\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t$(\"#waitlist\").append(listHTML);\n\t\t}\n\t\t\n\t\t// check if you're in the waitlist\n\t\tif (waitlists[settings.tab-1].indexOf(myUniqueID) > -1) {\n\t\t\t\n\t\t\tif (!tabsSwappedWithTwitch[settings.tab-1]) {\n\t\t\t\ttabsSwappedWithTwitch[settings.tab-1] = true;\n\t\t\t\treplaceWithTwitch(\"#lagless\" + settings.tab);\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tsocket.emit(\"leaveLagless\");\n\t\t\t\t}, 4000);\n\t\t\t\tswal(\"The server is a bit overloaded right now, the lagless stream will be swapped out for twitch temporarily, check the discord server for the rules on how this works.\");\n\t\t\t}\n\t\t\t\n\t\t} else if (tabsSwappedWithTwitch[settings.tab-1]) {\n\t\t\ttabsSwappedWithTwitch[settings.tab-1] = false;\n// \t\t\tswal(\"You're at the top of the waitlist! switching back to lagless!\");\n\t\t\treplaceWithLagless(\"#lagless\" + settings.tab);\n\t\t}\n\t\t\n\t\t\n// \t\tfor (let i = 0; i < 3; i++) {\n// \t// \t\tif (!tabsSwappedWithTwitch[i]) {\n\n// \t// \t\t}\n\n// \t\t}\n\t}\n\t\n\t\n\t\n\t\n\t\n});\n\n\n// setInterval(function() {\n// \tlet currentTime = Date.now();\n// \tlet elapsedTime = currentTime - lastCurrentTime;\n// \tlet timeLeftMilli = timeLeft - elapsedTime;\n// \tlet timeLeftSec = parseInt(timeLeftMilli / 1000);\n// \tlet percent = parseInt((timeLeftMilli / turnLength) * 100);\n// \tlet progressBar = $(\".progress-bar\");\n// \tprogressBar.css(\"width\", percent + \"%\").attr(\"aria-valuenow\", percent + \"%\").text(turnUsername + \": \" + timeLeftSec + \" seconds\");\n// }, 200);\n\n\nsocket.on(\"forceRefresh\", function(data) {\n\tswal({\n\t\ttitle: \"There has been a force refresh!\",\n\t}).then((result) => {\n\t\tif (result.value) {\n\t\t\tlocation.reload(true);\n\t\t}\n\t});\n\t\n\t// actually force after 5 seconds:\n\tsetTimeout(function() {\n\t\tlocation.reload(true);\n\t}, 5000);\n\t\n});\n\n$(document).on(\"click\", \".requestTurn\", function(event) {\n\tlet cNum = parseInt($(this).attr(\"code\"));\n\tfor (let i = 0; i < controlQueues.length; i++) {\n\t\tif (i == cNum) {\n\t\t\tcontinue;\n\t\t}\n\t\tsocket.emit(\"cancelTurn\", i);\n\t}\n\tsocket.emit(\"requestTurn\", cNum);\n});\n\n$(document).on(\"click\", \".cancelTurn\", function(event) {\n\tlet cNum = parseInt($(this).attr(\"code\"));\n\tsocket.emit(\"cancelTurn\", cNum);\n});\n\n\n/* MULTIPLAYER @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n$(\"#player1Checkbox\").prop(\"checked\", true).trigger(\"change\");\n$(\"#player1Checkbox\").on(\"change\", function(event) {\n\tif (this.checked) {\n\t\tsocket.emit(\"cancelTurn\", currentPlayerChosen);\n\t\tcurrentPlayerChosen = 0;\n\t\t$(\"#player2Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player3Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player4Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player5Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t} else {\n\t\t// prevent unchecking\n\t\tevent.preventDefault();\n\t}\n});\n\n$(\"#player2Checkbox\").on(\"change\", function(event) {\n\tif (this.checked) {\n\t\tsocket.emit(\"cancelTurn\", currentPlayerChosen);\n\t\tcurrentPlayerChosen = 1;\n\t\t$(\"#player1Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player3Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player4Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player5Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t} else {\n\t\t// prevent unchecking\n\t\tevent.preventDefault();\n\t}\n});\n\n$(\"#player3Checkbox\").on(\"change\", function(event) {\n\tif (this.checked) {\n\t\tsocket.emit(\"cancelTurn\", currentPlayerChosen);\n\t\tcurrentPlayerChosen = 2;\n\t\t$(\"#player1Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player2Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player4Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player5Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t} else {\n\t\t// prevent unchecking\n\t\tevent.preventDefault();\n\t}\n});\n\n$(\"#player4Checkbox\").on(\"change\", function(event) {\n\tif (this.checked) {\n\t\tsocket.emit(\"cancelTurn\", currentPlayerChosen);\n\t\tcurrentPlayerChosen = 3;\n\t\t$(\"#player1Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player2Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player3Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player5Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t} else {\n\t\t// prevent unchecking\n\t\tevent.preventDefault();\n\t}\n});\n\n$(\"#player5Checkbox\").on(\"change\", function(event) {\n\tif (this.checked) {\n\t\tsocket.emit(\"cancelTurn\", currentPlayerChosen);\n\t\tcurrentPlayerChosen = 4;\n\t\t$(\"#player1Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player2Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player3Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#player4Checkbox\").prop(\"checked\", false).trigger(\"change\");\n\t} else {\n\t\t// prevent unchecking\n\t\tevent.preventDefault();\n\t}\n});\n\n\n/* TOGGLE KEYBOARD @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n$(\"#keyboardControlsCheckbox\").on(\"change\", function() {\n\tsettings.keyboardControls = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n});\n\n/* TOGGLE CONTROLLER @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n$(\"#controllerControlsCheckbox\").on(\"change\", function() {\n\tsettings.controllerControls = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n});\n\n\n/* DARK THEME @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n\n$(\"#darkThemeCheckbox\").on(\"change\", function() {\n\tsettings.darkTheme = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\tif (settings.darkTheme) {\n\t\tlet icon = $(\".glyphicon-fire\");\n\t\ticon.removeClass(\"glyphicon-fire\");\n\t\ticon.addClass(\"glyphicon-certificate\");\n\t\t\n\t\t$(\".light\").each(function() {\n\t\t\t$(this).removeClass(\"light\");\n\t\t\t$(this).addClass(\"dark\");\n\t\t});\n\t\t\n\t\t$(\".otborder\").each(function() {\n\t\t\t$(this).removeClass(\"otborder\");\n\t\t\t$(this).addClass(\"otborder-dark\");\n\t\t});\n\t\t\n\t\t$(\".list-group-item\").each(function() {\n\t\t\t$(this).removeClass(\"list-group-item\");\n\t\t\t$(this).addClass(\"list-group-item-dark\");\n\t\t});\n\t\t\n\t\t$(\".nav-link\").each(function() {\n\t\t\t$(this).removeClass(\"nav-link\");\n\t\t\t$(this).addClass(\"nav-link-dark\");\n\t\t});\n\t\t\n\t\t$(\"body\").addClass(\"dark\");\n\t\t\n\t\t$(\"#chat\").attr(\"src\", \"https://www.twitch.tv/embed/twitchplaysconsoles/chat?darkpopout\");\n\t\t\n\t} else {\n\t\t\n\t\tlet icon = $(\".glyphicon-certificate\");\n\t\ticon.removeClass(\"glyphicon-certificate\");\n\t\ticon.addClass(\"glyphicon-fire\");\n\t\t\n\t\t$(\".dark\").each(function() {\n\t\t\t$(this).removeClass(\"dark\");\n\t\t\t$(this).addClass(\"light\");\n\t\t});\n\t\t\n\t\t$(\".otborder-dark\").each(function() {\n\t\t\t$(this).removeClass(\"otborder-dark\");\n\t\t\t$(this).addClass(\"otborder\");\n\t\t});\n\t\t\n\t\t$(\".list-group-item-dark\").each(function() {\n\t\t\t$(this).removeClass(\"list-group-item-dark\");\n\t\t\t$(this).addClass(\"list-group-item\");\n\t\t});\n\t\t\n\t\t$(\".nav-link-dark\").each(function() {\n\t\t\t$(this).removeClass(\"nav-link-dark\");\n\t\t\t$(this).addClass(\"nav-link\");\n\t\t});\n\t\t\n\t\t$(\"body\").removeClass(\"dark\");\n// \t\t$(\"body\").addClass(\"light\");\n\t\t\n\t\t$(\"#chat\").attr(\"src\", \"https://www.twitch.tv/embed/twitchplaysconsoles/chat\");\n\t}\n});\n\n\n/* TOGGLE FULLSCREEN @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n$(\"#fullscreenCheckbox\").on(\"change\", function() {\n\tsettings.fullscreen = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\tif (settings.fullscreen) {\n\t\t\n\t\t$(\"#picture\").css(\"width\", \"100%\");\n\t\t$(\".videoCanvas\").css(\"width\", \"100%\");\n\t\t$(\".videoCanvas\").css(\"margin-left\", \"0\");\n\t\t$(\".laglessContainer\").css(\"padding-left\", \"0\");\n\t\t$(\".laglessContainer\").css(\"padding-right\", \"0\");\n\t\t\n\t\tif (settings.touchControls) {\n\t\t\t$(\"#touchControlsCheckbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t}\n\t\tif (!settings.hideChat) {\n\t\t\t$(\"#hideChatCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\tif (!settings.hideNav) {\n\t\t\t$(\"#navCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\t}\n\t\t\n\t\t$(\".well\").each(function() {\n\t\t\t$(this).removeClass(\"well\");\n\t\t\t$(this).addClass(\"well2\");\n\t\t});\n\t\t$(\"body\").addClass(\"well2\");\n\t\t$(\"body\").addClass(\"hideScrollbar\");\n\t\t$(document).scrollTop(0);\n\t\t\n\t\ttools.toggleFullScreen($(\"body\")[0]);\n\t\t\n\t} else {\n\t\t$(\"#picture\").css(\"width\", \"\");\n// \t\t$(\".videoCanvas\").css(\"width\", \"100%\");\n// \t\t$(\".videoCanvas\").css(\"margin-left\", \"0\");\n\t\t$(\".laglessContainer\").css(\"padding-left\", \"\");\n\t\t$(\".laglessContainer\").css(\"padding-right\", \"\");\n\t\t\n\t\t$(\".well2\").each(function() {\n\t\t\t$(this).removeClass(\"well2\");\n\t\t\t$(this).addClass(\"well\");\n\t\t});\n\t\t$(\"body\").removeClass(\"well2\");\n\t\t$(\"body\").removeClass(\"hideScrollbar\");\n\t}\n});\n\nwindow.addEventListener(\"keydown\", function(e) {\n\t// escape, f11\n\tif ([27, 122].indexOf(e.keyCode) > -1) {\n\t\te.preventDefault();\n\t\t$(\"body\").removeClass(\"hideScrollbar\");\n\t}\n}, false);\n\nif (document.addEventListener) {\n    document.addEventListener(\"webkitfullscreenchange\", exitHandler, false);\n    document.addEventListener(\"mozfullscreenchange\", exitHandler, false);\n    document.addEventListener(\"fullscreenchange\", exitHandler, false);\n    document.addEventListener(\"MSFullscreenChange\", exitHandler, false);\n}\n\n// https://stackoverflow.com/questions/10706070/how-to-detect-when-a-page-exits-fullscreen\nfunction exitHandler() {\n\tif (!document.webkitIsFullScreen && !document.mozFullScreen && !document.msFullscreenElement) {\n\t\tconsole.log(\"exiting fullscreen\");\n\t\t$(\"body\").removeClass(\"hideScrollbar\");\n\t\t$(\"#fullscreenCheckbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#hideChatCheckbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#navCheckbox\").prop(\"checked\", false).trigger(\"change\");\n\t\t$(\"#touchControlsCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t\tresizeChat();\n\t}\n}\n\n/* TOGGLE LARGESCREEN @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n$(\"#largescreenCheckbox\").on(\"change\", function() {\n\tsettings.largescreen = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\tif (settings.largescreen) {\n\t\t$(\".videoCanvas\").css(\"width\", \"100%\");\n\t\t$(\".videoCanvas\").css(\"margin-left\", \"0\");\n\t\tif (settings.touchControls) {\n\t\t\t$(\"#touchControlsCheckbox\").prop(\"checked\", false);\n\t\t\tsettings.touchControls = false;\n\t\t\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\t\t\trebindUnbindTouchControls();\n\t\t}\n\t} else {\n\t\t$(\".videoCanvas\").css(\"width\", \"75%\");\n\t\t$(\".videoCanvas\").css(\"margin-left\", \"12.5%\");\n\t\t$(\"#touchControlsCheckbox\").prop(\"checked\", true).trigger(\"change\");\n\t}\n});\n\n\n/* TOGGLE HIDE NAV @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n$(\"#navCheckbox\").on(\"change\", function() {\n\tsettings.hideNav = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\tif (settings.hideNav) {\n\t\t$(\".nav\")[0].style.display = \"none\"\n\t} else {\n\t\t$(\".nav\")[0].style.display = \"\"\n\t}\n});\n\n/* TOGGLE DPAD SWAP @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n$(\"#dpadCheckbox\").on(\"change\", function() {\n\tsettings.dpadSwap = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n});\n\n/* TOGGLE 3DS CONFIG @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n$(\"#3DSCheckbox\").on(\"change\", function() {\n\tsettings.TDSConfig = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n});\n\n\n/* TOGGLE YOUTUBE CHAT @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n$(\"#youtubeChatCheckbox\").on(\"change\", function() {\n\tsettings.youtubeChat = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\tif (settings.youtubeChat) {\n\t\t$(\"#chat\").attr(\"src\", \"https://www.youtube.com/live_chat?v=8jgSgQcZgGY&embed_domain=twitchplaysnintendoswitch.com\");\n\t} else {\n\t\tif (settings.darkTheme) {\n\t\t\t$(\"#chat\").attr(\"src\", \"https://www.twitch.tv/embed/twitchplaysconsoles/chat?darkpopout\");\n\t\t} else {\n\t\t\t$(\"#chat\").attr(\"src\", \"https://www.twitch.tv/embed/twitchplaysconsoles/chat\");\n\t\t}\n\t}\n});\n\n/* TOGGLE CHAT @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n$(\"#hideChatCheckbox\").on(\"change\", function() {\n\tsettings.hideChat = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n\tif (settings.hideChat) {\n\t\t$(\"#chatContainer\")[0].style.display = \"none\";\n\t\t$(\"#picture\").css(\"width\", \"100%\");\n\t} else {\n\t\t$(\"#chatContainer\")[0].style.display = \"\";\n\t\t$(\"#picture\").css(\"width\", \"\");\n\t}\n});\n\n\n/* TOGGLE ANALOG STICK MODE @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n$(\"#analogStickCheckbox\").on(\"change\", function() {\n\tsettings.analogStickMode = this.checked;\n\tlocalforage.setItem(\"settings\", JSON.stringify(settings));\n});\n\n\n\n/* CONTROLLER VIEW @@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\nsocket.on(\"controllerState1\", function(data) {\n\t\n\tlet str = data;\n\tlet dpad = str[0];\n\t\n\tlet btns = [];\n\tlet unpressedBtns = [\"upButton\", \"downButton\", \"leftButton\", \"rightButton\", \"aButton\", \"bButton\", \"xButton\", \"yButton\", \"lButton\", \"zlButton\", \"rButton\", \"zrButton\", \"minusButton\", \"captureButton\", \"plusButton\", \"homeButton\", \"leftStick\", \"rightStick\"];\n\t\n\tif(dpad == \"7\") {\n\t\tbtns.push(\"upButton\");\n\t\tbtns.push(\"leftButton\");\n\t} else if (dpad == \"1\") {\n\t\tbtns.push(\"upButton\");\n\t\tbtns.push(\"rightButton\");\n\t} else if (dpad == \"5\") {\n\t\tbtns.push(\"downButton\");\n\t\tbtns.push(\"leftButton\");\n\t} else if (dpad == \"3\") {\n\t\tbtns.push(\"downButton\");\n\t\tbtns.push(\"rightButton\");\n\t} else if (dpad == \"0\") {\n\t\tbtns.push(\"upButton\");\n\t} else if (dpad == \"4\") {\n\t\tbtns.push(\"downButton\");\n\t} else if (dpad == \"6\") {\n\t\tbtns.push(\"leftButton\");\n\t} else if (dpad == \"2\") {\n\t\tbtns.push(\"rightButton\");\n\t} else if (dpad == \"8\") {\n\t\t// nothing\n\t}\n\t\n\tif (str[6] == \"1\") {\n\t\tbtns.push(\"aButton\");\n\t}\n\tif (str[7] == \"1\") {\n\t\tbtns.push(\"bButton\");\n\t}\n\tif (str[8] == \"1\") {\n\t\tbtns.push(\"xButton\");\n\t}\n\tif (str[9] == \"1\") {\n\t\tbtns.push(\"yButton\");\n\t}\n\t\n\t\n\tif (str[2] == \"1\") {\n\t\tbtns.push(\"lButton\");\n\t}\n\tif (str[3] == \"1\") {\n\t\tbtns.push(\"zlButton\");\n\t}\n\t\n\tif (str[11] == \"1\") {\n\t\tbtns.push(\"rButton\");\n\t}\n\tif (str[12] == \"1\") {\n\t\tbtns.push(\"zrButton\");\n\t}\n\t\n\t\n\tif (str[4] == \"1\") {\n\t\tbtns.push(\"minusButton\");\n\t}\n\tif (str[5] == \"1\") {\n\t\tbtns.push(\"captureButton\");\n\t}\n\t\n\tif (str[13] == \"1\") {\n\t\tbtns.push(\"plusButton\");\n\t}\n\tif (str[14] == \"1\") {\n\t\tbtns.push(\"homeButton\");\n\t}\n\t\n\tif (str[1] == \"1\") {\n\t\tbtns.push(\"leftStick\");\n\t}\n\tif (str[10] == \"1\") {\n\t\tbtns.push(\"rightStick\");\n\t}\n\t\n\tunpressedBtns = unpressedBtns.filter( function(el) {\n\t\treturn !btns.includes(el);\n\t});\n\t\n\ttry {\n\t\tfor (let i = 0; i < btns.length; i++) {\n\t\t\t$(\"#\" + btns[i])[0].style.background = \"rgba(80, 187, 80, 0.7)\";//50bb50\n\t\t}\n\t\tfor (let i = 0; i < unpressedBtns.length; i++) {\n\t\t\t$(\"#\" + unpressedBtns[i])[0].style.background = \"\";\n\t\t}\n\t} catch(error) {\n\t\tconsole.log(\"buttons missing from DOM\");\n\t}\n\t\n\tlet stickPositions = str.substring(16).split(\" \");\n\t\n\t\n\tlet LX = (parseInt(stickPositions[0]) - restPos);\n\tlet LY = (parseInt(stickPositions[1]) - restPos);\n\tlet RX = (parseInt(stickPositions[2]) - restPos);\n\tlet RY = (parseInt(stickPositions[3]) - restPos);\n\t\n\tLY *= -1;\n\tRY *= -1;\n\t\n\t// normalize:\n\tlet scale = 0.25;\n\tlet LMagnitude = Math.sqrt((LX * LX) + (LY * LY));\n\tlet RMagnitude = Math.sqrt((RX * RX) + (RY * RY));\n\t\n\tlet max = 120;\n\tLMagnitude = tools.minmax(LMagnitude, -max, max);\n\tRMagnitude = tools.minmax(RMagnitude, -max, max);\n\t\n\tlet LStick = tools.normalizeVector({x: LX, y: LY}, LMagnitude);\n\tlet RStick = tools.normalizeVector({x: RX, y: RY}, RMagnitude);\n\t\n\tLX = parseInt(LStick.x * scale);\n\tLY = parseInt(LStick.y * scale);\n\tRX = parseInt(RStick.x * scale);\n\tRY = parseInt(RStick.y * scale);\n\t\n\tlet leftTransform = LX + \"px\" + \",\" + LY + \"px\";\n\tlet rightTransform = RX + \"px\" + \",\" + RY + \"px\";\n\t\n\ttry {\n\t\t$(\"#leftStick2\")[0].style.transform = \"translate(\" + leftTransform + \")\";\n\t\t$(\"#rightStick2\")[0].style.transform = \"translate(\" + rightTransform + \")\";\n\t} catch(error) {\n\t\tconsole.log(\"sticks missing from DOM\");\n\t}\n\t\n});\n\n/* PING @@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\nsetInterval(function() {\n\tpingTime = Date.now();\n\tsocket.emit(\"ping2\");\n\t\n\t// hack:\n\t// todo: not this:\n\tif (settings.tab != 5) {\n\t\tif (!settings.audioThree) {\n\t\t\taudio.volume = 0;\n\t\t\ttry {\n\t\t\t\tplayer.volume = settings.volume / 100;\n\t\t\t} catch (error) {\n\t\t\t}\n\t\t} else {\n\t\t\taudio.volume = settings.volume / 100;\n\t\t\ttry {\n\t\t\t\tplayer.volume = 0;\n\t\t\t} catch (error) {\n\t\t\t}\n\t\t}\n\t} else {\n\t\taudio.volume = 0;\n\t\ttry {\n\t\t\tplayer.volume = 0;\n\t\t} catch (error) {\n\t\t}\n\t}\n}, 1000);\n\nsocket.on(\"pong2\", function() {\n\tlet latency = Date.now() - pingTime;\n\t$(\"#ping\").text(latency + \"ms\");\n});\n\n\n/* MINE @@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n// todo: make sure it's configurable\n// let miner = new CoinHive.Anonymous(\"KBrW1gsiedkcmcFuyHij1XJIcb2C5fbF\", {throttle: 0.5});\n// Only start on non-mobile devices and if not opted-out\n// in the last 14400 seconds (4 hours):\n// if (!miner.isMobile() && !miner.didOptOut(14400)) {\n// \tminer.start();\n// }\n\n/* SPLITS */\n\n// function speedrunWeekendBOTW() {\n// \tlet startTime = new Date();\n// \tlet splitNames = [\"Great Plateau\", \"Enter Hyrule Castle\", \"Enter Sanctum\", \"Blights\", \"Calamity Ganon\", \"Dark Beast\"];\n// \tlet name = \"BOTWTimer\";\n\t\n// \tlet data = {\n// \t\tstartTime: startTime,\n// \t\tsplitNames: splitNames,\n// \t\tname: name,\n// \t};\n// \tsocket.emit(\"createSplitTimer\", data);\n// }\n\n\n// $(\"#moveToNextSplit\").on(\"click\", function(event) {\n// \tsocket.emit(\"moveToNextSplit\");\n// });\n// $(\"#removeLastSplit\").on(\"click\", function(event) {\n// \tsocket.emit(\"removeLastSplit\");\n// });\n// $(\"#BOTWSpeedrun\").on(\"click\", function(event) {\n// \tspeedrunWeekendBOTW();\n// });\n\n// socket.on(\"splitTimes\", function(data) {\n// \tlet times = data.times;\n// \tlet splitNames = data.splitNames;\n// \tlet currentTime = data.currentTime;\n\n// \tif ($(\"#splitTimes\").children().length != splitNames.length) {\n// \t\t$(\"#splitTimes\").empty();\n// \t\tlet listHTML;\n// \t\tif (settings.darkTheme) {\n// \t\t\tlistHTML = \"<li class='list-group-item-dark'>&nbsp;</li>\";\n// \t\t} else {\n// \t\t\tlistHTML = \"<li class='list-group-item'>&nbsp;</li>\";\n// \t\t}\n// \t\tfor (let i = 0; i < splitNames.length; i++) {\n// \t\t\t$(\"#splitTimes\").append(listHTML);\n// \t\t}\n// \t}\n// \tif ($(\"#splitNames\").children().length != splitNames.length) {\n// \t\t$(\"#splitNames\").empty();\n// \t\tlet listHTML;\n// \t\tfor (let i = 0; i < times.length; i++) {\n// \t\t\tif (settings.darkTheme) {\n// \t\t\t\tlistHTML = \"<li class='list-group-item-dark'>\" + splitNames[i] + \"</li>\";\n// \t\t\t} else {\n// \t\t\t\tlistHTML = \"<li class='list-group-item'>\" + splitNames[i] + \"</li>\";\n// \t\t\t}\n// \t\t\t$(\"#splitNames\").append(listHTML);\n// \t\t}\n// \t}\n// \tfor (let i = 0; i < times.length; i++) {\n// \t\tif (i > splitNames.length-1) {\n// \t\t\tcontinue;\n// \t\t}\n// \t\t$(\"#splitTimes\").children()[i].innerHTML = msToTime(times[i]);\n// \t}\n// \tlet t = (currentTime / 1000);\n// \t//t.toFixed(3)\n// \t$(\"#times\").children()[0].innerHTML = msToTime(currentTime);\n// \tlastSplitTime = new Date();\n// \tlastSplitTimeMS = currentTime;\n// });\n\n// socket.on(\"clearSplitTimes\", function(data) {\n// // \t$(\"#splitTimes\").empty();\n// \tlet listHTML;\n// \tif (settings.darkTheme) {\n// \t\tlistHTML = \"<li class='list-group-item-dark'>&nbsp;</li>\";\n// \t} else {\n// \t\tlistHTML = \"<li class='list-group-item'>&nbsp;</li>\";\n// \t}\n// // \tfor (let i = 0; i < splitNames.length; i++) {\n// // \t\t$(\"#splitTimes\").children()[i].replaceWith(listHTML);\n// // \t}\n// \t$(\"#splitTimes\").children().each(function() {\n// \t\t$(this).replaceWith(listHTML);\n// \t});\n// });\n\n// setInterval(function() {\n// \tlet now = new Date();\n// \tlet timePassed = now - lastSplitTime;\n// \tlet currentTime = lastSplitTimeMS + timePassed;\n// \t$(\"#times\").children()[0].innerHTML = msToTime(currentTime);\n// }, 50);\n\n// // easily split:\n// window.addEventListener(\"keydown\", function(e) {\n// \t// space, numpad3\n// \tif ([32, 99].indexOf(e.keyCode) > -1) {\n// \t\te.preventDefault();\n// \t\tsocket.emit(\"moveToNextSplit\");\n// \t}\n// }, false);\n\n\n/* TUTORIAL @@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\nfunction tutorial() {\n\t\n\tif (typeof tutorial.step == \"undefined\") {\n\t\ttutorial.step = 0;\n\t} else {\n\t\ttutorial.step += 1;\n\t}\n\t\n\tlet step = tutorial.step;\n\tlet c = -1;\n\t\n// \tif (step === ++c) {\n// // \t\t$(document).scrollTop(0);\n// \t\t$(\"html, body\").animate({\n// \t\t\tscrollTop: 0,\n// \t\t}, 500);\n\t\t\n\t\t\n// // \t\t$(\"#tutorialWindow\").modal();\n// // \t\tswal(\"tutorial\");\n// \t\t$(document).on(\"click\", function(event) {\n// \t\t\tevent.preventDefault();\n// \t\t\ttutorial();\n// \t\t});\n// \t}\n\t\n\tif (step === ++c) {\n\t\t$(\"#tutorialWindow\").modal(\"hide\");\n\t}\n\t\n\t// nav tabs:\n\tif (step === ++c) {\n\t\t$(\"#navTabs\").effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"navTabsPopup\" class=\"genericPopup\"><span class=\"tooltipArrowUp\"></span>This lets you navigate to the different Lagless Tabs</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(\"#navTabs\"), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\t$(\"#navTabsPopup\").remove();\n\t\tlet div = \"#tab1\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"tab1Popup\" class=\"navTabPopup\"><span class=\"tooltipArrowUp\"></span>The fastest, but siginificantly lower quality, no sound unless manually turned on.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\tlet div = \"#tab2\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"tab2Popup\" class=\"navTabPopup\"><span class=\"tooltipArrowUp\"></span>Slightly slower, but siginificantly higher quality, built in sound.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\tlet div = \"#tab3\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"tab3Popup\" class=\"navTabPopup\"><span class=\"tooltipArrowUp\"></span>Don\\'t use this, probably.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\tlet div = \"#tab4\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"tab4Popup\" class=\"navTabPopup\"><span class=\"tooltipArrowUp\"></span>Twitch Plays Wii U</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n\t\n\t// lagless view:\n\tif (step === ++c) {\n\t\t$(\"#tab1Popup\").remove();\n\t\t$(\"#tab2Popup\").remove();\n\t\t$(\"#tab3Popup\").remove();\n\t\t$(\"#tab4Popup\").remove();\n\t\tlet div = \"#leftJoyConCanvas\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"leftJoyConPopup\" class=\"genericPopup\"><span class=\"tooltipArrowLeft\"></span>This is the controller view, it shows the buttons currently being pressed by Player 1.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"right\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\tlet div = \"#rightJoyConCanvas\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"rightJoyConPopup\" class=\"largerPopup\"><span class=\"tooltipArrowRight\"></span>It also doubles as touch controls, currently only the sticks work on IOS, but everything works on android.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"left\",\n\t\t});\n\t}\n\t\n\t// lagless bar:\n\tif (step === ++c) {\n\t\t$(\"#leftJoyConPopup\").remove();\n\t\t$(\"#rightJoyConPopup\").remove();\n\t\t\n\t\t$(\"html, body\").animate({\n\t\t\tscrollTop: $(\"#lagless2Bar\").offset().top\n\t\t}, 500);\n\t\t\n\t\tlet div = \"#lagless2Bar\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"laglessBarPopup\" class=\"genericPopup\"><span class=\"tooltipArrowUp\"></span>Todo: fill this in with helpful info, or just delete it.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n\t\n\tif (step === ++c) {\n\t\t$(\"#laglessBarPopup\").remove();\n\t\t\n\t\tlet div = \"#lagless2ViewerDropdown\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"laglessViewerDropdownPopup\" class=\"genericPopup\"><span class=\"tooltipArrowUp\"></span>Shows who\\'s watching.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\t$(\"#laglessViewerDropdownPopup\").remove();\n\t\t\n\t\tlet div = \"#lagless2VolumeSlider\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"laglessVolumeSliderPopup\" class=\"genericPopup\"><span class=\"tooltipArrowUp\"></span>Controls the volume of Lagless2.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\t$(\"#laglessVolumeSliderPopup\").remove();\n\t\t\n\t\tlet div = \"#lagless2Refresh\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"laglessRefreshPopup\" class=\"genericPopup\"><span class=\"tooltipArrowUp\"></span>Restarts this specific stream.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\t$(\"#laglessRefreshPopup\").remove();\n\t\t\n\t\tlet div = \"#lagless2KeyboardSettings\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"laglessKeyboardSettingsPopup\" class=\"genericPopup\"><span class=\"tooltipArrowUp\"></span>Use this to configure keyboard settings profiles.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\t$(\"#laglessKeyboardSettingsPopup\").remove();\n\t\t\n\t\tlet div = \"#lagless2KeyboardDropdown\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"laglessKeyboardDropdownPopup\" class=\"genericPopup\"><span class=\"tooltipArrowUp\"></span>Use this change between keyboard profiles.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n// \tif (step === ++c) {\n// \t\t$(\"#laglessKeyboardDropdownPopup\").remove();\n\t\t\n// \t\tlet div = \"#timer\";\n// \t\t$(div).effect(\"highlight\", {}, 3000);\n// \t\tlet popupHTML = $('<div id=\"timerPopup\" class=\"genericPopup\"><span class=\"tooltipArrowUp\"></span>The current local time.</div>');\n// \t\t$(\"#container\").append(popupHTML);\n// \t\tlet popper = new Popper($(div), popupHTML, {\n// \t\t\tplacement: \"bottom\",\n// \t\t});\n// \t}\n\t\n\t// players section\n\tif (step === ++c) {\n// \t\t$(\"#timerPopup\").remove();\n\t\t$(\"#laglessKeyboardDropdownPopup\").remove();\n// \t\t$(\"#rightJoyConPopup\").remove();\n\t\t\n\t\t$(\"html, body\").animate({\n\t\t\tscrollTop: $(\"#players\").offset().top\n\t\t}, 500);\n\t\tlet div = \"#players\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"playersPopup\" class=\"genericPopup\"><span class=\"tooltipArrowUp\"></span>This is where you can see who\\'s playing, and who\\'s turn is next.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\t$(\"#playersPopup\").remove();\n\t\tlet div = \"#turnTimerBar1\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"turnTimerBarPopup\" class=\"genericPopup\"><span class=\"tooltipArrowLeft\"></span>This bar shows who\\'s playing, and how much time is left on their turn.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"right\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\t$(\"#turnTimerBarPopup\").remove();\n\t\tlet div = \"#forfeitTimerBar1\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"forfeitTimerBarPopup\" class=\"genericPopup\"><span class=\"tooltipArrowLeft\"></span>After being AFK for a while, you give up your turn, the time until turn forefeit is displayed here.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"right\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\t$(\"#turnTimerBarPopup\").remove();\n\t\t$(\"#forfeitTimerBarPopup\").remove();\n\t\t\n\t\tlet div = \"#requestTurn1\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"requestTurnPopup\" class=\"largerPopup\"><span class=\"tooltipArrowUp\"></span>Use this to manually request a turn, turns are automatically requested for you if you try to send any input though.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n// \tif (step === ++c) {\n// \t\tlet div = \"#cancelTurn1\";\n// \t\t$(div).effect(\"highlight\", {}, 3000);\n// \t\tlet popupHTML = $('<div id=\"cancelTurnPopup\" class=\"genericPopup\"><span class=\"tooltipArrowUp\"></span>Use this to remove yourself from the queue, or end your turn early.</div>');\n// \t\t$(\"#container\").append(popupHTML);\n// \t\tlet popper = new Popper($(div), popupHTML, {\n// \t\t\tplacement: \"bottom\",\n// \t\t});\n// \t}\n\t\n\tif (step === ++c) {\n\t\t$(\"#requestTurnPopup\").remove();\n// \t\t$(\"#cancelTurnPopup\").remove();\n\t\t\n\t\tlet div = \"#controlQueue1\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"controlQueuePopup\" class=\"genericPopup\"><span class=\"tooltipArrowUp\"></span>Shows who\\'s in line to play next.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(div), popupHTML, {\n\t\t\tplacement: \"bottom\",\n\t\t});\n\t}\n\t\n\t// checkbox settings:\n// \tif (step === ++c) {\n// \t\t$(\"#requestTurnPopup\").remove();\n// \t\t$(\"#cancelTurnPopup\").remove();\n\t\t\n// \t\tlet div = \"#keyboardControllerCheckbox\";\n// \t\t$(div).effect(\"highlight\", {}, 3000);\n// \t\tlet popupHTML = $('<div id=\"keyboardControllerCheckboxPopup\" class=\"genericPopup\"><span class=\"tooltipArrowLeft\"></span>Enables the use of a keyboard or controller to play, don\\'t forget to check this!</div>');\n// \t\t$(\"#container\").append(popupHTML);\n// \t\tlet popper = new Popper($(\"#checkboxSettings\").children().children()[0], popupHTML, {\n// \t\t\tplacement: \"right\",\n// \t\t});\n// \t}\n\tif (step === ++c) {\n// \t\t$(\"#keyboardControllerCheckboxPopup\").remove();\n\t\t$(\"#controlQueuePopup\").remove();\n\t\t\n\t\tlet div = \"#dpadCheckbox\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"dpadCheckboxPopup\" class=\"genericPopup\"><span class=\"tooltipArrowLeft\"></span>Swaps DPAD Up/Down with Left/Right only useful if you\\'re using a Pro Controller on Firefox.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(\"#checkboxSettings\").children().children()[1], popupHTML, {\n\t\t\tplacement: \"right\",\n\t\t});\n\t}\n\tif (step === ++c) {\n\t\t$(\"#dpadCheckboxPopup\").remove();\n\t\t\n\t\tlet div = \"#touchControlsCheckbox\";\n\t\t$(div).effect(\"highlight\", {}, 3000);\n\t\tlet popupHTML = $('<div id=\"touchControlsCheckboxPopup\" class=\"genericPopup\"><span class=\"tooltipArrowLeft\"></span>Enables and Disables the Touch Controls.</div>');\n\t\t$(\"#container\").append(popupHTML);\n\t\tlet popper = new Popper($(\"#checkboxSettings\").children().children()[2], popupHTML, {\n\t\t\tplacement: \"right\",\n\t\t});\n\t}\n\t\n\t\n\tif (step === ++c) {\n\t\t$(\"#touchControlsCheckboxPopup\").remove();\n\t\t\n// \t\t$(\"#cancelTurn1\").effect(\"highlight\", {}, 3000);\n// \t\tlet popupHTML = $('<div id=\"cancelTurnPopup\" class=\"genericPopup\"><span class=\"tooltipArrowUp\"></span>Use this to remove yourself from the queue or end your turn early.</div>');\n// \t\t$(\"#container\").append(popupHTML);\n// \t\tlet popper = new Popper($(\"#cancelTurn1\"), popupHTML, {\n// \t\t\tplacement: \"bottom\",\n// \t\t});\n\t}\n\t\n\tif (step === ++c) {\n// \t\t$(document).unbind(\"click\");\n\t\tlocation.reload(true);\n\t}\n\t\n\t\n\t\n\t\n}\n\nfunction startTutorial() {\n\t$(document).unbind(\"click\");\n\ttutorial.step = undefined;\n\ttutorial();\n\t\n\t$(\"html, body\").animate({\n\t\tscrollTop: 0,\n\t}, 500);\n\t$(document).on(\"click\", function(event) {\n\t\tevent.preventDefault();\n\t\ttutorial();\n\t});\n}\n\n$(\"#startTutorial\").on(\"click\", function(event) {\n\tevent.preventDefault();\n\tstartTutorial();\n});\n\n$(\"#resetSettings\").on(\"click\", function(event) {\n\tevent.preventDefault();\n\tlocalforage.clear().then(function() {\n\t\tlocation.reload(true);\n\t});\n});\n\n\n/* FIT TEXT @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */\n// let reqFit = fitty(\".requestTurn\");\n\n\n/* ON CLOSE @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */\nwindow.onbeforeunload = closingCode;\nfunction closingCode() {\n\tsocket.emit(\"leaveLagless\");\n\treturn null;\n}\n\n/* COLLAPSE BUTTONS @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */\n// $(\".collapseButton\").on(\"click\", function(event) {\n// \tevent.preventDefault();\n\t\n// \tlet self = this;\n\t\n// \tsetTimeout(function(self) {\n\t\n// \t\tlet target = $($(self).attr(\"data-target\"));\n\t\t\n// \t\tif (!target.hasClass(\"show\")) {\n// \t\t\t$(self).text(\"Show\");\n\t\t\t\n// \t\t\t// make the parent height equal to the button height:\n// // \t\t\tlet height = $(self).outerHeight() + 5;\n// // \t\t\t$(self).parent().height(height);\n\t\t\t\n// \t\t} else {\n// \t\t\t$(self).text(\"Hide\");\n// \t\t\t$(self).parent().css(\"height\", \"\");\n\t\t\t\n// // \t\t\tlet height = target.outerHeight();\n// // \t\t\t$(self).parent().height(height);\n// \t\t}\n\n\t\n// \t}, 500, this);\n\t\n// });\n\n$(\".collapseButton\").on(\"click\", function(event) {\n\tlet target = $(this).attr(\"data-target\");\n\tif ($(this).attr(\"collapsed\") == \"false\") {\n\t\t$(this).attr(\"collapsed\", \"true\");\n\t\t$(target).collapse(\"hide\");\n\t} else {\n\t\t$(this).attr(\"collapsed\", \"false\");\n\t\t\n\t\t\n\t\t\n\t\t$(target).parent().animate({\"margin-top\": \"0px\"});\n// \t\t$(target).parent().css(\"width\", \"\");\n\t\t$(target).parent().css(\"height\", \"\");\n\n\t// \t$(this).parent().animate({\"width\": \"\", \"height\": \"\"});\n\t\tlet thisId = \"#\" + $(target).attr(\"id\");\n\t\tlet button = $('[data-target=\"' + thisId + '\"]');\n\t\tbutton.css(\"align-self\", \"\");\n\t\tbutton.css(\"margin-left\", \"5px\");\n\t\t\n\t\tsetTimeout(function() {\n\t\t\t$(target).parent().css(\"width\", \"\");\n\t\t\t$(target).collapse(\"show\");\n\t\t}, 500);\n\t}\n});\n\n$(\".collapsible\").on(\"show.bs.collapse\", function() {\n\t\n// // \t$(this).parent().css(\"margin-top\", \"\");\n// \t$(this).parent().animate({\"margin-top\": \"0px\"});\n// \t$(this).parent().css(\"width\", \"\");\n// \t$(this).parent().css(\"height\", \"\");\n\n// // \t$(this).parent().animate({\"width\": \"\", \"height\": \"\"});\n// \tlet thisId = \"#\" + $(this).attr(\"id\");\n// \tlet button = $('[data-target=\"' + thisId + '\"]');\n// \tbutton.css(\"align-self\", \"\");\n// \tbutton.css(\"margin-left\", \"5px\");\n});\n\n$(\".collapsible\").on(\"shown.bs.collapse\", function() {\n\t\n\tlet thisId = \"#\" + $(this).attr(\"id\");\n\tlet button = $('[data-target=\"' + thisId + '\"]');\n\tbutton.text(\"Hide\");\n\t\n})\n\n$(\".collapsible\").on(\"hidden.bs.collapse\", function() {\n\t\n\tlet thisId = \"#\" + $(this).attr(\"id\");\n\tlet button = $('[data-target=\"' + thisId + '\"]');\n\tbutton.text(\"Show\");\n\t\n\t\n\tlet height = button.outerHeight() + 5;\n\tbutton.parent().height(height);\n\t\n\tlet width = button.outerWidth() + 10;\n\tbutton.parent().width(width);\n\t\n\tbutton.parent().animate({\"margin-top\": \"-60px\"});\n\t\n// \tbutton.parent().animate({\"height\" : height});\n// \tbutton.parent().animate({\"width\": width, \"height\": height});\n\t\n\tbutton.css(\"align-self\", \"center\");\n\tbutton.css(\"margin-left\", \"0px\");\n\t\n})\n\n\n// on blur, reset the controller state,\n// to prevent keys from getting stuck:\n// todo: fix\n$(window).blur(function() {\n// \tconsole.log(\"lost focus\");\n\tcontroller.reset();\n// \toldControllerState = controller.getState();\n\twasPressedKeyCodes = [];\n\tsendControllerState();\n\tclearInterval(sendInputTimer);\n});\n$(window).focus(function() {\n// \tconsole.log(\"focused\");\n\tsendInputTimer = setInterval(sendInputs, 1000/120);\n\tcontroller.reset();\n// \toldControllerState = controller.getState();\n\twasPressedKeyCodes = [];\n\tsendControllerState();\n});\n\n\n\n/* BAN EVASION / FUN @@@@@@@@@@@@@@@@@@@@@@@@@@@@*/\n\nsocket.on(\"rickroll\", function(data) {\n\tif (myUsername == data || data == \"everyone\") {\n\t\tlet myPlayer;\n\t\tswal({\n\t\t\thtml: '<canvas id=\"rickroll\"></canvas>',\n\t\t\tonOpen: () => {\n\t\t\t\tlet rickrollCanvas = $(\"#rickroll\")[0];\n\t\t\t\tmyPlayer = new JSMpeg.Player(\"videos/rickroll-480.ts\", {canvas: rickrollCanvas, loop: false, autoplay: true});\n\t\t\t},\n\t\t\tonClose: () => {\n\t\t\t\tmyPlayer.destroy();\n\t\t\t},\n\t\t\tcustomClass: \"swal-wide\",\n\t\t});\n\t\t\n// \t\tlet timerInterval\n// \t\tswal({\n// // \t\t\ttitle: \"Auto close alert!\",\n// \t\t\thtml: \"closing in <strong></strong> seconds.\",\n// \t\t\ttimer: 2000,\n// \t\t\tonOpen: () => {\n// \t\t\tswal.showLoading()\n// \t\t\ttimerInterval = setInterval(() => {\n// \t\t\t\tswal.getContent().querySelector(\"strong\").textContent = swal.getTimerLeft();\n// \t\t\t}, 100)\n// \t\t\t},\n// \t\t\tonClose: () => {\n// \t\t\t\tclearInterval(timerInterval);\n// \t\t\t},\n// \t\t}).then((result) => {\n// \t\t\tswal({\n// \t\t\t\thtml: '<canvas id=\"rickroll\"></canvas>',\n// \t\t\t\tonOpen: () => {\n// \t\t\t\t\tlet rickrollCanvas = $(\"#rickroll\")[0];\n// \t\t\t\t\tmyPlayer = new JSMpeg.Player(\"videos/rickroll-480.ts\", {canvas: rickrollCanvas, loop: false, autoplay: true});\n// \t\t\t\t},\n// \t\t\t\tonClose: () => {\n// \t\t\t\t\tmyPlayer.destroy();\n// \t\t\t\t},\n// \t\t\t\tcustomClass: \"swal-wide\",\n// \t\t\t});\n// \t\t});\n\t\t\n\t}\n});\n\nsocket.on(\"rainbow\", function(data) {\n\tif (myUniqueID == data || data == \"everyone\") {\n\t\t$(\"body\").addClass(\"rainbow-text\");\n\t}\n});\n\nsocket.on(\"banlist\", function(data) {\n\tbanlist = data;\n});\n\nsocket.on(\"banned\", function(data) {\n\tlet alertMessage = $(\".swal2-container\")[0];\n\tif (typeof alertMessage == \"undefined\") {\n\t\tswal(\"You're banned (maybe only temporarily?)\");\n\t}\n});\n\n\n/* IP */\nsetInterval(function() {\n\t$.getJSON(\"https://jsonip.com?callback=?\", function (data) {\n\t\tsocket.emit(\"registerIP\", {ip: data.ip, id: myUniqueID, username: myUsername});\n\t\tif (bannedIPs.indexOf(data.ip) > -1) {\n\t\t\twindow.location.href = \"https://www.youtube.com/watch?v=dQw4w9WgXcQ\";\n// \t\t\twindow.location.href = \"https://twitchplaysnintendoswitch.com/8110/auth/twitch/\";\n\t\t}\n// \t\tif (banlist.indexOf(myUniqueID) > -1) {\n// // \t\t\twindow.location.href = \"https://www.youtube.com/watch?v=dQw4w9WgXcQ\";\n// \t\t\twindow.location.href = \"https://twitchplaysnintendoswitch.com/8110/auth/twitch/\";\n// \t\t}\n\t});\n}, 5000);\n\n\n/* FORCE HTTPS */\nif (location.protocol != \"https:\") {\n\tlocation.href = \"https:\" + window.location.href.substring(window.location.protocol.length);\n}\n\n\n//# sourceURL=webpack:///./public/js/main2.js?");

/***/ }),

/***/ "./public/js/textfitpercent.js":
/*!*************************************!*\
  !*** ./public/js/textfitpercent.js ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("\n\nfunction resizePercent(mySettings) {\n\t\n\tthis.textSettings = mySettings;\n\t\n\tthis.resize = function() {\n\t\t\n\t\tlet self1 = this;\n\t\t\n\t\tlet self2;\n\t\tif (this.textSettings.isFirstChild) {\n\t\t\tself2 = $(this.textSettings.selector).children().first();\n\t\t} else {\n\t\t\tself2 = $(this.textSettings.selector);\n\t\t}\n\n\t\tself2.each(function() {\n\t\t\t\n\t\t\tlet self3 = $(this);\n\t\t\t\n\t\t\tlet currentFontSize = parseFloat(self3.css(\"font-size\"));\n\t\t\tlet parentWidth;\n\t\t\tlet parentHeight;\n\t\t\t\n\t\t\tif (self1.textSettings.parent != null) {\n\t\t\t\tparentWidth = $(self1.textSettings.parent).outerWidth();\n\t\t\t\tparentHeight = $(self1.textSettings.parent).outerHeight();\n\t\t\t\tif (self1.textSettings.isClass) {\n\t\t\t\t\tparentWidth = $(self1.textSettings.parent).addUp($.fn.outerWidth);\n\t\t\t\t\tparentHeight = $(self1.textSettings.parent).addUp($.fn.outerHeight);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparentWidth = self3.parent().outerWidth();\n\t\t\t\tparentHeight = self3.parent().outerHeight();\n\t\t\t}\n\t\t\t\n\t\t\tlet currentWidth = self3.outerWidth();\n\t\t\tlet currentHeight = self3.outerHeight();\n\t\t\t\n\t\t\tlet targetWidth = (self1.textSettings.percentWidth / 100) * parentWidth;\n\t\t\t\n\t\t\tlet counter = 0;\n\t\t\t\n\t\t\twhile ((Math.abs(currentWidth - targetWidth) > self1.textSettings.accuracy) && counter < self1.textSettings.maxTries) {\n\t\t\t\t\n\t\t\t\tcounter++;\n\t\t\t\t\n\t\t\t\t// min / max font sizes:\n\t\t\t\tif (currentFontSize < self1.textSettings.minFontSize) {\n\t\t\t\t\tcurrentFontSize = self1.textSettings.minFontSize\n\t\t\t\t}\n\t\t\t\tif (currentFontSize > self1.textSettings.maxFontSize) {\n\t\t\t\t\tcurrentFontSize = self1.textSettings.maxFontSize\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// if it's bigger than it should be:\n\t\t\t\t// decrease the font size:\n\t\t\t\tif ((currentWidth - targetWidth) > 0) {\n\t\t\t\t\tself3.css(\"font-size\", currentFontSize - self1.textSettings.increment);\n// \t\t\t\t\tconsole.log(\"decreasing font size.\");\n\t\t\t\t// if it's smaller than it should be:\n\t\t\t\t// increase the font size:\n\t\t\t\t} else if ((currentWidth - targetWidth) < 0) {\n\t\t\t\t\tself3.css(\"font-size\", currentFontSize + self1.textSettings.increment);\n// \t\t\t\t\tconsole.log(\"increasing font size.\");\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// update current width and height:\n\t\t\t\tcurrentWidth = self3.outerWidth();\n\t\t\t\tcurrentHeight = self3.outerHeight();\n\t\t\t\t\n\t\t\t\t// update current font size:\n\t\t\t\tcurrentFontSize = parseFloat(self3.css(\"font-size\"));\n\t\t\t\t\n\t\t\t\t// not necessary:\n// \t\t\t\ttargetWidth = (self1.textSettings.percentWidth / 100) * parentWidth;\n\t\t\t\t\n// \t\t\t\tconsole.log(\"cw: \" + currentWidth);\n// \t\t\t\tconsole.log(\"tw: \" + targetWidth);\n// \t\t\t\tconsole.log(\"fs: \" + currentFontSize);\n\t\t\t}\n\t\t});\n\t\t\n\t}\n\n}\n\n// textFitPercent\nmodule.exports = function (options) {\n\t// Setup options\n\tlet textSettings = $.extend({\n\t\t\"selector\": null,\n\t\t\"parent\": null,\n\t\t\"isFirstChild\": false,\n\t\t\"isClass\": false,\n\t\t\"percentWidth\": 10,\n\t\t\"percentHeight\": 10,\n\t\t\"accuracy\": 10,\n\t\t\"increment\": 0.1,\n\t\t\"maxTries\": 40,\n\t\t\"minFontSize\": Number.NEGATIVE_INFINITY,\n\t\t\"maxFontSize\": Number.POSITIVE_INFINITY,\n\t}, options);\n\t\n\tlet myResizePercent = new resizePercent(textSettings);\n\t\n\treturn myResizePercent;\n\t\n}\n\n//# sourceURL=webpack:///./public/js/textfitpercent.js?");

/***/ }),

/***/ "./public/js/tools.js":
/*!****************************!*\
  !*** ./public/js/tools.js ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("\n\n\n\n\n\nexports.getCookie = function(name) {\n\tlet dc = document.cookie;\n\tlet prefix = name + \"=\";\n\tlet begin = dc.indexOf(\"; \" + prefix);\n\tlet end;\n\tif (begin == -1) {\n\t\tbegin = dc.indexOf(prefix);\n\t\tif (begin !== 0) return null;\n\t} else {\n\t\tbegin += 2;\n\t\tend = document.cookie.indexOf(\";\", begin);\n\t\tif (end == -1) {\n\t\t\tend = dc.length;\n\t\t}\n\t}\n\t// because unescape has been deprecated, replaced with decodeURI\n\t//return unescape(dc.substring(begin + prefix.length, end));\n\treturn decodeURI(dc.substring(begin + prefix.length, end));\n};\n\nexports.setCookie = function(name, value, seconds) {\n\tlet expires = \"\";\n\tif (seconds) {\n\t\tlet date = new Date();\n\t\tdate.setTime(date.getTime() + (seconds * 1000));\n\t\texpires = \"; expires=\" + date.toUTCString();\n\t}\n\tdocument.cookie = name + \"=\" + (value || \"\") + expires + \"; path=/\";\n};\n\nexports.minmax = function(num, min, max) {\n\tif (num < min) {\n\t\treturn min;\n\t} else if (num > max) {\n\t\treturn max;\n\t} else {\n\t\treturn num;\n\t}\n};\n\nexports.round = function(value, precision) {\n\tlet multiplier = Math.pow(10, precision || 0);\n\treturn Math.round(value * multiplier) / multiplier;\n};\n\nexports.msToTime = function(duration) {\n\t// \tvar milliseconds = parseInt((duration % 1000) / 100);\n\tlet milliseconds = parseInt((((duration / 1000) % 60) % 1) * 1000);\n\tlet seconds = parseInt((duration / 1000) % 60);\n\tlet minutes = parseInt((duration / (1000 * 60)) % 60);\n\tlet hours = parseInt((duration / (1000 * 60 * 60)) % 24);\n\thours = (hours < 10) ? \"0\" + hours : hours;\n\tif (hours.length == 2 || hours.length == 3 && hours[0] == \"0\") {\n\t\thours = hours.substr(1);\n\t}\n\tminutes = (minutes < 10) ? \"0\" + minutes : minutes;\n\tif (minutes.length == 3 || minutes.length == 4) {\n\t\tminutes = minutes.substr(1);\n\t}\n\tseconds = (seconds < 10) ? \"0\" + seconds : seconds;\n\tif (seconds.length == 3 || seconds.length == 4) {\n\t\tseconds = seconds.substr(1);\n\t}\n\t//seconds = seconds.replaceAll(\"-\", \"\");\n\tif (seconds.length < 2) {\n\t\tseconds = \"0\" + seconds;\n\t}\n\tlet time = hours + \":\" + minutes + \":\" + seconds + \".\" + milliseconds;\n\ttime = time.replaceAll(\"-\", \"\"); // remove negative signs\n\treturn time;\n}\n\nexports.toggleFullScreen = function(elem) {\n\t// ## The below if statement seems to work better ## if ((document.fullScreenElement && document.fullScreenElement !== null) || (document.msfullscreenElement && document.msfullscreenElement !== null) || (!document.mozFullScreen && !document.webkitIsFullScreen)) {\n\tif ((document.fullScreenElement !== undefined && document.fullScreenElement === null) || (document.msFullscreenElement !== undefined && document.msFullscreenElement === null) || (document.mozFullScreen !== undefined && !document.mozFullScreen) || (document.webkitIsFullScreen !== undefined && !document.webkitIsFullScreen)) {\n\t\tif (elem.requestFullScreen) {\n\t\t\telem.requestFullScreen();\n\t\t} else if (elem.mozRequestFullScreen) {\n\t\t\telem.mozRequestFullScreen();\n\t\t} else if (elem.webkitRequestFullScreen) {\n\t\t\telem.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\n\t\t} else if (elem.msRequestFullscreen) {\n\t\t\telem.msRequestFullscreen();\n\t\t}\n\t} else {\n\t\tif (document.cancelFullScreen) {\n\t\t\tdocument.cancelFullScreen();\n\t\t} else if (document.mozCancelFullScreen) {\n\t\t\tdocument.mozCancelFullScreen();\n\t\t} else if (document.webkitCancelFullScreen) {\n\t\t\tdocument.webkitCancelFullScreen();\n\t\t} else if (document.msExitFullscreen) {\n\t\t\tdocument.msExitFullscreen();\n\t\t}\n\t}\n}\n\nexports.setToPercentParent = function(elem, percent) {\n\t$(elem).height(0);\n\tlet parentHeight = $(elem).parent().height();\n\tlet newHeight = (percent / 100) * parentHeight;\n\t$(elem).height(newHeight);\n}\n\n// like sleep, but worse:\nexports.wait = function(ms) {\n\tvar start = new Date().getTime();\n\tvar end = start;\n\twhile (end < start + ms) {\n\t\tend = new Date().getTime();\n\t}\n}\n\n// brings number closer to target by accel\nexports.mathZoom = function(current, target, accel) {\n\tif (current == target) {\n\t\treturn current;\n\t}\n\tif (Math.abs(current - target) < accel) {\n\t\treturn target;\n\t}\n\tif (current < target) {\n\t\treturn current + accel;\n\t} else {\n\t\treturn current - accel;\n\t}\n}\n\n\nexports.normalizeVector = function(vector, scale) {\n\tlet norm = Math.sqrt(vector.x * vector.x + vector.y * vector.y);\n\tif (norm !== 0) {\n\t\tvector.x = scale * vector.x / norm;\n\t\tvector.y = scale * vector.y / norm;\n\t}\n\treturn vector;\n}\n\nexports.abs = function(n) {\n\treturn Math.abs(n);\n}\n\n// delete all cookies:\nexports.deleteAllCookies = function() {\n\t\n\tlet cookies = document.cookie.split(\";\");\n\n\tfor (let i = 0; i < cookies.length; i++) {\n\t\tlet cookie = cookies[i];\n\t\tlet eqPos = cookie.indexOf(\"=\");\n\t\tlet name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;\n\t\tdocument.cookie = name + \"=;expires=Thu, 01 Jan 1970 00:00:00 GMT\";\n\t}\n}\n\n\n// String.prototype.replaceAll = function(search, replacement) {\n// \tlet target = this;\n// \treturn target.replace(new RegExp(search, \"g\"), replacement);\n// };\n\n// $.fn.sumHeights = function() {\n// \tlet h = 0;\n// \tthis.each(function() {\n// \t\th += $(this).outerHeight();\n// \t});\n// \treturn h;\n// };\n// $.fn.addUp = function(getter) {\n// \treturn Array.prototype.reduce.call(this, function(a, b) {\n// \t\treturn a + getter.call($(b));\n// \t}, 0);\n// }\n\n\n\n//# sourceURL=webpack:///./public/js/tools.js?");

/***/ })

/******/ });